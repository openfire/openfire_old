// Generated by CoffeeScript 1.3.3
(function(){var e,t,n,r,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,D,P,H,B,j,F,I,q,R,U,z,W,X,V,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt=[].slice,mt={}.hasOwnProperty,gt=function(e,t){function r(){this.constructor=e}for(var n in t)mt.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},yt=function(e,t){return function(){return e.apply(t,arguments)}},bt=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},wt=this;this.__apptools_preinit={},at={},O=function(e,t,n){var r,i,s,o,u,a,f,l,c;n==null&&(n=null);if(e===".")return t[t.length-1];l=e.split(/\./),e=l[0],o=2<=l.length?vt.call(l,1):[];for(i=u=c=t.length-1;c<=-1?u<-1:u>-1;i=c<=-1?++u:--u){if(t[i]==null)continue;if(typeof t[i]=="object"&&e in(r=t[i])){n=r[e];break}continue}for(a=0,f=o.length;a<f;a++)s=o[a],n=O(s,[n]);return n instanceof Function&&(n=function(e){return function(){var t;return t=e.apply(r,arguments),t instanceof Function&&t.apply(null,arguments)||t}}(n)),n},A=function(){var e,t,n,r;return n=arguments[0],r=arguments[1],e=3<=arguments.length?vt.call(arguments,2):[],function(){var i,s,o;o=[];for(i=0,s=r.length;i<s;i++)t=r[i],o.push(t.call.apply(t,[n].concat(vt.call(e))));return o}().join("")},U=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,M;t==null&&(t=["{{","}}"]),n==null&&(n=null),f=at[C=t.join(" ")]||(at[C]={});if(e in f)return f[e];i=[],r=function(){var e,n;return n=t[0],e=t[1],RegExp("([\\s\\S]*?)([ \\t]*)(?:"+n+"\\s*(?:(!)\\s*([\\s\\S]+?)|(=)\\s*([\\s\\S]+?)\\s*=|({)\\s*(\\w[\\S]*?)\\s*}|([^0-9a-zA-Z._!={]?)\\s*([\\w.][\\S]*?))\\s*"+e+")","gm")},S=r(),S.lastIndex=b=(n||{start:0}).start,y=function(t,n){var r,i,s,o,u,a,f,l,h,p,d;(s=/$/gm).lastIndex=t,s.exec(e),p=e.substr(0,t).split("\n"),h=p.length,f=p[h-1],d=c+N.length,l=e.substr(d+1,t-d-1),u=(new Array(f.length-l.length+1)).join(" "),r=(new Array(l.length+1)).join("^"),f+=e.substr(t,s.lastIndex-t),o=new Error;for(a in i={message:""+n+"\n\nLine "+h+":\n"+f+"\n"+u+r,error:n,line:h,"char":u.length,tag:l})o[a]=i[a];return o};while(m=S.exec(e)){k=m.slice(1,3),l=k[0],N=k[1],T=m[3]||m[5]||m[7]||m[9],E=m[4]||m[6]||m[8]||m[10],c=b+l.length-1,b=S.lastIndex,v=(c===-1||e.charAt(c)==="\n")&&((L=e.charAt(b))===void 0||L===""||L==="\r"||L==="\n"),l&&i.push(function(e){return function(){return e}}(l)),v&&T!==""&&T!=="&"&&T!=="{"?(e.charAt(b)==="\r"&&(b+=1),e.charAt(b)==="\n"&&(b+=1)):N&&(i.push(function(e){return function(){return e}}(N)),c+=N.length,N="");switch(T){case"!":break;case"":case"&":case"{":s=function(e,t){return function(n){var r,i;return(r=(i=O(e,n))!=null?i:"")instanceof Function&&(r=A.apply(null,[this,U(""+r())].concat(vt.call(arguments)))),t||(r=this.escape(""+r)),""+r}},i.push(s(E,T));break;case">":u=function(e,t){return function(n,r){var i;return i=r(e).toString(),t&&(i=i.replace(/^(?=.)/gm,t)),A.apply(null,[this,U(i)].concat(vt.call(arguments)))}},i.push(u(E,N));break;case"#":case"^":w={name:E,start:b,error:y(S.lastIndex,"Unclosed section '"+E+"'!")},M=U(e,t,w),x=M[0],b=M[1],w["#"]=a=function(e,t,n){return function(r){var i,s,o,u;return u=O(e,r)||[],x=u instanceof Function?u(n):n,u instanceof Array||(u=[u]),i=U(x||"",t),r.push(u),s=function(){var e,t,n;n=[];for(e=0,t=u.length;e<t;e++)o=u[e],r[r.length-1]=o,n.push(A.apply(null,[this,i].concat(vt.call(arguments))));return n}.apply(this,arguments),r.pop(),s.join("")}},w["^"]=o=function(e,t,n){return function(r){var i;return i=O(e,r)||[],i instanceof Array||(i=[1]),i=i.length===0?U(n,t):[],A.apply(null,[this,i].concat(vt.call(arguments)))}},i.push(w[T](E,t,x));break;case"/":n==null?p="End Section tag '"+E+"' found, but not in section!":E!==(g=n.name)&&(p="End Section tag closes '"+E+"'; expected '"+g+"'!");if(p)throw y(S.lastIndex,p);return e=e.slice(n.start,c+1||9e9),f[e]=i,[e,b];case"=":(t=E.split(/\s+/)).length!==2&&(p="Set Delimiters tags should have two and only two values!");if(p)throw y(S.lastIndex,p);d=/[-[\]{}()*+?.,\\^$|#]/g,t=function(){var e,n,r;r=[];for(e=0,n=t.length;e<n;e++)h=t[e],r.push(h.replace(d,"\\$&"));return r}(),S=r();break;default:throw y(S.lastIndex,"Unknown tag type -- "+T)}S.lastIndex=b!=null?b:e.length}if(n!=null)throw n.error;return e.length!==b&&i.push(function(){return e.slice(b)}),f[e]=i},j={VERSION:"1.2.0",helpers:[],partials:null,escape:function(e){var t;return t={"&":"amp",'"':"quot","<":"lt",">":"gt"},e.replace(/[&"<>]/g,function(e){return"&"+t[e]+";"})},render:function(e,t,n){var r;return n==null&&(n=null),(n||(n=this.partials||{}))instanceof Function||(n=function(e){return function(t){if(t in e)return O(t,[e]);throw"Unknown partial '"+t+"'!"}}(n)),r=this.helpers instanceof Array?this.helpers:[this.helpers],A(this,U(e),r.concat([t]),n)}},this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes=[],this.__apptools_preinit.deferred_core_modules=[],this.__apptools_preinit.abstract_feature_interfaces=[],this.__apptools_preinit.deferred_library_integrations=[]):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[],abstract_feature_interfaces:[],deferred_library_integrations:[]},l=function(){function e(){}return e}(),this.__apptools_preinit.abstract_base_classes.push(l),b=function(){function e(){}return e}(),this.__apptools_preinit.abstract_base_classes.push(b),g=function(){function e(){}return e}(),this.__apptools_preinit.abstract_base_classes.push(g),m=function(e){function t(e,t,n){this.module=e,this.message=t,this.context=n}return gt(t,e),t.prototype.toString=function(){return"["+this.module+"] CoreException: "+this.message},t}(Error),this.__apptools_preinit.abstract_base_classes.push(m),e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return gt(t,e),t.prototype.toString=function(){return"["+this.module+"] AppException: "+this.message},t}(m),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return gt(t,e),t.prototype.toString=function(){return"["+this.module+"] AppToolsException: "+this.message},t}(m),this.__apptools_preinit.abstract_base_classes.push(e),this.__apptools_preinit.abstract_base_classes.push(r),this.Backbone!=null?(u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return gt(t,e),t}(Backbone.View),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return gt(t,e),t}(Backbone.Model),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return gt(t,e),t}(Backbone.Router),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return gt(t,e),t}(Backbone.Collection)):(u=function(){function e(){}return e}(),s=function(){function e(){}return e}(),o=function(){function e(){}return e}(),n=function(){function e(){}return e}()),this.__apptools_preinit.abstract_base_classes.push(u),this.__apptools_preinit.abstract_base_classes.push(s),this.__apptools_preinit.abstract_base_classes.push(o),this.__apptools_preinit.abstract_base_classes.push(n),ct=function(){function t(){this.zero_fill=yt(this.zero_fill,this),this.wrap=yt(this.wrap,this),this.to_rgb=yt(this.to_rgb,this),this.to_hex=yt(this.to_hex,this),this.extend=yt(this.extend,this),this.throttle=yt(this.throttle,this),this.prep_animation=yt(this.prep_animation,this),this.timestamp=yt(this.timestamp,this),this.now=yt(this.now,this),this.block=yt(this.block,this),this.unbind=yt(this.unbind,this),this.bind=yt(this.bind,this),this.is_id=yt(this.is_id,this),this.has_class=yt(this.has_class,this),this.get_offset=yt(this.get_offset,this),this.get=yt(this.get,this),this.remove=yt(this.remove,this),this.add=yt(this.add,this),this.create_doc_frag=yt(this.create_doc_frag,this),this.create_element_string=yt(this.create_element_string,this),this.filter=yt(this.filter,this),this.to_array=yt(this.to_array,this),this.in_array=yt(this.in_array,this),this.is_body=yt(this.is_body,this),this.is_empty_object=yt(this.is_empty_object,this),this.is_raw_object=yt(this.is_raw_object,this),this.is_object=yt(this.is_object,this),this.is_function=yt(this.is_function,this),this.is=yt(this.is,this);var e=this;this._state={active:null,queues:{fx:[],dom:[],handlers:{}}},this.internal={queues:{add:function(t,n){return e._state.queues[t]=[],e._state.queues.handlers[t]=e.debounce(function(t,n){return e.internal.queues.process(t,n)},e.prep_animation().duration,!0)},remove:function(t,n){var r,i;return r=e._state.queues.handlers[t],delete e._state.queues.handlers[t],i=e._state.queues[t],delete e._state.queues[t],i.length>0?{queue:i,handler:r}:!0},go:function(t,n){return e._state.queues.handlers[t](t,n)},process:function(t,n){var r;return r=e._state.queues[t],e._state.queues[t]=[],n!=null?n.call(e,{queue:r,name:t}):void 0}}},this._init=function(e){}}var e=this;return t.mount="util",t.events=[],t.prototype.is=function(e){return!this.in_array(e,[!1,null,NaN,void 0,0,{},[],"","false","False","null","NaN","undefined","0","none","None"])},t.prototype.is_function=function(e){return typeof e=="function"},t.prototype.is_object=function(e){return typeof e=="object"},t.prototype.is_raw_object=function(e){return!e||typeof e!="object"||e.nodeType||typeof e=="object"&&bt.call(e,"setInterval")>=0?!1:e.constructor!=null&&!e.hasOwnProperty("constructor")&&!e.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0},t.prototype.is_empty_object=function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)return t=e[n],!1;return!0},t.prototype.is_body=function(e){return this.is_object(e)&&(Object.prototype.toString.call(e)==="[object HTMLBodyElement]"||e.constructor.name==="HTMLBodyElement")},t.prototype.is_array=Array.isArray||function(e){return typeof e=="array"||Object.prototype.toString.call(e)==="[object Array]"||e.constructor.name==="Array"},t.prototype.in_array=function(e,t){var n,r,i,s,o,u=this;if(t.indexOf!=null)return!!~t.indexOf(e);r=[],i=function(t){if(t===e)return r.push(t)};for(s=0,o=t.length;s<o;s++)n=t[s],i(n);return r.length>0},t.prototype.to_array=function(e){var t;t=[];for(i=e.length;i--;t.unshift(e[i]));return t},t.prototype.filter=function(e,t){var n,r,i,s;r=[];for(i=0,s=e.length;i<s;i++)n=e[i],t(n)&&r.push(n);return r},t.prototype.sort=null,t.prototype.create_element_string=function(e,t){var n,r,i,s;i=["area","base","basefont","br","col","frame","hr","img","input","link"],e=e.toLowerCase(),n="<"+e;for(r in t)s=t[r],n+=" "+r+'="'+s+'"';return n+=">",this.in_array(e,i)||(n+="</"+e+">"),n},t.prototype.create_doc_frag=function(e){var t,n;return n=document.createRange(),n.selectNode(document.getElementsByTagName("div").item(0)),t=n.createContextualFragment(e),t},t.prototype.add=function(e,t,n){var r,i,s=this;return e==null||!this.is_object(t)?!1:(i=this.is_body(n)||n==null||!(r=n.getAttribute("id"))?"dom":r,this._state.queues[i]==null&&this.internal.queues.add(i),this._state.queues[i].push([e,t]),this.internal.queues.go(i,function(e){var t,n,r,i,o,u,a;o=e.queue,i=e.name==="dom"?document.body:s.get(e.name),r=[];for(u=0,a=o.length;u<a;u++)t=o[u],r.push(s.create_element_string.apply(s,t));return n=s.create_doc_frag(r.join("")),i.appendChild(n)}))},t.prototype.remove=function(e){return e.parentNode.removeChild(e)},t.prototype.get=function(e,t){var n,r,i;return t==null&&(t=document),e.nodeType?e:(r=document.getElementById(e))!=null?r:(n=t.getElementsByClassName(e)).length>0?this.to_array(n):(i=t.getElementsByTagName(e)).length>0?this.to_array(i):null},t.prototype.get_offset=function(e){var t,n;t=n=0;for(;;){t+=e.offsetLeft,n+=e.offsetTop;if(!(e=e.offsetParent))break}return{left:t,top:n}},t.prototype.has_class=function(e,t){var n;return((n=e.classList)!=null?typeof n.contains=="function"?n.contains(t):void 0:void 0)||e.className&&(new RegExp("\\s*"+t+"\\s*")).test(e.className)},t.prototype.is_id=function(e){return e.charAt(0)==="#"||document.getElementById(e!==null)?!0:!1},t.prototype.bind=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d;r==null&&(r=!1);if(this.is_array(e)){h=[];for(a=0,l=e.length;a<l;a++)i=e[a],h.push(this.bind(i,t,n,r));return h}if(this.is_array(t)){p=[];for(f=0,c=t.length;f<c;f++)o=t[f],p.push(this.bind(e,o,n,r));return p}if(this.is_raw_object(t)){d=[];for(s in t)u=t[s],d.push(this.bind(e,s,u,r));return d}return e.addEventListener(t,n,r)},t.prototype.unbind=function(e,t){var n,r,i,s,o,u,a,f,l;if(this.is_array(e)){a=[];for(i=0,o=e.length;i<o;i++)n=e[i],a.push(this.unbind(n,t));return a}if(this.is_array(t)){f=[];for(s=0,u=t.length;s<u;s++)r=t[s],f.push(this.unbind(e,r));return f}if(this.is_raw_object(e)){l=[];for(n in e)r=e[n],l.push(this.unbind(n,r));return l}return e.constructor.name==="NodeList"?this.unbind(this.to_array(e),t):e.removeEventListener(t)},t.prototype.block=function(e,t){var n,r;t==null&&(t={}),console.log("[Util] Enforcing blocking at user request... :("),r=!1,n=null,e(t,function(e){return n=e,r=!0});for(;;)if(r!==!1)break;return n},t.prototype.now=function(){return+(new Date)},t.prototype.timestamp=function(e){return e==null&&(e=new Date),[[e.getMonth()+1,e.getDate(),e.getFullYear()].join("-"),[e.getHours(),e.getMinutes(),e.getSeconds()].join(":")].join(" ")},t.prototype.prep_animation=function(e,t,n){var r;return r=e==null?{duration:400}:e!=null&&this.is_object(e)?this.extend({},e):{complete:n||!n&&t||is_function(e&&e),duration:e,easing:n&&t||t&&!is_function(t)},r},t.prototype.throttle=function(e,t,n){var r,i,s=this;return i=null,r=0,function(){var o,u,a,f;return o=arguments,a=s.now()-r,u=function(){return f(),i=null},f=function(){return r=s.now(),e.apply(s,o)},n&&!i&&f(),!i||clearTimeout(i),n==null&&a>=t?f():i=setTimeout(n?u:f,n==null?t-a:t)}},t.prototype.debounce=function(e,t,n){return t==null&&(t=200),n==null&&(n=!1),this.throttle(e,t,n)},t.prototype.extend=function(){var e,t,n,r,i,s,o,u,a,f=this;s=arguments[0]||{},r=1,n=!1,i=arguments.length,typeof s=="boolean"&&(n=s,s=arguments[1]||{},r++),!this.is_object(s)&&!this.is_function(s)&&(s={}),t=Array.prototype.slice.call(arguments,r),o=function(e){var t,r,i,o,u,a,l,c,h;a=e,h=[];for(u in a){c=a[u];if(s===c)continue;o=String(u),r=c,l=s[u],n&&r!=null&&(f.is_raw_object(r)||(t=f.is_array(r)))?(t!=null?(t=!1,i=l&&(f.is_array(l)?l:[])):i=l&&(f.is_raw_object(l)?l:{}),h.push(s[u]=f.extend(n,i,r))):r!=null?h.push(s[u]=r):h.push(void 0)}return h};for(u=0,a=t.length;u<a;u++)e=t[u],o(e);return s},t.prototype.to_hex=function(e){var t,n,r,i;if(e.match(/^#?[0-9A-F]{6}|[0-9A-F]{3}$\/i/))return e.charAt(!1)?e:"#"+e;if(!e.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/))return!1;n=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)];if(n.length===3)return i=this.zero_fill(n[0].toString(16,2)),r=this.zero_fill(n[1].toString(16,2)),t=this.zero_fill(n[2].toString(16,2)),"#"+i+r+t},t.prototype.to_rgb=function(e){var t,n,r,i;return e.match(/^rgb\(\s*\d{1,3}\s*,\s\d{1,3}\s*,\s*\d{1,3}\s*\)$/)?e:e.match(/^#?([0-9A-F]{1,2})([0-9A-F]{1,2})([0-9A-F]{1,2})$\/i/)?(n=[parseInt(RegExp.$1,16),parseInt(RegExp.$2,16),parseInt(RegExp.$3,16)],i=n[0].toString(10),r=n[1].toString(10),t=n[2].toString(10),"rgb("+i+","+r+","+t+")"):!1},t.prototype.wrap=function(e,t){var n,r;return r=2,e.preventDefault!=null?(e.preventDefault(),e.stopPropagation()):(t=e,r--),n=Array.prototype.slice.call(arguments,r),function(){return t.apply(this,n)}},t.prototype.zero_fill=function(e,t){return(Array(t).join("0")+e).slice(-t)},t}.call(this),this.__apptools_preinit.abstract_base_classes.push(ct),this.__apptools_preinit.deferred_core_modules.push({module:ct}),ct=window.Util=new ct,p=function(e){function t(e,t){var n=this;this.config={},this.environment={},this.performance={},this.debug={logging:!0,eventlog:!0,verbose:!0,serverside:!1},this.setDebug=function(e){return n.debug=e,n._sendLog("[CoreDev] Debug has been set.",n.debug)},this._sendLog=function(){var e;return e=1<=arguments.length?vt.call(arguments,0):[],console.log.apply(console,e)},this.log=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?vt.call(arguments,2):[],e==null&&(e="{no context}"),n.debug.logging===!0&&n._sendLog.apply(n,["["+r+"] INFO: "+t].concat(vt.call(e)))},this.warning=this.warn=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?vt.call(arguments,2):[],e==null&&(e="{no context}"),n.debug.logging===!0&&n._sendLog.apply(n,["["+r+"] WARNING: "+t].concat(vt.call(e)))},this.error=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?vt.call(arguments,2):[],n.debug.logging===!0&&n._sendLog.apply(n,["["+r+"] ERROR: "+t].concat(vt.call(e)))},this.verbose=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?vt.call(arguments,2):[],n.debug.verbose===!0&&n._sendLog.apply(n,["["+r+"] DEBUG: "+t].concat(vt.call(e)))},this.exception=this.critical=function(){var e,r,i,s;throw s=arguments[0],i=arguments[1],r=arguments[2],e=4<=arguments.length?vt.call(arguments,3):[],r==null&&(r=t.AppToolsException),n._sendLog("A critical error or unhandled exception occurred."),n._sendLog.apply(n,["["+s+"] CRITICAL: "+i].concat(vt.call(e))),new r(s,i,e)}}return gt(t,e),t.mount="dev",t.events=[],t}(l),this.__apptools_preinit.abstract_base_classes.push(p),y=function(e){function t(){var e=this;this.internal={block:function(){var e,t,n,r;e=arguments[0],t=2<=arguments.length?vt.call(arguments,1):[],r=!1,n=null,e.apply(null,vt.call(t).concat([function(e){return n=e,r=!0}]));for(;;)if(r!==!1)break;return n},validate:function(e,t){var n,r,i,s,o;t==null&&(t=e.constructor.prototype),n=[];for(i in e){if(!{}.hasOwnProperty.call(e,i))continue;if(e[i].constructor.name===t[i].constructor.name)continue;n.push(i)}for(s=0,o=n.length;s<o;s++)return r=n[s],n;return!0}},this.put=function(t){return e.internal.block(e.put_async,t)},this.get=function(t,n){return e.internal.block(e.get_async,t,n)},this["delete"]=function(t,n){return e.internal.block(e.delete_async,t,n)},this.put_async=function(t){return t==null&&(t=function(e){return e}),apptools.storage.put(e.constructor.prototype.name,t)},this.get_async=function(t,n){return n==null&&(n=function(e){return e}),apptools.storage.get(e.key,e.constructor.prototype.name,n)},this.delete_async=function(t){return t==null&&(t=function(e){return e}),apptools.storage["delete"](e.key,e.constructor.prototype.name,t)},this.all=function(e){throw e==null||(ct!=null?!ct.is_function(e):!void 0)?e!=null?"Provided callback isn't a function. Whoops.":"all() requires a callback.":"all() currently in active development, sorry."},this.register=function(){return apptools.dev.verbose("CoreModelAPI","register() currently in active development, sorry.")}}return gt(t,e),t.mount="model",t.events=[],t.init=function(){},t}(l),q=function(){function e(){this.render=yt(this.render,this),this.all=yt(this.all,this),this.delete_async=yt(this.delete_async,this),this.get_async=yt(this.get_async,this),this.put_async=yt(this.put_async,this),this["delete"]=yt(this["delete"],this),this.get=yt(this.get,this),this.put=yt(this.put,this)}return e.prototype.key=null,e.prototype.put=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=apptools.model).put.apply(t,[this].concat(vt.call(e)))},e.prototype.get=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=apptools.model).get.apply(t,[this].concat(vt.call(e)))},e.prototype["delete"]=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=apptools.model)["delete"].apply(t,[this].concat(vt.call(e)))},e.prototype.put_async=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=apptools.model).put_async.apply(t,[this].concat(vt.call(e)))},e.prototype.get_async=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=apptools.model).get_async.apply(t,[this].concat(vt.call(e)))},e.prototype.delete_async=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=apptools.model).delete_async.apply(t,[this].concat(vt.call(e)))},e.prototype.all=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=apptools.model).all.apply(t,[this].concat(vt.call(e)))},e.prototype.render=function(e){},e}(),this.__apptools_preinit.abstract_base_classes.push(y),this.__apptools_preinit.abstract_base_classes.push(q),v=function(e){function t(e,t){var n=this;this.registry=[],this.callchain={},this.history=[],this.fire=this.trigger=function(){var t,r,i,s,o,u,a,f,l,c,h,p,d,v;s=arguments[0],t=2<=arguments.length?vt.call(arguments,1):[],e.dev.verbose("Events","Triggered event:",s,t,n.callchain[s]);if(bt.call(n.registry,s)>=0){a=0,u=0,o=[],l=[],l.push(s),v=n.callchain[s].hooks;for(c=0,p=v.length;c<p;c++){i=v[c];try{if(i.once===!0&&i.has_run===!0)continue;i.bridge!=null==0?(f=i.fn.apply(i,t),a++,n.history.push({event:s,callback:i,args:t,result:f}),i.has_run=!0):i.bridge===!0&&o.push({event:i.event,args:t})}catch(m){u++,n.history.push({event:s,callback:i,args:t,error:m})}}for(h=0,d=o.length;h<d;h++)r=o[h],l.push(r.event),n.trigger.apply(n,[r.event].concat(vt.call(r.args)));return{events:l,executed:a,errors:u}}return!1},this.create=this.register=function(t){var r,i,s;t instanceof Array||(t=[t]);for(i=0,s=t.length;i<s;i++)r=t[i],n.registry.push.apply(n.registry,t),n.callchain[r]={hooks:[]};return e.dev.verbose("Events","Registered events:",{count:t.length,events:t}),!0},this.on=this.upon=this.when=this.hook=function(t,r,i){return i==null&&(i=!1),bt.call(n.registry,t)<0&&(e.dev.warning("Events",""),n.register(t)),n.callchain[t].hooks.push({fn:r,once:i,has_run:!1,bridge:!1}),e.dev.verbose("Events","Hook registered on event.",t),!0},this.delegate=this.bridge=function(t,r){var i,s,o,u,a;typeof r=="string"&&(r=[r]),typeof t=="string"&&(t=[t]),a=[];for(o=0,u=t.length;o<u;o++)i=t[o],a.push(function(){var t,n,o;o=[];for(t=0,n=r.length;t<n;t++)s=r[t],e.dev.verbose("Events","Bridging events:",i,"->",s),this.callchain[i]==null&&(e.dev.warn("Events","Bridging from undefined source event:",i),this.register(i)),o.push(this.callchain[i].hooks.push({event:s,bridge:!0}));return o}.call(n));return a}}return gt(t,e),t.mount="events",t.events=[],t}(l),this.__apptools_preinit.abstract_base_classes.push(v),h=function(e){function t(e,t){this._data={},this.platform={},this.capabilities={},e.lib.modernizr!=null&&(this.capabilities=e.lib.modernizr),this.capabilities.simple={},this._data={browsers:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:t.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}return gt(t,e),t.mount="agent",t.events=["UA_DISCOVER"],t.prototype._makeMatch=function(e){var t,n,r,i,s;for(i=0,s=e.length;i<s;i++){r=e[i],n=r.string,t=r.prop,this._data.versionSearchString=r.versionSearch||r.identity;if(n!==null){if(r.string.indexOf(r.subString)!==-1)return r.identity}else if(t)return r.identity}},t.prototype._makeVersion=function(e){var t;t=e.indexOf(this._data.versionSearchString);if(t!==-1)return parseFloat(e.substring(t+this._data.versionSearchString.length+1))},t.prototype.discover=function(){var e,t,n,r,i;e=this._makeMatch(this._data.browsers)||"unknown",i=this._makeVersion(navigator.userAgent)||this._makeVersion(navigator.appVersion)||"unknown",n=this._makeMatch(this._data.os)||"unknown";if(e==="iPod/iPhone"||e==="Android")r="mobile",t=!1;this.platform={os:n,type:r,vendor:navigator.vendor,product:navigator.product,browser:e,version:i,flags:{online:navigator.onLine||!0,mobile:t,webkit:$.browser.webkit,msie:$.browser.msie,opera:$.browser.opera,mozilla:$.browser.mozilla}},this.capabilities.simple.cookies=navigator.cookieEnabled;if(window.jQuery!=null)return this.capabilities.simple.ajax=$.support.ajax},t}(l),this.__apptools_preinit.abstract_base_classes.push(h),d=function(e){function t(e,t){var n=this;this.state={opened:!1,receiving:!1,error:!1,history:{errors:[],received:[]},pending:{},complete:{}},this.init=function(){return n.state.opened=!0,e.dev.verbose("Dispatch","Dispatch startup signal received.")},this.expect=function(t,r,i){return n.state.pending[t]={request:r,callbacks:callbacks,xhr:i},e.dev.verbose("Dispatch","Received EXPECT signal.",t,r,callbacks,i)},this.receive=function(t){var r,i,s,o,u;try{i=JSON.parse(t.data)}catch(a){i=t.data}return e.dev.verbose("Dispatch","Parsed async message.",i),n.state.history.received.push(t),i.status==="ok"?(e.dev.verbose("Dispatch","Triggering deferred success callback."),n.state.complete[i.id]=n.state.pending[i.id],n.state.complete[i.id].response=i,delete n.state.pending[i.id],e.dev.log("RPC","Success",t.data,i.status,n.state.complete[i.id].xhr),e.api.rpc.lastResponse=t.data,e.api.rpc.history[i.id].xhr=n.state.complete[i.id].xhr,e.api.rpc.history[i.id].status=i.status,e.api.rpc.history[i.id].response=t.data,r={xhr:n.state.complete[i.id].xhr,status:i.status,data:t.data},e.events.trigger("RPC_SUCCESS",r),typeof (s=n.state.complete[i.id].callbacks).success=="function"?s.success(i.response.content):void 0):i.status==="notify"?(e.dev.verbose("Dispatch","Received NOTIFY signal."),typeof (o=n.state.pending[i.id].callbacks).notify=="function"?o.notify(i.response.content):void 0):(e.dev.error("Dispatch","Userland deferred task error. Calling error callback.",i),typeof (u=n.state.pending[i.id].callbacks).error=="function"?u.error(i.content):void 0)},this.error=function(t){return n.state.error=!0,n.history.errors.push(t),e.dev.error("Dispatch","Dispatch error state triggered.",t)},this.close=function(){return n.state.opened=!1,n.state.receiving=!1,e.dev.verbose("Dispatch","Dispatch shutdown signal received.")}}return gt(t,e),t.mount="dispatch",t.events=[],t}(l),this.__apptools_preinit.abstract_base_classes.push(d),it=function(e){function t(){}return gt(t,e),t.methods=["compatible","construct"],t["export"]="public",t}(g),this.compatible=function(){},this.construct=function(){},rt=function(e){function t(){return}return gt(t,e),t.methods=["get","put","delete","clear","get_async","put_async","delete_async","clear_async"],t["export"]="public",t}(g),P=function(e){function t(){return}return gt(t,e),t.methods=["build_key","encode_key","build_cluster","encode_cluster"],t["export"]="public",t}(g),this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes==null&&(this.__apptools_preinit.abstract_base_classes=[]),this.__apptools_preinit.deferred_core_modules==null&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]},this.__apptools_preinit.detected_storage_engines=[],this.__apptools_preinit.abstract_base_classes.push(it),this.__apptools_preinit.abstract_base_classes.push(rt),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:it,name:"storage"}),tt=function(e){function t(){var e=this;this.build_key=function(){},this.encode_key=function(){},this.build_cluster=function(){},this.encode_cluster=function(){}}return gt(t,e),t}(P),dt=new tt,B=function(e){function t(e){var t=this;this.name=e,this.get_async=function(e,n){var r;return n.call(r=t.get(e))},this.put_async=function(e,n,r){return t.put(e,n),r.call(n)},this.delete_async=function(e,n){return t["delete"](e),n.call(t)},this.clear_async=function(e){return t.clear(),e.call(t)},this.get=function(e){return localStorage.getItem(e)},this.put=function(e,n){return t.get(e)==null&&t._state.runtime.count.total_keys++,localStorage.setItem(e,n)},this["delete"]=function(e){return t._state.runtime.count.total_keys--,localStorage.removeItem(e)},this.clear=function(){return t._state.runtime.count.total_keys=0,localStorage.clear()};return}return gt(t,e),t._state={runtime:{count:{total_keys:0,by_kind:[]}}},t}(rt),et=function(e){function t(e){var t=this;this.name=e,this.get_async=function(e,n){var r;return n.call(r=t.get(e))},this.put_async=function(e,n,r){return t.put(e,n),r.call(n)},this.delete_async=function(e,n){return t["delete"](e),n.call(t)},this.clear_async=function(e){return t.clear(),e.call(t)},this.get=function(e){return sessionStorage.getItem(e)},this.put=function(e,n){return t.get(e)==null&&t._state.runtime.count.total_keys++,sessionStorage.setItem(e,n)},this["delete"]=function(e){return t._state.runtime.count.total_keys--,sessionStorage.removeItem(e)},this.clear=function(){return t._state.runtime.count.total_keys=0,sessionStorage.clear()};return}return gt(t,e),t._state={runtime:{count:{total_keys:0,by_kind:[]}}},t}(rt),H=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return gt(t,e),t._state={constructor:function(){var e=this;this.compatible=function(){return!!window.localStorage},this.construct=function(t){var n;return t==null&&(t="appstorage"),e.compatible()?n=new B(t):!1}}},t}(it),Z=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return gt(t,e),t._state={constructor:function(){var e=this;this.compatible=function(){return!!window.sessionStorage},this.construct=function(t){var n;return t==null&&(t="appstorage"),e.compatible()?n=new et(t):!1}}},t}(it),this.__apptools_preinit.detected_storage_engines.push({name:"LocalStorage",adapter:B,driver:H,key_encoder:dt}),this.__apptools_preinit.detected_storage_engines.push({name:"SessionStorage",adapter:et,driver:Z,key_encoder:dt}),D=function(e){function t(){return}return gt(t,e),t}(rt),M=function(e){function t(){return}return gt(t,e),t}(it),this.__apptools_preinit.detected_storage_engines.push({name:"IndexedDB",adapter:D,driver:M}),pt=function(e){function t(){return}return gt(t,e),t}(rt),ht=function(e){function t(){return}return gt(t,e),t}(it),this.__apptools_preinit.detected_storage_engines.push({name:"WebSQL",adapter:pt,driver:ht}),x=function(e){function t(e,t){var n=this;this._state={runtime:{index:{key_read_tally:{},key_write_tally:{},local_by_key:{},local_by_kind:{}},count:{total_keys:0,by_collection:[],by_kind:[]},data:{}},config:{autoload:!1,autosync:{enabled:!1,interval:120},drivers:[],engines:{},encrypt:!1,integrity:!1,obfuscate:!1,local_only:!1,callbacks:{ready:null,sync:null}},supervisor:{},cachebridge:{},model_kind_map:{},collection_kind_map:{}},this.internal={check_support:function(e){},bootstrap:function(e){},provision_collection:function(e,t,n){},add_storage_engine:function(t,r,i){var s,o;try{s=new r(e),o=new i(e)}catch(u){return!1}return o.compatible()?(n._state.config.engines[t]=o,r.adapter=n._state.config.engines[t],n._state.config.drivers.push(r),e.sys.drivers.install("storage",t,s,s.enabled!=null|!0,s.priority!=null|50,function(t){return e.events.trigger("ENGINE_LOADED",{driver:t,engine:t.adapter})}),!0):(e.dev.verbose("StorageEngine","Detected incompatible storage engine. Skipping.",t,r,i),!1)}},this.get=function(){},this.list=function(){},this.count=function(){},this.put=function(){},this.query=function(){},this["delete"]=function(){},this.sync=function(){},this._init=function(){var t,r,i,s,o,u;e.events.trigger("STORAGE_INIT"),e.dev.verbose("Storage","Storage support is currently under construction.");if(((s=e.sys)!=null?(o=s.preinit)!=null?o.detected_storage_engines:void 0:void 0)!=null){u=e.sys.preinit.detected_storage_engines;for(r=0,i=u.length;r<i;r++)t=u[r],n.internal.add_storage_engine(t.name,t.driver,t.adapter)}return e.events.trigger("STORAGE_READY")},e.events.bridge(["STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE"],"STORAGE_ACTIVITY"),e.events.bridge(["COLLECTION_CREATE","COLLECTION_UPDATE","COLLECTION_DESTROY","COLLECTION_SYNC","COLLECTION_SCAN"],"STORAGE_ACTIVITY")}return gt(t,e),t.mount="storage",t.events=["STORAGE_INIT","ENGINE_LOADED","STORAGE_READY","STORAGE_ERROR","STORAGE_ACTIVITY","STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE","COLLECTION_SCAN","COLLECTION_CREATE","COLLECTION_DESTROY","COLLECTION_UPDATE","COLLECTION_SYNC"],t}(l),this.__apptools_preinit.abstract_base_classes.push(x),X=function(e){function t(e,t,n,r){var i,s,o,u;this.name=e,this.base_uri=t,this.methods=n,this.config=r;if(this.methods.length>0){u=this.methods;for(s=0,o=u.length;s<
o;s++)i=u[s],this[i]=this._buildRPCMethod(i,t,r)}}return gt(t,e),t.prototype._buildRPCMethod=function(e,t,n){var r,i,s=this;return r=this.name,i=function(t,n,i,s,o,u){return t==null&&(t={}),n==null&&(n=null),i==null&&(i=!1),s==null&&(s=!1),o==null&&(o={}),u==null&&(u={}),function(t,n,i,s,o){var a;return a=$.apptools.api.rpc.createRPCRequest({method:e,api:r,params:t||{},opts:o||{},async:i||!1,push:s||!1}),n!==null?a.fulfill(n,u):a}(t,n,i,s,o)},$.apptools.api.registerAPIMethod(r,e,t,n),i},t}(b),J=function(e){function t(e,t,n){this.params={},this.action=null,this.method=null,this.api=null,this.base_uri=null,this.envelope={id:null,opts:{},agent:{}},this.ajax={accept:"application/json",async:!0,cache:!0,global:!0,http_method:"POST",crossDomain:!1,processData:!1,ifModified:!1,dataType:"json",push:!1,contentType:"application/json; charset=utf-8"},e!=null&&(this.envelope.id=e),t!=null&&(this.envelope.opts=t),n!=null&&(this.envelope.agent=n)}return gt(t,e),t.prototype.fulfill=function(e,t){var n,r,i=this;return e==null&&(e={}),(e!=null?e.success:void 0)==null&&(r=function(e,t,n){return $.apptools.dev.log("RPC","RPC succeeded but had no success callback.",i,e,t,n)},e.success=r),(e!=null?e.failure:void 0)==null&&(n=function(e){return $.apptools.dev.error("RPC","RPC failed but had no failure callback.",i,e)},e.failure=n),$.apptools.api.rpc.fulfillRPCRequest(t,this,e)},t.prototype.setAsync=function(e){var t,n;return(t=this.ajax)!=null&&(n=t.async)==null&&(t.async=e),this},t.prototype.setPush=function(e){return e===!0&&(this.ajax.push=!0,this.envelope.opts.alt="socket",this.envelope.opts.token=$.apptools.push.state.config.token),this},t.prototype.setOpts=function(e){var t,n;return(t=this.envelope)!=null&&(t.opts=_.defaults(e,(n=this.envelope)!=null?n.opts:void 0)),this},t.prototype.setAgent=function(e){var t,n;return(t=this.envelope)!=null&&(n=t.agent)==null&&(t.agent=e),this},t.prototype.setAction=function(e){return this.action=e,this},t.prototype.setMethod=function(e){return this.method=e,this},t.prototype.setAPI=function(e){return this.api=e,this},t.prototype.setBaseURI=function(e){return this.base_uri=e,this},t.prototype.setParams=function(e){return this.params=e!=null?e:{},this},t.prototype.payload=function(){var e;return e={id:this.envelope.id,opts:this.envelope.opts,agent:this.envelope.agent,request:{params:this.params,method:this.method,api:this.api}},e},t}(b),K=function(e){function t(){var e;e=1<=arguments.length?vt.call(arguments,0):[],$.apptools.dev.verbose("RPC","RPCResponse is not yet implemented and is currently stubbed.");return}return gt(t,e),t}(b),E=function(e){function n(e,n){var r,i,s,o=this;this.state={sockets:{token:"__NULL__",enabled:!1,status:"DISCONNECTED","default":null,default_host:((i=e.config)!=null?(s=i.rpc)!=null?s.socket_host:void 0:void 0)!=null||null}},this.base_rpc_uri=e.config.rpc.base_uri||"/_api/rpc",this.socket_host=e.config.rpc.socket_host||null,e.sys.libraries.resolve("jQuery")!==!1?r=$.ajaxSettings.xhr:r=new XMLHTTPRequest,this.internals={transports:{xhr:{factory:function(){var t;return t=r(),t&&typeof t.addEventListener=="function"&&t.addEventListener("progress",function(t){return e.events.trigger("RPC_PROGRESS",{event:t})},!1),t}},websocket:{factory:function(){var t,n,r,i,s,u;if(e.agent.capabilities.websockets==null)throw e.dev.error("RPC","Socket factory can't produce a socket because the client platform does not support WebSockets."),"SocketsNotSupported: The client platform does not have support for websockets.";if(((r=o.state.sockets)!=null?r.enabled:void 0)!=null==1)return((i=o.state.sockets)!=null?i["default"]:void 0)!=null===null&&((s=o.state.sockets)!=null?(u=s.open)!=null?u.length:void 0:void 0)===0&&(n=new e.push.socket.establish,o.state.sockets.enabled=!0,o.state.sockets["default"]=n,o.state.sockets.status="CONNECTED"),t={},t}}},config:{headers:{"X-ServiceClient":["AppToolsJS/",[t.version.major.toString(),t.version.minor.toString(),t.version.micro.toString(),t.version.build.toString()].join("."),"-",t.version.release.toString()].join(""),"X-ServiceTransport":"AppTools/JSONRPC"}}},this.rpc={lastRequest:null,lastFailure:null,lastResponse:null,history:{},action_prefix:null,alt_push_response:!1,used_ids:[],factory:function(t,n,r,i){return e.api[t]=new X(t,n,r,i)},_assembleRPCURL:function(e,t,n,r){if(t==null&&r==null)throw"[RPC] Error: Must specify either an API or base URI to generate an RPC endpoint.";return t!=null?r!=null?r=r+"/"+t:r=o.base_rpc_uri+"/"+t:r==null&&(r=o.base_rpc_uri),n!==null?[n+r,e].join("."):[r,e].join(".")},provisionRequestID:function(){var e;return o.rpc.used_ids.length>0?(e=Math.max.apply(o,o.rpc.used_ids)+1,o.rpc.used_ids.push(e),e):(o.rpc.used_ids.push(1),1)},decodeRPCResponse:function(e,t,n,r,i){return r(e,t)},createRPCRequest:function(t){var n;return n=new J(o.rpc.provisionRequestID()),t.api!=null&&n.setAPI(t.api),t.method!=null&&n.setMethod(t.method),t.agent!=null&&n.setAgent(t.agent),t.opts!=null&&n.setOpts(t.opts),t.base_uri!=null&&n.setBaseURI(t.base_uri),t.params!=null&&n.setParams(t.params),t.async!=null&&n.setAsync(t.async),t.push!=null?n.setPush(t.push):n.setPush(o.rpc.alt_push_response),e.dev.verbose("RPC","New Request",n,t),n.setAction(o.rpc._assembleRPCURL(n.method,n.api,o.rpc.action_prefix,o.base_rpc_uri)),n},fulfillRPCRequest:function(t,n,r,i){var s;i==null&&(i="xhr"),e.dev.verbose("RPC","Fulfill",t,n,r),e.sys.libraries.resolve("jQuery")!==!1&&$.ajaxSetup({type:"POST",accepts:"application/json",contentType:"application/json",global:!0,xhr:function(){return o.internals.transports.xhr.factory()},headers:o.internals.config.headers}),o.rpc.lastRequest=n,o.rpc.history[n.envelope.id]={request:n,config:t,callbacks:r};if(n.action===null){if(n.method===null)throw"[RPC] Error: Request must specify at least an action or method.";if(n.base_uri===null){if(n.api===null)throw"[RPC] Error: Request must have an API or explicity defined BASE_URI.";n.action=o.rpc._assembleRPCURL(n.method,n.api,o.rpc.action_prefix)}else n.action=o.rpc._assembleRPCURL(n.method,null,o.rpc.action_prefix,n.base_uri)}if(n.action===null||n.action===void 0)throw"[RPC] Error: Could not determine RPC action.";return s={config:t,request:n,callbacks:r},e.events.trigger("RPC_FULFILL",s),function(e,t,n){var r,i,o,u,a=this;u={resourceId:t.api+"."+t.method,url:t.action,data:JSON.stringify(t.payload()),async:t.ajax.async,global:t.ajax.global,type:t.ajax.http_method||"POST",accepts:t.ajax.accepts||"application/json",crossDomain:t.ajax.crossDomain,dataType:t.ajax.dataType,processData:!1,ifModified:t.ajax.ifModified,contentType:t.ajax.contentType,beforeSend:function(r,i){return e.api.rpc.history[t.envelope.id].xhr=r,n!=null&&typeof n.status=="function"&&n.status("beforeSend"),r},error:function(r,i,o){return n!=null&&typeof n.status=="function"&&n.status("error"),e.dev.error("RPC","Error: ",{error:o,status:i,xhr:r}),e.api.rpc.lastFailure=o,e.api.rpc.history[t.envelope.id].xhr=r,e.api.rpc.history[t.envelope.id].status=i,e.api.rpc.history[t.envelope.id].failure=o,s={xhr:r,status:i,error:o},e.events.trigger("RPC_ERROR",s),e.events.trigger("RPC_COMPLETE",s),n!=null?typeof n.failure=="function"?n.failure(o):void 0:void 0},success:function(r,i,o){return r.status==="ok"?(n!=null&&typeof n.status=="function"&&n.status("success"),e.dev.log("RPC","Success",r,i,o),e.api.rpc.lastResponse=r,e.api.rpc.history[t.envelope.id].xhr=o,e.api.rpc.history[t.envelope.id].status=i,e.api.rpc.history[t.envelope.id].response=r,s={xhr:o,status:i,data:r},e.events.trigger("RPC_SUCCESS",s),e.events.trigger("RPC_COMPLETE",s),n!=null?typeof n.success=="function"?n.success(r.response.content,r.response.type,r):void 0:void 0):r.status==="wait"?(n!=null&&typeof n.status=="function"&&n.status("wait"),e.dev.log("RPC","PushWait",r,i,o),s={xhr:o,status:i,data:r},n!=null&&typeof n.wait=="function"&&n.wait(r,i,o),e.push.internal.expect(t.envelope.id,t,o)):r.status==="fail"?(n!=null&&typeof n.status=="function"&&n.status("error"),e.dev.error("RPC","Error: ",{error:r,status:i,xhr:o}),e.api.rpc.lastFailure=r,e.api.rpc.history[t.envelope.id].xhr=o,e.api.rpc.history[t.envelope.id].status=i,e.api.rpc.history[t.envelope.id].failure=r,s={xhr:o,status:i,error:r},e.events.trigger("RPC_ERROR",s),e.events.trigger("RPC_COMPLETE",s),n!=null?typeof n.failure=="function"?n.failure(r):void 0:void 0):n!=null?typeof n.success=="function"?n.success(r.response.content,r.response.type,r):void 0:void 0},statusCode:{404:function(){return e.dev.error("RPC","HTTP/404","Could not resolve RPC action URI."),e.events.trigger("RPC_ERROR",{message:"RPC 404: Could not resolve RPC action URI.",code:404})},403:function(){return e.dev.error("RPC","HTTP/403","Not authorized to access the specified endpoint."),e.events.trigger("RPC_ERROR",{message:"RPC 403: Not authorized to access the specified endpoint.",code:403})},500:function(){return e.dev.error("RPC","HTTP/500","Internal server error."),e.events.trigger("RPC_ERROR",{message:"RPC 500: Woops! Something went wrong. Please try again.",code:500})}}},r=e.sys.drivers.resolve("transport");if(r.name==="amplify")e.dev.verbose("RPC","Fulfilling with AmplifyJS transport adapter."),o=r.driver.request,i=o(u);else{if(r.name!=="jquery")throw e.dev.error("RPC","Native RPC adapter is currently stubbed."),"[RPC]: No valid AJAX transport adapter found.";e.dev.verbose("RPC","Fulfilling with jQuery AJAX transport adapter.",u),i=jQuery.ajax(u.url,u)}return e.dev.verbose("RPC","Resulting XHR: ",i)}(e,n,r),{id:n.envelope.id,request:n}}},this.ext=null,this.registerAPIMethod=function(t,n,r,i){var s,u,a,f;if(e!=null?(f=e.sys)!=null?f.drivers:void 0:void 0){s=e.sys.drivers.resolve("transport","amplify");if(s!==!1)return e.dev.log("RPCAPI",'Registering request procedure "'+t+"."+n+'" with AmplifyJS.'),a=t+"."+n,u={accepts:"application/json",type:"POST",dataType:"json",contentType:"application/json",url:o.rpc._assembleRPCURL(n,t,null,r),decoder:o.rpc.decodeRPCResponse},i.caching!=null?(i.caching===!0&&(u.caching="persist"),s.request.define(a,"ajax",u)):s.request.define(a,"ajax",u)}}}return gt(n,e),n.mount="api",n.events=["RPC_CREATE","RPC_FULFILL","RPC_SUCCESS","RPC_ERROR","RPC_COMPLETE","RPC_PROGRESS"],n}(l),V=function(e){function t(){return}return gt(t,e),t.methods=[],t["export"]="private",t}(g),this.__apptools_preinit.abstract_base_classes.push(X),this.__apptools_preinit.abstract_base_classes.push(V),this.__apptools_preinit.abstract_base_classes.push(E),this.__apptools_preinit.abstract_base_classes.push(J),this.__apptools_preinit.abstract_base_classes.push(K),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:V,name:"transport"}),T=function(e){function t(e,t){this.current_user=null}return gt(t,e),t.mount="user",t.events=["SET_USER_INFO"],t.prototype.setUserInfo=function(e){return this.current_user=e.current_user||null,$.apptools.dev.log("UserAPI","Set server-injected userinfo: ",this.current_user),$.apptools.events.trigger("SET_USER_INFO",this.current_user)},t}(l),this.__apptools_preinit.abstract_base_classes.push(T),w=function(e){function t(e,t){var n=this;this.state={ready:!1,status:"init",transport:{sockets:[],channel:null},callbacks:{open:null,expect:null,activity:null,error:null,close:null},config:{token:null}},e.events.bridge(["PUSH_READY","PUSH_SOCKET_ESTABLISH","PUSH_SOCKET_ERROR","PUSH_SOCKET_OPEN","PUSH_SOCKET_CLOSE"],"PUSH_STATE_CHANGE"),e.events.hook("PUSH_SOCKET_OPEN",function(){var t;return t=1<=arguments.length?vt.call(arguments,0):[],e.api.rpc.alt_push_response=!0}),e.events.hook("PUSH_SOCKET_CLOSE",function(){var t;return t=1<=arguments.length?vt.call(arguments,0):[],e.api.rpc.alt_push_response=!1}),this.events={on_open:function(t){if(n.state.transport.sockets.length=0)n.state.status="ready";return e.events.trigger("PUSH_SOCKET_OPEN",n.state),e.dev.verbose("PushSocket","Message transport opened.")},on_message:function(t,r){var i;return n.state.status="receiving",e.dev.verbose("PushSocket","Message received.",r),e.events.trigger("PUSH_SOCKET_ACTIVITY",n.state),typeof (i=n.state.callbacks).activity=="function"&&i.activity(r),e.events.trigger("PUSH_SOCKET_ACTIVITY_FINISH",n.state)},on_error:function(t,r){return n.state.status="error",e.dev.error("PushSocket","Message transport error.",r),e.events.trigger("PUSH_SOCKET_ERROR",n.state)},on_close:function(t){return n.state.ready=!1,n.state.status="close",e.dev.verbose("PushSocket","Message transport closed."),e.events.trigger("PUSH_SOCKET_CLOSE",n.state)}},this.internal={open_channel:function(t){return e.events.trigger("PUSH_INIT",{token:t,type:"channel"}),n.state.config.token=t,n.state.transport.channel=new goog.appengine.Channel(n.state.config.token),n.internal._add_socket(n.state.transport.channel)},open_websocket:function(t,r){return e.events.trigger("PUSH_INIT",{token:t,server:r,type:"websocket"}),e.dev.log("Push","WARNING: WebSockets support is currently experimental."),n.internal._add_socket(n.state.transport.socket)},_add_socket:function(t,r){var i;return i=t.open(),n.state.transport.sockets.push(i),e.events.trigger("PUSH_SOCKET_ESTABLISH",i),i.onopen=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=n.events).on_open.apply(t,[i].concat(vt.call(e)))},i.onmessage=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=n.events).on_message.apply(t,[i].concat(vt.call(e)))},i.onerror=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=n.events).on_error.apply(t,[i].concat(vt.call(e)))},i.onclose=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=n.events).on_close.apply(t,[i].concat(vt.call(e)))},n.internal},expect:function(e,t,r){var i,s;return(i=n.state)!=null&&(s=i.callbacks)!=null&&typeof s.expect=="function"&&s.expect(e,t,r),n.internal}},this.channel={establish:function(e){return n.internal.open_channel(e)}},this.socket={establish:function(t,r){return r==null&&(r=null),n.internal.open_websocket(t,r||e.config.sockets.host)}},this.listen=function(e){return n.state.callbacks=_.defaults(e,n.state.callbacks),n.state.ready=!0,n.internal}}return gt(t,e),t.mount="push",t.events=["PUSH_INIT","PUSH_READY","PUSH_STATE_CHANGE","PUSH_SOCKET_OPEN","PUSH_SOCKET_ESTABLISH","PUSH_SOCKET_ACTIVITY","PUSH_SOCKET_ACTIVITY_FINISH","PUSH_SOCKET_ERROR","PUSH_SOCKET_CLOSE"],t}(l),z=function(e){function t(){return}return gt(t,e),t.methods=[],t["export"]="private",t}(g),this.__apptools_preinit.abstract_base_classes.push(z),this.__apptools_preinit.abstract_base_classes.push(w),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:z,name:"transport"}),S=function(e){function t(e,t){return}return gt(t,e),t.mount="render",t.events=["ADD_TEMPLATE","RENDER_TEMPLATE"],t["export"]="private",t.prototype._init=function(){},t}(l),Q=function(e){function t(){return}return gt(t,e),t["export"]="private",t.methods=["render","register_template"],t}(g),W=function(e){function t(){return}return gt(t,e),t["export"]="private",t.methods=["element_by_id","elements_by_class"],t}(g),ut=function(e){function t(){this.name="",this.source="",this.cacheable={rendered:!1,source:!1}}return gt(t,e),t}(q),this.__apptools_preinit.abstract_base_classes.push(W),this.__apptools_preinit.abstract_base_classes.push(Q),this.__apptools_preinit.abstract_base_classes.push(S),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:Q,name:"render"}),C=function(e){function t(e,t){var n=this;this._init=function(e){e.sys.state.add_flag("widgets"),e.dev.verbose("CoreWidget","Widget functionality is currently stubbed.")}}return gt(t,e),t.mount="widget",t.events=[],t}(l),N=function(e){function t(){var e=this;this._init=function(){}}return gt(t,e),t}(b),this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes==null&&(this.__apptools_preinit.abstract_base_classes=[]),this.__apptools_preinit.deferred_core_modules==null&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]},this.__apptools_preinit.abstract_base_classes.push(N),this.__apptools_preinit.abstract_base_classes.push(C),this.__apptools_preinit.deferred_core_modules.push({module:C}),I=function(e){function t(e,t,n){var r=this;this._state={modals:[],modals_by_id:{},init:!1},this.create=function(e,t){var n,i,s;return s=e.hasAttribute("data-options")?JSON.parse(e.getAttribute("data-options")):{},i=new F(e,t,s),n=i._state.element_id,r._state.modals_by_id[n]=r._state.modals.push(i)-1,i._init()},this.destroy=function(e){var t;return t=e._state.element_id,r._state.modals.splice(r._state.modals_by_id[t],1),delete r._state.modals_by_id[t],document.body.removeChild(ct.get(t)),e},this.enable=function(e){var t;return t=ct.get(e._state.trigger_id),ct.bind(t,"mousedown",e.open,!1),e},this.disable=function(e){return ct.unbind(ct.get(e._state.trigger_id)),e},this.get=function(e){return r._state.modals_by_id[e]||!1},this._init=function(){var e,t,n,i,s,o;t=ct.get("pre-modal");for(n=0,i=t.length;n<i;n++)e=t[n],s=r.create(e,o=ct.get("a-"+e.getAttribute("id"))),r.enable(s);return r._state.init=!0,r}}return gt(t,e),t.mount="modal",t.events=["MODAL_READY","MODAL_API_READY"],t}(C),F=function(e){function t(e,t,n){var r=this;this._state={cached_id:e.getAttribute("id"),cached_html:null,trigger_id:t.getAttribute("id"),element_id:null,overlay:null,active:!1,init:!1,config:{initial:{width:"0px",height:"0px",top:window.innerHeight/2+"px",left:window.innerHeight/2+"px"},ratio:{x:.4,y:.4},template:['<div id="modal-dialog" style="opacity: 0;" class="fixed dropshadow">','<div id="modal-fade" style="opacity: 0">','<div id="modal-content">&nbsp;</div>','<div id="modal-ui" class="absolute">','<div id="modal-title" class="absolute"></div>','<div id="modal-close" class="absolute">X</div>',"</div>","</div>","</div>"].join("\n"),rounded:!0,padding:null}},this._state.config=ct.extend(!0,this._state.config,n),this.internal={calc:function(){var e,t,n,i,s,o;return e={},i=r._state.config.ratio,o=window.innerWidth,s=window.innerHeight,n=Math.floor(i.x*o),t=Math.floor(i.y*s),e.width=n+"px",e.height=t+"px",e.left=Math.floor((o-n)/2),e.top=Math.floor((s-t)/2),e},classify:function(e,t){var n;if(t==="close"||t==null)return ct.in_array("dropshadow",n=e.classList)&&n.remove("dropshadow"),ct.in_array("rounded",n)&&n.remove("rounded"),e.style.padding="0px",e;if(t==="open")return ct.in_array("dropshadow",n=e.classList)||n.add("dropshadow"),!ct.in_array("rounded",n)&&r._state.config.rounded&&n.add("rounded"),e.style.padding="10px",e;if(e==null)return!1}},this.make=function(){var e,t,n,i,s,o,u,a,f,l,c,h,p,d;l=r._state.config.template,a=document.createRange(),a.selectNode(document.getElementsByTagName("div").item(0)),n=a.createContextualFragment(l),document.body.appendChild(n),i=ct.get("modal-dialog"),c=ct.get("modal-title"),t=ct.get("modal-content"),h=ct.get("modal-ui"),e=ct.get("modal-close"),s=ct.get("modal-fade"),o=r._state.cached_id,i.classList.add(i.getAttribute("id")),i.setAttribute("id",o+"-modal-dialog"),r._state.config.rounded&&i.classList.add("rounded"),d=r._state.config.initial;for(u in d)p=d[u],i.style[u]=p;return t.classList.add(t.getAttribute("id")),t.setAttribute("id",o+"-modal-content"),t.style.height=r.internal.calc().height,t.innerHTML=(f=ct.get(o)).innerHTML,c.classList.add(c.getAttribute("id")),c.setAttribute("id",o+"-modal-title"),c.innerHTML=f.getAttribute("data-title"),h.classList.add(h.getAttribute("id")),h.setAttribute("id",o+"-modal-ui"),e.classList.add(e.getAttribute("id")),e.setAttribute("id",o+"-modal-close"),s.classList.add(s.getAttribute("id")),s.setAttribute("id",o+"-modal-fade"),r._state.element_id=i.getAttribute("id"),r._state.cached_html=f.innerHTML,f.innerHTML="",i},this.open=function(){var e,t,n,i,s,o;return o=r._state.cached_id,t=ct.get(r._state.element_id),e=ct.get(o+"-modal-close"),r._state.active=!0,i=r.animation,n=r.animation,n.complete=function(){return r.internal.classify(t,"open"),$("#"+o+"-modal-fade").animate({opacity:1},i)},s=r.internal.calc(),s.opacity=1,t.style.display="block",$(t).animate(s,n),ct.bind(e,"mousedown",r.close),r},this.close=function(){var e,t,n;return t=r._state.cached_id,e=ct.get(r._state.element_id),ct.unbind(ct.get(t+"-modal-close"),"mousedown"),n=ct.extend({},r._state.config.initial,{opacity:.5}),ct.get(t+"-modal-content").style.overflow="hidden",$("#"+t+"-modal-fade").animate({opacity:0},{duration:300,complete:function(){return r.internal.classify(e,"close"),$(e).animate(n,{duration:200,complete:function(){return $(e).animate({opacity:0},{duration:250,complete:function(){var t,n,i;e.style.display="none",i=r._state.config.initial;for(t in i)n=i[t],e.style[t]=n;return r._state.active=!1}})}})}}),r},this._init=function(){var e;return e=r.make(),ct.get(r._state.trigger_id).removeAttribute("href"),r._state.init=!0,r}}return gt(t,e),t}(N),this.__apptools_preinit.abstract_base_classes.push(F),this.__apptools_preinit.abstract_base_classes.push(I),this.__apptools_preinit.deferred_core_modules.push({module:I,"package":"widgets"}),Y=function(e){function t(e,t,n){var r=this;this._state={scrollers:[],scrollers_by_id:{},init:!1},this.internal={make:function(e){return e=r.create(e),console.log("CREATED SCROLLER: ",e),e=r.enable(e),console.log("ENABLED SCROLLER: ",e),e}},this.create=function(e,t){var n,i;return t==null&&(t=e.hasAttribute("data-options")?JSON.parse(e.getAttribute("data-options")):{}),i=new G(e,t),n=i._state.element_id,r._state.scrollers_by_id[n]=r._state.scrollers.push(i)-1,i._init(),i},this.destroy=function(e){var t;return t=e._state.element_id,r._state.scrollers.splice(r._state.scrollers_by_id[t],1),delete r._state.scrollers_by_id[t],document.body.removeChild(ct.get(t)),e},this.enable=function(e){var t,n,r,i;i=e._state.panes,r=function(t,n){return console.log("[Scroller]","K: ",t),console.log("[Scroller]","V: ",n),ct.bind(ct.get(t),"mousedown",e.jump(n))};for(t in i)n=i[t],r(t,n);return e},this.disable=function(e){var t,n,r,i;i=e._state.panes;for(n=0,r=i.length;n<r;n++)t=i[n],ct.unbind(t,"mousedown");return e},this._init=function(){var e,t,n,i;t=ct.get("pre-scroller");if(!ct.is_array(t))r.internal.make(t);else for(n=0,i=t.length;n<i;n++)e=t[n],r.internal.make(e);return $.apptools.events.trigger("SCROLLER_API_READY",r),r._state.init=!0,r}}return gt(t,e),t.mount="scroller",t.events=["SCROLLER_READY","SCROLLER_API_READY"],t}(C),G=function(e){function t(e,t){var n=this;this._state={frame_id:e.getAttribute("id"),panes:{},current_pane:null,active:!1,init:!1,config:{axis:"horizontal"}},this._state.config=ct.extend(!0,this._state.config,t),this.classify=function(){var t,r,i,s,o;e=ct.get(n._state.frame_id),ct.in_array(e.classList,"pre-scroller")&&e.classList.remove("pre-scroller"),r=ct.get("scroller-pane",e),o=[];for(i=0,s=r.length;i<s;i++)t=r[i],o.push(function(t){var r;r="a-"+t.getAttribute("id"),n._state.panes[r]=t;if(n._state.config.axis==="horizontal")return t.classList.remove("left"),t.classList.remove("clear"),t.classList.add("in-table"),e.classList.add("nowrap");if(n._state.config.axis==="vertical")return e.classList.remove("nowrap"),t.classList.remove("in-table"),t.classList.add("left"),t.classList.add("clear")}(t));return o},this.jump=function(t){var r,i,s,o;n._state.active=!0,r=n.animation,r.complete=function(){return n._state.active=!1},n._state.current_pane=t.getAttribute("id"),s=ct.get_offset(e),o=ct.get_offset(t);if(n._state.config.axis==="horizontal")return i=Math.floor(o.left-s.left),$(e).animate({scrollLeft:"+="+i},r);if(n._state.config.axis==="vertical")return i=Math.floor(o.top-s.left),$(e).animate({scrollTop:"+="+i},r)},this._init=function(){return n.classify(),n._state.init=!0,$.apptools.events.trigger("SCROLLER_READY",n),n}}return gt(t,e),t}(N),this.__apptools_preinit.abstract_base_classes.push(G),this.__apptools_preinit.abstract_base_classes.push(Y),this.__apptools_preinit.deferred_core_modules.push({module:Y,"package":"widgets"}),ot=function(e){function t(e,t,n){var r=this;this._state={tabs:[],tabs_by_id:{},init:!1},this.create=function(e){var t,n,i;return n=e.hasAttribute("data-options")?JSON.parse(e.getAttribute("data-options")):{},i=new st(e,n),t=i._state.element_id,r._state.tabs_by_id[t]=r._state.tabs.push(i)-1,i._init()},this.destroy=function(e){var t;return t=e._state.element_id,r._state.tabs.splice(r._state.tabs_by_id,1),delete r._state.tabs_by_id[t],document.body.removeChild(ct.get(t)),e},this.enable=function(e){var t;for(t in e._state.tabs)ct.bind(ct.get(t),"mousedown",e["switch"],!1);return e},this.disable=function(e){var t;for(t in e._state.tabs)ct.unbind(ct.get(t),"mousedown");return e},this._init=function(){var e,t,n,i;t=ct.get("pre-tabs");for(n=0,i=t.length;n<i;n++)e=t[n],r.enable(r.create(e));return $.apptools.events.trigger("TABS_API_READY",r),r._state.init=!0}}return gt(t,e),t.mount="tabs",t.events=["TABS_READY","TABS_API_READY"],t}(l),st=function(e){function t(e,t){var n=this;this._state={element_id:e.getAttribute("id"),active_tab:null,tab_count:0,tabs:{},active:!1,init:!1,config:{rounded:!0,width:"500px"}},this._state.config=ct.extend(!0,this._state.config,t),this.internal={classify:function(){var t,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;e=ct.get(n._state.element_id),i=ct.filter(ct.get("div",e),s=function(t){return t.parentNode===e?!0:!1}),u=ct.filter(ct.get("a",e),s),e.style.width=n._state.config.width,g=["relative","tabset"];for(f=0,p=g.length;f<p;f++)t=g[f],e.classList.add(t);for(l=0,d=u.length;l<d;l++)o=u[l],n._state.config.rounded?o.classList.add("tab-rounded"):o.classList.add("tab-link");for(c=0,v=i.length;c<v;c++){r=i[c],y=["absolute","tab"];for(h=0,m=y.length;h<m;h++)a=y[h],r.classList.add(a)}return n}},this.make=function(){var t,r,i,s,o;e=ct.get(n._state.element_id),r=ct.get("a",e),i=function(e){var t,r,i;return t=ct.get(r=e.getAttribute("href").slice(1)),e.setAttribute("id",i="a-"+r),t==null?!1:(t.style.opacity=0,t.classList.remove("pre-tabs"),e.removeAttribute("href"),n._state.tabs[i]=r,n._state.tab_count++)};for(s=0,o=r.length;s<o;s++)t=r[s],i(t);return n.internal.classify()},this["switch"]=function(t){var r,i,s,o,u,a;return n._state.active=!0,s=ct.get(n._state.element_id),i=ct.get("tab-current",s),r=i!=null?i[0]:(a=n._state.active_tab)!=null?ct.get(a):!1,t!=null?t.preventDefault?(t.preventDefault(),t.stopPropagation(),e=ct.get(o=(u=t.target).getAttribute("id").split("-").splice(1).join("-"))):t!=null&&t.nodeType?(e=t,o=t.getAttribute("id")):(e=ct.get(t),o=t):e=ct.get(o=ct.get("a",s)[0].getAttribute("id").split("-").splice(1).join("-")),r===e?n:(console.log("Switching to tab: "+o),r===!1?(e.classList.add("tab-current"),$(e).animate({opacity:1},{duration:300,complete:function(){return n._state.active=!1}})):$(r).animate({opacity:0},{duration:200,complete:function(){return r.classList.remove("tab-current"),e.classList.add("tab-current"),n._state.active_tab=o,$(e).animate({opacity:1},{duration:300,complete:function(){return n._state.active=!1}})}}))},this._init=function(){var e;return e=n.make(),n["switch"](),n._state.init=!0,$.apptools.events.trigger("TABS_READY",n),n}}return gt(t,e),t}(N),this.__apptools_preinit.abstract_base_classes.push(st),this.__apptools_preinit.abstract_base_classes.push(ot),this.__apptools_preinit.deferred_core_modules.push({module:ot,"package":"widgets"}),L=function(e){function t(e,t,n){var r=this;this._state={editors:[],editors_by_id:{},init:!1},this.create=function(e){var t,n,i;return i=e.hasAttribute("data-options")?JSON.parse(e.getAttribute("data-options")):{},t=new k(e,i),n=t._state.element_id,r._state.editors_by_id[n]=r._state.editors.push(t)-1,t._init()},this.destroy=function(e){var t;return t=e._state.element_id,r._state.editors.splice(r._state.editors_by_id[t],1),delete r._state.editors_by_id[t],e},this.enable=function(e){var t;return t=ct.get(e._state.element_id),ct.bind(t,"dblclick",e.edit,!1),e},this.disable=function(e){return ct.unbind(ct.get(e._state.element_id),"dblclick"),e},this._init=function(){var e,t,n,i;t=ct.get("mini-editable");for(n=0,i=t.length;n<i;n++)e=t[n],r.enable(r.create(e));return $.apptools.events.trigger("EDITOR_API_READY",r)}}return gt(t,e),t.mount="editor",t.events=["EDITOR_READY","EDITOR_API_READY"],t}(C),k=function(e){function t(e,t){var n=this;this._state={element_id:e.getAttribute("id"),pane_id:null,active:!1,init:!1,config:{bundles:{plain:{save:function(){return this.save()}},basic:{b:function(){return document.execCommand("bold")},u:function(){return document.execCommand("underline")},i:function(){return document.execCommand("italic")},clear:function(){return document.execCommand("removeFormat")},undo:function(){return document.execCommand("undo")},redo:function(){return document.execCommand("redo")},cut:function(){return document.execCommand("cut")},paste:function(){return document.execCommand("paste")}},rich:{h1:function(){return document.execCommand("heading",!1,"h1")},h2:function(){return document.execCommand("heading",!1,"h2")},h3:function(){return document.execCommand("heading",!1,"h3")},fontColor:function(){var e,t;return e=ct.toHex(prompt("Please enter hex (#000000) or RGB (rgb(0,0,0)) values.")),t=document.selection()||window.getSelection(),document.execCommand("insertHTML",!1,'<span style="color: '+e+';">'+t+"</span>")},fontSize:function(){var e,t;return e=prompt("Please enter desired numerical pt size (i.e. 10)"),t=document.selection()||window.getSelection(),document.execCommand("insertHTML",!1,'<span style="font-size: '+e+';">'+t+"</span>")},left:function(){return document.execCommand("justifyLeft")},right:function(){return document.execCommand("justifyRight")},center:function(){return document.execCommand("justifyCenter")},indent:function(){return document.execCommand("indent")},outdent:function(){return document.execCommand("outdent")},link:function(){var e,t,n;return t=document.selection()||window.getSelection(),t!=null&&t.match(/^http|www/)?(n=t,t=prompt("What link text do you want to display?")):t==null&&(t=prompt("What link text do you want to display?")),e=n||prompt("What URL do you want to link to? (http://www...)"),document.execCommand("insertHTML",!1,'<a href="'+ct.strip_script(e+'">'+t+"</a>"))}}},bundle:"rich",width:150}},this._state.config=ct.extend(!0,this._state.config,t),this.make=function(){var e,t,r,i,s,o,u,a,f,l,c,h,p;a=ct.get(f=n._state.element_id),h=n._state.config.width,o=document.createElement("div"),o.setAttribute("id",u="editor-pane-"+f),o.classList.add("absolute"),o.style.width=h+"px",o.style.left=(l=ct.get_offset(a)).left-h+"px",o.style.top=l.top+"px",o.style.zIndex="9990",o.style.opacity=0,i=n._state.config.bundles.plain;if(n._state.config.bundle==="rich"){p=n._state.config.bundles.rich;for(s in p)c=p[s],i[s]=c}for(r in i)t=i[r],e=document.createElement("button"),e.value=e.innerHTML=r,e.className="editorbutton",ct.bind(e,"mousedown",t),o.appendChild(e);return document.body.appendChild(o),n._state.pane_id=u,o},this.show=function(){var e;return $("#"+(e=n._state.pane_id)).animate({opacity:1},ct.prep_animation()),n},this.hide=function(){return $("#"+n._state.pane_id).animate({opacity:0},ct.prep_animation()),n},this.edit=function(){var e;return n.show(),(e=ct.get(n._state.element_id)).contentEditable=!0,n._state.active=!0,ct.bind(e,"dblclick",n.save),e.focus(),n},this.save=function(){var e;return console.log("Saving..."),n.hide(),(e=ct.get(n._state.element_id)).contentEditable=!1,n._state.active=!1,ct.unbind(e,"dblclick"),n},this._init=function(){var e;return e=this.make(),document.body.appendChild(e),this._state.init=!0,$.apptools.events.trigger("EDITOR_READY",this),this}}return gt(t,e),t}(N),this.__apptools_preinit.abstract_base_classes.push(k),this.__apptools_preinit.abstract_base_classes.push(L),this.__apptools_preinit.deferred_core_modules.push({module:L,"package":"widgets"}),lt=function(e){function t(e,t,n){var r=this;this._state={uploaders:[],uploaders_by_id:{},init:!1},this.create=function(e){var t,n,i;return n=e.hasAttribute("data-options")?JSON.parse(e.getAttribute("data-options")):{},i=new ft(e,n),t=i._state.element_id,r._state.uploaders_by_id[t]=r._state.uploaders.push(i)-1,i._init()},this.destroy=function(e){var t;return t=e._state.element_id,r._state.uploaders.splice(r._state.uploaders_by_id[t],1),delete r._state.uploaders_by_id[t],e},this.enable=function(e){var t;return t=ct.get(e._state.element_id),ct.bind(t,["dragenter","dragexit","dragleave"],e.handle),ct.bind(t,"dragover",ct.debounce(e.handle,200,!0)),ct.bind(t,"drop",e.upload),e},this.disable=function(e){var t;return t=ct.get(e._state.element_id),ct.unbind(t,"dragenter","dragover","dragexit","dragleave","drop"),e},this.get=function(e){var t;return(t=r._state.uploaders_by_id[e])!=null?r._state.uploaders[t]:!1},this._init=function(e){var t,n,i,s;n=ct.get("pre-uploader");for(i=0,s=n.length;i<s;i++)t=n[i],r.enable(r.create(t));return e.events.trigger("UPLOADER_API_READY",r),r._state.init=!0
}}return gt(t,e),t.mount="uploader",t.events=["UPLOADER_READY","UPLOADER_API_READY"],t}(l),ft=function(e){function t(e,t){var n=this;this._state={element_id:e.getAttribute("id"),boundary:null,active:!1,init:!1,config:{boundary_base:"d4v1dR3K0W",banned_types:["application/exe"],banned_extensions:[".exe"],max_cache:15},cache:{uploads_by_type:{},uploaded:[]}},this._state.config=ct.extend(!0,this._state.config,t),this.internal={allow:function(e){var t,r;return t=e.name.split(".").pop(),r=e.type,ct.in_array(t,n._state.config.banned_extensions)?!1:ct.in_array(r,n._state.config.banned_types)?!1:!0},finish:this._state.config.finish||function(e,t){return!0},prep_body:function(e,t){var r,i,s;return n.internal.allow(e)?(i=n._state.boundary,s="\r\n",r="--"+i+s,r+='Content-Disposition: form-data; filename="'+e.name+'"'+s,r+="Content-type: "+e.type+s+s,r+=t+s+i+"--",r):!1},preview:function(e){},progress:function(e,t){return t.upload.onprogress=function(t){var n,r;r=e.name.split(".")[0];if(t.lengthComputable)return n=Math.floor(t.loaded/t.total*100),n}},provision_boundary:function(){var e,t,r,i,s,o,u;i=["-----"],e=n._state.config.boundary_base,r=Math.floor(Math.pow(Math.random()*1e4,3)),u=r.toString().split("");for(s=0,o=u.length;s<o;s++)t=u[s],i.push(e[t]);return i.push("-----"),i.join("")},read:function(e,t){var n;return n=new FileReader,n.file=e,n.onloadend=t,n.readAsBinaryString(e)},ready:function(e,t){return t.onreadystatechange=function(){if(t.readyState=4)return(t.status=200)?n.internal.update_cache(e,t,function(e,t){return n.internal.finish(e,t)}):!1}},send:function(e,t,r){var i,s;return s=new XMLHttpRequest,i=n.internal.prep_body(e,t),n.internal.progress(e,s),s.open("POST",r,!0),s.setRequestHeader("Content-type","multipart/form-data; boundary="+n._state.boundary),n.internal.ready(e,s),apptools.dev.verbose("UPLOADER","About to upload file: "+e.name),i?s.send(i):!1},update_cache:function(e,t,r){var i,s,o,u,a,f;return(u=n._state.cache.uploads_by_type)[a=e.type]!=null?u[a]++:u[a]=o=e.name,(f=n._state.cache.uploaded).push(o),(i=f.length)>(s=n._state.config.max_cache)&&(f=f.splice(i-s)),r!=null?r.call(n,e,t):void 0}},this.handle=function(t){console.log("EVENT OF TYPE "+t.type+" CAPTURED"),t.preventDefault&&(t.preventDefault(),t.stopPropagation()),e=t.target;switch(t.type){case"dragenter":case"dragover":return e.style.border="2px dashed green";case"dragexit":case"dragleave":return e.style.border="2px solid transparent"}},this.upload=function(e){var t,r,i,s,o;e.preventDefault&&(e.preventDefault(),e.stopPropagation()),r=e.dataTransfer.files||[],o=[];for(i=0,s=r.length;i<s;i++)t=r[i],o.push($.apptools.api.assets.generate_upload_url().fulfill({success:function(e){return n.internal.read(t,function(t){var r,i;return t.preventDefault(),t.stopPropagation(),i=t.target.file,r=t.target.result,n.internal.send(i,r,e.url)})},failure:function(e){return apptools.dev.error("UPLOADER","Upload failed with error: "+e+" :(")}}));return o},this._init=function(e){return n._state.boundary=n.internal.provision_boundary(),n._state.init=!0,e.events.trigger("UPLOADER_READY",n),n}}return gt(t,e),t}(N),this.__apptools_preinit.abstract_base_classes.push(ft),this.__apptools_preinit.abstract_base_classes.push(lt),this.__apptools_preinit.deferred_core_modules.push({module:lt,"package":"widgets"}),c=function(e){function t(){return this._init=yt(this._init,this),t.__super__.constructor.apply(this,arguments)}return gt(t,e),t.mount="admin",t.events=[],t.prototype._init=function(e){e.sys.state.add_flag("admin"),e.dev.log("AdminAPI","NOTICE: Admin APIs are enabled.")},t}(l),this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes==null&&(this.__apptools_preinit.abstract_base_classes=[]),this.__apptools_preinit.deferred_core_modules==null&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]},this.__apptools_preinit.abstract_base_classes.push(c),this.__apptools_preinit.deferred_core_modules.push({module:c}),a=function(e){function t(e,t){e.dev.verbose("BlogManager","AppToolsXMS BlogManager is currently stubbed.")}return gt(t,e),t.mount="blog",t.events=[],t}(c),this.__apptools_preinit.abstract_base_classes.push(a),this.__apptools_preinit.deferred_core_modules.push({module:a,"package":"admin"}),R=function(e){function t(e,t,n){e.dev.verbose("PageManager","AppToolsXMS PageManager is currently stubbed.")}return gt(t,e),t.mount="page",t.events=["PAGE_EDIT","PAGE_SAVE","PAGE_META_SAVE"],t}(c),this.__apptools_preinit.abstract_base_classes.push(R),this.__apptools_preinit.deferred_core_modules.push({module:R,"package":"admin"}),nt=function(e){function t(e,t,n){e.dev.verbose("SiteManager","AppToolsXMS SiteManager is currently stubbed.")}return gt(t,e),t.mount="site",t.events=["SITE_EDIT","SITE_SAVE","SITE_META_SAVE"],t}(c),this.__apptools_preinit.abstract_base_classes.push(nt),this.__apptools_preinit.deferred_core_modules.push({module:nt,"package":"admin"}),f=function(e){function t(e){var t,n,r,i,s,o,u=this;n=!1,s={},i={},t=0,r={panel:{commands:{undo:function(){return document.execCommand("undo")},redo:function(){return document.execCommand("redo")},cut:function(){return document.execCommand("cut")},paste:function(){return document.execCommand("paste")},table:function(){return document.execCommand("enableInlineTableEditing")},resize:function(){return document.execCommand("enableObjectResizing")},clip:null,b:function(){return u.config.panel.commands.html("b")},u:function(){return u.config.panel.commands.html("u")},i:function(){return u.config.panel.commands.html("i")},clear:function(){return document.execCommand("removeFormat")},h1:function(){return u.config.panel.commands.html("h1",'class="h1"')},h2:function(){return u.config.panel.commands.html("h2",'class="h2"')},h3:function(){return u.config.panel.commands.html("h3",'class="h3"')},fontColor:function(){var e;return e=prompt("Please enter a hexidecimal color value (i.e. #ffffff)"),e=e[0]==="#"?e:"#"+e,u.config.panel.commands.html("span",'style="color:'+String(e+';"'))},fontSize:function(){var e;return e=prompt("Please enter desired point size (i.e. 10)"),u.config.panel.commands.html("span",'style="font-size:'+String(e+'pt;"'))},fontFace:null,l:function(){return document.execCommand("justifyLeft")},r:function(){return document.execCommand("justifyRight")},c:function(){return document.execCommand("justifyCenter")},"in":function(){return document.execCommand("indent")},out:function(){return document.execCommand("outdent")},bullet:function(){return document.execCommand("insertUnorderedList")},number:function(){return document.execCommand("insertOrderedList")},indentSpecial:null,lineSpacing:null,link:function(){var e,t;return t=document.selection?document.selection():window.getSelection(),u.util.is(t)||(t=prompt("What link text do you want to display?")),e=prompt("What URL do you want to link to?"),u.config.panel.commands.html("a",'href="'+e+'"')},image:null,video:null,html:function(e,t){var n;return n=document.selection?document.selection():window.getSelection(),u.util.is(t)?document.execCommand("insertHTML",!1,"<"+e+" "+t+">"+n+"</"+e+">"):document.execCommand("insertHTML",!1,"<"+e+">"+n+"</"+e+">")}},panel_html:['<div id="CMS_wrap">','<div id="CMS_panel" class="fixed panel">','<div id="CMS_frame" class="nowrap">','<div class="cms_pane" id="editing">','<div class="cms_subpane">','<h1 class="cms_sp">editing</h1>',"<p>",'<button id="cms_undo" value="undo">undo</button>','<button id="cms_redo" value="redo">redo</button>','<button id="cms_cut" value="cut">cut</button>','<button id="cms_paste" value="paste">paste</button>',"<br>",'<button id="cms_clear" value="clear formatting">clear formatting</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">typography</h1>',"<p>",'<select id="cms_headers" class="cms">','<option id="cms_h1" class="h1">Heading 1</option>','<option id="cms_h2" class="h2">Heading 2</option>','<option id="cms_h3" class="h3">Heading 3</option>',"</select>",'<button id="cms_b" value="bold">B</button>','<button id="cms_u" value="underline">U</button>','<button id="cms_i" value="italic">I</button>',"<br>",'<button id="cms_fontColor" value="font color">font color</button>','<button id="cms_fontSize" value="font size">font size</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">alignment</h1>',"<p>",'<button id="cms_l" value="left">left</button>','<button id="cms_c" value="center">center</button>','<button id="cms_r" value="right">right</button>','<button id="cms_in" value="indent">&raquo;</button>','<button id="cms_out" value="outdent">&laquo;</button>',"</p>","</div>","<hr>",'<div class="cms_subpane">','<h1 class="cms_sp">lists</h1>',"<p>",'<button id="cms_bullet" value="unordered list">bulleted</button>','<button id="cms_number" value="ordered list">numbered</button>','<button class="cms_disabled" id="cms_outline" value="outline">outline</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">interactive</h1>',"<p>",'<button id="cms_link" value="link">add link</button>',"</p>","</div>","</div>",'<div class="cms_pane" id="content">','<div class="cms_subpane">','<h1 class="cms_sp">pages</h1>','<div id="acco-page-manager-pane" class="acco-wrap">','<div id="acco-page-manager" class="accordion">','<a class="acco" href="#page-1">main page</a>','<div id="#acco-pages-page-1" class="acco-btf block">','<a class="pop" href="javascript:void(0)">subpage 1</a><br>','<a class="pop" href="javascript:void(0)">subpage 2</a>',"</div>",'<a class="acco" href="#page-2">second page</a>','<div id="#acco-pages-page-2" class="acco-btf block">','<a class="pop" href="javascript:void(0)">another subpage 1</a><br>','<a class="pop" href="javascript:void(0)">another subpage 2</a>',"</div>",'<a class="acco" href="#page-3">third page</a>','<div id="#acco-pages-page-3" class="acco-btf block">','<a class="pop" href="javascript:void(0)">yep, subpage 1</a><br>','<a class="pop" href="javascript:void(0)">yep, subpage 2</a>',"</div>","</div>","</div>","</div>","</div>",'<div class="cms_pane" id="assets">','<div class="cms_subpane">','<h1 class="cms_sp">drop files here</h1>','<div id="upload_wrap">','<div id="upload" class="dragdrop">','<span class="center-text" id="up_content">+</span>',"</div>","</div>","</div>","<hr>",'<div class="cms_subpane">','<h1 class="cms_sp">uploaded assets</h1>','<div id="upload-files-pane">',"</div>","</div>","</div>","</div>",'<div id="CMS_nav">','<a class="scroll" href="#editing">editing</a>','<a class="scroll" href="#content">content</a>','<a class="scroll" href="#assets">assets</a>',"</div>",'<div id="CMS_panel_footer">&copy; momentum labs 2012</div>',"</div>","</div>"].join("\n"),status_html:'<div class="fixed panel bigger" id="cms_edit_on" style="vertical-align: middle; left: -305px;top: 50px;width: 300px;text-align: right;padding-right: 10px;opacity: 0;"><span id="cms_span" style="color: #222;cursor: pointer">content editing <span style="color: green;font-weight: bold;">ON</span></span></div>',init:!1},scroller:{animation:{duration:500,easing:"easeInOutExpo",complete:null},axis:"horizontal",frame:"CMS_frame",init:!1},pop:{animation:{duration:500,easing:"easeInOutExpo",complete:null},position:{bottom:"60px",right:"60px"},init:!1},modal:{animation:{duration:400,easing:"easeInOutExpo",complete:null},initial:{width:"0px",height:"0px",top:window.innerHeight/2+"px",left:window.innerWidth/2+"px"},ratio:{x:.4,y:.4},html:['<div id="modal_wrap" style="opacity: 0;" class="modal_wrap">','<div id="modal" style="opacity: 0;" class="fixed modal">','<div id="modal_status"></div>','<div id="modal_content">',"*****","</div>",'<div id="modal_ui"><button id="mod-close">close</button></div>',"</div>","</div>"].join("\n"),content:'<span style="font-size: 25px;margin: 10px auto;color: #5f5f5f;font-weight:bold">hello, lightbox!</span>',rounded:!0,init:!1},accordion:{animation:{duration:400,easing:"easeInOutExpo",complete:null},init:!1},overlay:'<div id="m-overlay" class="fixed" style="opacity: 0;"></div>',init:!1},this.config=$.extend(!0,{},r),this.util={bind:function(e,t,n){var r;return r={},r[t]=n,e.bind(r)},calcModal:function(){var e,t,n,r,i,s;return r={},n=u.config.modal.ratio,s=window.innerWidth,i=window.innerHeight,t=Math.floor(n.x*s),e=Math.floor(n.y*i),r.width=t+"px",r.height=e+"px",r.top=Math.floor((i-e)/2),r.left=Math.floor((s-t)/2),r},imagePreview:function(e){var t,n;return t=function(e){var t,n;return n=e.target.result,t=e.target.file.name.split(".")[0],$("#landing-"+t).append('<img id="'+t+'" src="'+n+'">')},n=new FileReader,n.file=e,n.addEventListener("loadend",t,!1),n.readAsDataURL(e)},is:function(e){return $.inArray(e,[!1,null,NaN,void 0,0,{},[],"","false","False","null","NaN","undefined","0","none","None"])===-1?!0:!1},isID:function(e){return String(e).split("")[0]==="#"||document.getElementById(e)!==null?!0:!1},handleDrag:function(e){var t;e.preventDefault(),e.stopPropagation(),t=e.target;if(e.type==="dragenter")return $(t).addClass("hover");if(e.type!=="dragover")return $(t).removeClass("hover")},makeDragDrop:function(e){return e.addEventListener("dragenter",u.util.handleDrag,!1),e.addEventListener("dragexit",u.util.handleDrag,!1),e.addEventListener("dragleave",u.util.handleDrag,!1),e.addEventListener("dragover",u.util.handleDrag,!1),e.addEventListener("drop",u.uploadAsset,!1)},makeProgressBar:function(){return!1},wrap:function(e){var t;return t=Array.prototype.slice.call(arguments,1),function(){return e.apply(this,t)}}},this.edit=function(e){var t,r,o;return r=$(e),o=r.offset(),t=r.attr("id"),console.log("Enabling inline editing of #"+t),e.contentEditable=!0,n=!0,s[t]=r.attr("style"),i[t]=r.html(),r.unbind("click"),$("body").append(u.config.overlay),$("#m-overlay").animate({opacity:.75},{duration:400,easing:"easeInOutExpo"}),r.css({"z-index":function(){var e;return e=900+Math.floor(Math.random()*81)}}),r.offset(o),u.util.isID("CMS_panel")||(u.panel.make(),u.panel.live()),$("#m-overlay").bind({click:u.util.wrap(u.save,e)})},this.save=function(e){var r,s,o,a,f;return o=$(e),r=o.attr("id"),a=o.html(),s=o.data("snippet-keyname")?o.data("snippet-keyname"):"default-key",f=u,e.contentEditable=!1,n=!1,u.panel.destroy(),u.util.bind(o,"click",u.util.wrap(u.edit,e)),u.util.isID("CMS_sync")||$("body").append('<div class="cms_message warn" id="CMS_sync" style="top: 50px;opacity: 0;"><div id="sync_loader" class="loader">syncing changes...</div></div>'),$("#m-overlay").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){$("#m-overlay").remove();if(a!==i[r])return $("#CMS_sync").animate({opacity:1},{duration:700,easing:"easeInOutExpo",complete:function(){return t++,f.sync({snippet_keyname:s,inner_html:a})}})}})},this.sync=function(e){var n;return n=u,$.apptools.dev.verbose("CMS","Initiating sync operation for snippet.",e),$.apptools.api.content.save_snippet(e).fulfill({success:function(){return t-1===0?($("#CMS_sync").html("changes saved!"),$("#CMS_sync").removeClass("warn").removeClass("error").addClass("yay"),setTimeout(function(){return $("#CMS_sync").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){return $("#CMS_sync").remove()}})},700),t--):t--},failure:function(t){return $("#CMS_sync").html("error syncing page."),$("#CMS_sync").removeClass("warn").addClass("error"),setTimeout(function(){return $("#CMS_sync").append('<br><a id="sync_retry" style="pointer: cursor;text-decoration: underline;">retry sync</a>'),n.util.bind($("#sync_retry"),"click",n.util.wrap(n.sync,e))},1500)}})},this.revert=function(e){var t;return t=$(e).data("snippet-keyname"),$.apptools.api.content.revert_snippet({snippet_keyname:t}).fulfill({success:function(){return $(_o).html(response.inner_html),$("body").append('div id="CMS_revert" class="cms_message yay" style="opacity: 0;">changes reverted!</div>'),$("#CMS_revert").animate({opacity:1},{duration:400,easing:"easeInOutExpo",complete:function(){return setTimeout(function(){return $("#CMS_revert").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){return $("#CMS_revert").remove()}})},700)}})},failure:function(e){return $("#CMS_revert").html("error reverting page."),$("#CMS_revert").removeClass("warn").addClass("error")}})},this.uploadAsset=function(e){var t,n,r,i,s,o;e.preventDefault(),e.stopPropagation(),$(e.target).removeClass("hover"),r=e.dataTransfer.files,t=function(e){var t,n,r,i;return i=e.name.split(".")[0],n="li-"+i,r="upload-percentage-"+i,t="upload-progress-"+i,u.util.isID("upload-files-list")||$("#upload-files-pane").append('<ul id="upload-files-list"></ul>'),$("#upload-files-list").append('<li id="'+n+'"></li>'),$("#"+n).append('<div class="upload-preview-landing" id="landing-'+i+'"></div>').append('<span class="upload-percentage" id="'+r+'">1%</span>').append('<div class="upload-progress" id="'+t+'">&nbsp;</div>'),u.util.imagePreview(e),$.apptools.api.assets.generate_upload_url().fulfill({success:function(t){var n,r;return r=function(e){var n,r,i,s,o,u;return r="-------m0m3n+umUPL04D3R-------",i="\r\n",o=new XMLHttpRequest,n="--"+r+i,s=e.target.result,u=e.target.file,n+='Content-Disposition: form-data; filename="'+u.name+'"'+i,n+="Content-type: "+u.type+i+i,n+=s+i+r+"--",o.upload.addEventListener("progress",function(e){var t,n,r;r=u.name.split(".")[0];if(e.lengthComputable)return t=Math.floor(e.loaded/e.total*100),n=Math.floor(e.loaded/e.total*128),$("#upload-percentage-"+r).html(t+"%"),$("#upload-progress-"+r).css({width:n})},!1),o.open("POST",t.url,!0),o.setRequestHeader("Content-type","multipart/form-data; boundary="+r),o.onreadystatechange=function(){var e;if(o.readyState===4)return e=u.name.split(".")[0],$.apptools.dev.verbose("UPLOAD","file name: "+e),$("#upload-progress-"+e).addClass("upload-done").removeClass("upload-progress"),o.status===200?$.apptools.dev.verbose("UPLOAD","Upload succeeded!"):$.apptools.dev.verbose("UPLOAD","Upload completed but returned status "+o.status)},$.apptools.dev.verbose("UPLOAD","Uploading "+u.name+"..."),o.send(n)},n=new FileReader,n.file=e,n.addEventListener("loadend",r,!1),n.readAsBinaryString(e)},failure:function(e){return $.apptools.dev.error("UPLOAD","UPLOAD FAILED WITH ERROR: "+e)}})},o=[];for(i=0,s=r.length;i<s;i++)n=r[i],o.push(t(n));return o},this.placeAsset=function(e){},this.panel={make:function(){var e;return e=u.config.panel.panel_html,$("body").append(e),$("#CMS_panel").css({bottom:"0px"}),$("#CMS_wrap").css({opacity:1}),$("#CMS_panel").animate({bottom:"60px",opacity:1},{duration:500,easing:"easeInOutExpo"})},live:function(){var e,t,n,r,i,s;n=u.config.panel.commands,r=u.config.scroller.frame,s=document.getElementById("upload"),i=u,$(".scroll").each(function(){var e,t,n;return n=this,e=$(n),t=String(e.attr("href")).slice(1),e.attr("id","scr"+t),e.attr("href","javascript:void(0);"),$("#"+r).data("scroller",{axis:"horizontal"}),i.util.bind(e,"click",i.util.wrap(i.scroller.jump,t)),i.config.scroller.init=!0}),u.scroller.classify(r),$(".acco").each(function(){var e,t,n;return n=this,e=$(n),t=String(e.attr("href")).slice(1),e.attr("href","javascript:void(0);"),e.attr("id","a-"+t),i.util.bind(e,"click",i.util.wrap(i.accordion.fold,t))}),u.accordion.fold("page-1"),$(".pop").each(function(){var e,t,n;return n=this,e=$(n),t=e.attr("name"),e.removeAttr("name"),e.data("pop",{target:t}),i.util.bind(e,"click",i.util.wrap(i.pop.pop,t)),i.config.pop.init=!0}),u.util.makeDragDrop(s);for(t in n)e=n[t],u.util.bind($("#cms_"+t),"click",e);return u.config.panel.init=!0},die:function(){var e,t,n,r;n=u.config.panel.commands,r=[];for(t in n)e=n[t],r.push($("#cms_"+t).unbind("click"));return r},destroy:function(){var e;$("#m-overlay").unbind(),e=!0;if(n===!1)return $("#CMS_panel").animate({opacity:0,bottom:"0px"},{duration:450,easing:"easeInOutExpo",complete:function(){return e===!0?$("#CMS_wrap").remove():$("#CMS_wrap").css({opacity:1})}})},toggle:function(){return u.util.is($("#CMS_panel"))?(u.panel.destroy,$("#cms_span").html("&gt;")):(u.panel.make(),u.panel.live(),$("#cms_span").html("x"))}},this.scroller={classify:function(e){var t,n;t=$("#"+e),n=t.data("scroller");if(n.axis==="horizontal"||!u.util.is(n.axis))return $(".cms_pane").removeClass("left").removeClass("clear").addClass("in-table"),t.addClass("nowrap");if(n.axis==="vertical")return t.removeClass("nowrap"),$(".cms_pane").removeClass("in-table").addClass("left").addClass("clear")},jump:function(e,t,n){var r,i,s,o,a,f;u.util.is(n)&&(n.preventDefault(),n.stopPropagation()),i=$("#"+u.config.scroller.frame),r=i.data("scroller"),s=u.util.is(t)?$.extend({},u.config.scroller.animation,{complete:t}):u.config.scroller.animation,a=i.offset(),f=$("#"+e).offset();if(r.axis==="vertical")return o=Math.floor(f.top-a.top),i.animate({scrollTop:"+="+o},s);if(r.axis==="horizontal")return o=Math.floor(f.left-a.left),i.animate({scrollLeft:"+="+o},s)}},this.pop={pop:function(e){var t,n,r,i,s,o,a,f,l;return l=u,t=$("#"+e),s="pop_"+e,r=s+"_button",a=u.config.pop.position,i=t.html(),f=t.prev().attr("id"),$b.unbind("click"),n=$.extend({},u.config.pop.animation,{complete:function(){return t.remove(),$("#"+r).html("pop back in"),l.util.bind($("#"+r),"click",l.util.wrap(l.pop.reset,e,"CMS_frame")),l.util.makeDragDrop(document.getElementById("upload"))}}),o='<div id="'+s+'" class="fixed panel" style="opacity:0;">'+i+"</div>",$("body").append(o),$("#"+s).css({bottom:"0px",right:a.right,"z-index":989}),$("#"+s).animate({bottom:a.bottom,opacity:1},n),u.scroller.jump(f)},reset:function(e,t){var n,r,i,s,o;return t===!1||!u.util.is(t)?$("#pop_"+e).remove():(o=u,s="pop_"+iD,n=$("#"+t),i=s+"_button",$(i).unbind("click"),r=$.extend({},u.config.pop.animation,{complete:function(){return $("#"+s).remove(),$("#"+i).html("pop me out"),o.util.bind($("#"+i),"click",o.util.wrap(o.pop.pop,e)),o.util.makeDragDrop(document.getElementById("upload"))}}))}},this.modal={show:function(e,t,n){var r,i,s,o,u,a;return r={opacity:1},u=this.util.is(n)?$.extend({},this.config.modal.animation,{complete:n}):this.config.modal.animation,a=this.config.modal.html.split("*****"),i=a[0]+t+a[1],o=Math.floor(this.config.modal.ratio.x*window.innerWidth),s=Math.floor(this.config.modal.ratio.y*window.innerHeight),r.width=o+"px",r.height=s+"px",r.top=Math.floor((window.innerHeight-s)/2),r.left=Math.floor((window.innerWidth-o)/2),$("body").append(this.config.overlay),$("#m-overlay").animate({opacity:.5},{duration:400,easing:"easeInOutExpo",complete:function(){return this.util.bind($("#m-overlay"),"click",this.modal.hide)}}),$("body").append(i),$("#modal-wrap").css({opacity:1}),this.config.modal.rounded&&$("#modal").addClass("rounded"),$("#modal").css(this.config.modal.initial),$("#modal").animate(r,u),this.util.bind($("#mod-close"),"click",this.modal.hide)},hide:function(){var e,t;return e=$("#modal"),t=$.extend({},this.config.modal.initial,{left:"0px",width:window.innerWidth,right:"0px",opacity:.5}),setTimeout(function(){return e.removeClass("rounded"),e.css({padding:0})},150),e.animate(t,{duration:400,easing:"easeInOutExpo",complete:function(){return e.animate({opacity:0},{duration:250,easing:"easeInOutExpo"}),$("#m-overlay").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){return $("#m-overlay").remove(),$("#modal_wrap").remove()}})}})}},this.accordion={fold:function(e){var t,n;e=e!==null&&typeof e!="undefined"?e:u.config.accordion.home,n="#acco-pages-"+e;if($(n).hasClass("none")){$(n).css({height:"0px"}),t=$(".current-fold").attr("id")?$(".current-fold").attr("id").slice(2):!1;if(t!==!1)return $(".current-fold").removeClass("current-fold"),$("#"+t).animate({height:"0px",opacity:0},{duration:400,easing:"easeInOutExpo",complete:function(){if("#"+t!==n)return $("#"+t).removeClass("block").addClass("none")}}),$(n).removeClass("none").addClass("block"),$("#a-"+e).addClass("current-fold"),$(n).animate({height:"350px",opacity:1},{duration:400,easing:"easeInOutExpo"});if($(n).hasClass("block"))return $("#a-"+e).removeClass("current-fold"),$(n).animate({height:"0px",opacity:0},{duration:400,easing:"easeInOutExpo",complete:function(){return $(n).removeClass("block").addClass("none")}})}}},e.dev.verbose("CMS","Initializing Momentum extensible management system..."),o=this,$("body").append(this.config.panel.status_html),setTimeout(function(){return $("#cms_span").animate({opacity:1},{duration:450,easing:"easeInOutExpo"}),$("#cms_edit_on").animate({opacity:1,left:"-155px"},{duration:400,easing:"easeInOutExpo",complete:function(){return setTimeout(function(){return $("#cms_edit_on").animate({left:"-290px"},{duration:400,easing:"easeInOutExpo",complete:function(){return o.util.bind($("#cms_edit_on"),"click",o.panel.toggle),o.panel.toggle()}})},1750)}})},500),$(".editable").each(function(){var e=this;o.util.bind($(e),"click",o.util.wrap(o.edit,e))})}return gt(t,e),t}(l),this.__apptools_preinit.abstract_base_classes.push(f),this.__apptools_preinit.deferred_core_modules.push({module:f,"package":"admin"}),t=function(){function e(e){var t,n,r,i,s,o=this;this.config={rpc:{base_uri:"/_api/rpc",host:null,enabled:!0},sockets:{host:null,enabled:!1}},this.lib={},this.sys={platform:{},version:this.version,core_events:["SYS_MODULE_LOADED","SYS_LIB_LOADED","SYS_DRIVER_LOADED"],state:{status:"NOT_READY",flags:["base"],preinit:{},modules:{},classes:{},interfaces:{},integrations:[],add_flag:function(e){return this.sys.flags.push(e)},consider_preinit:function(t){var n,r,i,s,u,a,f,l,c,h,p,d;if(t.abstract_base_classes!=null){h=t.abstract_base_classes;for(i=0,f=h.length;i<f;i++){n=h[i],o.sys.state.classes[n.name]=n,n["package"]!=null&&o.sys.state.modules[n["package"]]!=null&&(o.sys.state.modules[n["package"]].classes[n.name]=n);if(n["export"]!=null&&n["export"]==="private")continue;e[n.name]=n}}if(t.deferred_library_integrations!=null){p=t.deferred_library_integrations;for(u=0,l=p.length;u<l;u++)r=p[u],o.sys.libraries.install(r.name,r.library)}if(t.abstract_feature_interfaces!=null){d=t.abstract_feature_interfaces;for(a=0,c=d.length;a<c;a++)s=d[a],o.sys.interfaces.install(s.name,s.adapter)}return t}},modules:{install:function(t,n,r){var i,s,u,a;return n==null&&(n=null),r==null&&(r=null),n!=null&&(typeof n=="function"?(r=n,s=null):s=n),s!=null?(o[s]==null&&(o[s]={}),s=o[s],u=!0):(s=o,u=!1),t.mount!=null?i=t.mount:i=t.name.toLowerCase(),t.events!=null&&o.events!=null&&o.events.register(t.events),s[i]==null&&(u?(a=s[i]=new t(o,s,e),o.sys.state.modules[i]={module:a,classes:{}}):(a=s[i]=new t(o,e),o.sys.state.modules[i]={module:a,classes:{}})),typeof t._init=="function"&&t._init(o),o.dev!=null&&o.dev.verbose!=null&&o.dev.verbose("ModuleLoader","Installed module:",a," at mountpoint: ",s," under the name: ",i),o.events!=null&&o.events.trigger("SYS_MODULE_LOADED",{module:a,mountpoint:s}),r!=null&&r(a),a}},libraries:{install:function(e,t,n){return n==null&&(n=null),o.lib[e.toLowerCase()]=t,o.sys.state.integrations.push(e.toLowerCase()),o.dev.verbose("LibLoader",e+" detected."),o.events.trigger("SYS_LIB_LOADED",{name:e,library:t}),n!=null&&n(t,e),o.lib[e.toLowerCase()]},resolve:function(e){var t,n,r,i;e=e.toLowerCase(),i=o.sys.state.integrations;for(n=0,r=i.length;n<r;n++){t=i[n];if(t!==e)continue;return o.lib[e.toLowerCase()]}}},interfaces:{install:function(e,t){return o.dev.verbose("InterfaceLoader",'Installed "'+e+'" interface.'),o.events.trigger("SYS_INTERFACE_LOADED",{name:e,adapter:t}),o.sys.state.interfaces[e]={adapter:t,methods:t.methods},o.sys.state.interfaces[e]},resolve:function(e){return o.sys.state.interfaces[e]!=null?o.sys.state.interfaces[e]:!1}},drivers:{query:{},loader:{},transport:{},storage:{},render:{},install:function(e,t,n,r,i,s,u){return u==null&&(u=null),o.sys.drivers[e][t]={name:t,driver:r,enabled:i,priority:s,"interface":n},u!=null&&u(o.sys.drivers[e][t].driver),o.events.trigger("SYS_DRIVER_LOADED",o.sys.drivers[e][t]),o.sys.drivers[e][t]},resolve:function(e,t,n){var r,i,s;t==null&&(t=null),n==null&&(n=!1);if(o.sys.drivers[e]==null){apptools.dev.critical("CORE",'Unkown driver type "'+e+'".');return}if(t!=null)return o.sys.drivers[e][t]!=null?o.sys.drivers[e][t].driver:(n&&apptools.dev.critical("CORE","Could not resolve driver ",t," of type ",e,"."),!1);i=-1,s=!1;for(r in o.sys.drivers[e]){r=o.sys.drivers[e][r];if(r.priority>i){s=r;break}}return s}},go:function(){return o.dev.log("Core","All systems go."),o.sys.state.status="READY",o}},this.sys.modules.install(p,function(e){return e.verbose("CORE","CoreDevAPI is up and running.")}),this.sys.modules.install(v,function(e){return e.register(o.sys.core_events)}),e.__apptools_preinit!=null&&(this.sys.state.preinit=e.__apptools_preinit,this.sys.state.consider_preinit(e.__apptools_preinit)),(e!=null?e.Modernizr:void 0)!=null&&this.sys.libraries.install("Modernizr",e.Modernizr,function(e,t){return o.load=function(){var e,t;return e=1<=arguments.length?vt.call(arguments,0):[],(t=o.lib.modernizr).load.apply(t,e)}}),(e!=null?e.jQuery:void 0)!=null&&this.sys.libraries.install("jQuery",e.jQuery,function(e,t){return o.sys.drivers.install("query","jquery",o.sys.state.classes.QueryDriver,o.lib.jquery,!0,100,null),o.sys.drivers.install("transport","jquery",o.sys.state.classes.RPCDriver,o.lib.jquery,!0,100,null)}),(e!=null?e.Zepto:void 0)!=null&&this.sys.libraries.install("Zepto",e.Zepto,function(e,t){return o.sys.drivers.install("query","zepto",o.sys.state.classes.QueryDriver,o.lib.zepto,!0,500,null),o.sys.drivers.install("transport","zepto",o.sys.state.classes.RPCDriver,o.lib.zepto,!0,500,null)}),(e!=null?e._:void 0)!=null&&this.sys.libraries.install("Underscore",e._,function(e,t){return o.sys.drivers.install("query","underscore",o.sys.state.classes.QueryDriver,o.lib.underscore,!0,50,null),o.sys.drivers.install("render","underscore",o.sys.state.classes.RenderDriver,o.lib.underscore,!0,50,null)}),(e!=null?e.Backbone:void 0)!=null&&this.sys.libraries.install("Backbone",e.Backbone),(e!=null?e.Lawnchair:void 0)!=null&&this.sys.libraries.install("Lawnchair",e.Lawnchair,function(e){return o.sys.drivers.install("storage","lawnchair",o.sys.state.classes.StorageDriver,o.lib.lawnchair,!0,500,function(e){return o.dev.verbose("Lawnchair","Storage is currently stubbed. Come back later.")})}),(e!=null?e.amplify:void 0)!=null&&this.sys.libraries.install("Amplify",e.amplify,function(e){return o.sys.drivers.register("transport","amplify",o.sys.state.classes.RPCDriver,o.lib.amplify,!0,500,null),o.sys.drivers.register("storage","amplify",o.sys.state.classes.StorageDriver,o.lib.amplify,!0,100,null)}),(e!=null?e.Milk:void 0)!=null&&this.sys.libraries.install("Milk",e.Milk,function(e){return o.sys.drivers.install("render","milk",o.sys.state.classes.RenderDriver,o.lib.milk,!0,100,function(e){return o.dev.verbose("Milk","Render support is currently stubbed. Come back later.")})}),(e!=null?e.Mustache:void 0)!=null&&this.sys.libraries.install("Mustache",e.Mustache,function(e){return o.sys.drivers.register("render","mustache",o.sys.state.classes.RenderDriver,o.lib.mustache,!0,500,function(e){return o.dev.verbose("Mustache","Render support is currently stubbed. Come back later.")})}),this.sys.modules.install(y),this.sys.modules.install(h),this.sys.modules.install(d),this.sys.modules.install(E),this.sys.modules.install(w),this.sys.modules.install(T),this.sys.modules.install(x),this.sys.modules.install(S);if(((i=e.__apptools_preinit)!=null?i.deferred_core_modules:void 0)!=null){s=e.__apptools_preinit.deferred_core_modules;for(n=0,r=s.length;n<r;n++)t=s[n],t["package"]!=null?this.sys.modules.install(t.module,t["package"]):this.sys.modules.install(t.module)}return this.sys.go()}return e.version={major:0,minor:1,micro:4,build:4282012,release:"BETA",get:function(){return[[[this.major.toString(),this.minor.toString(),this.micro.toString()].join("."),this.build.toString()].join("-"),this.release].join(" ")}},e}(),window.AppTools=t,window.apptools=new t(window),window.jQuery!=null?$.extend({apptools:window.apptools}):(window.$=function(e){return document.getElementById(e)},window.$.apptools=window.apptools)}).call(this);