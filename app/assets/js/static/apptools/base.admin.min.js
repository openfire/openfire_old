// Generated by CoffeeScript 1.3.3
(function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,D,P,H,B,j,F,I,q,R,U,z=[].slice,W={}.hasOwnProperty,X=function(e,t){function r(){this.constructor=e}for(var n in t)W.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},V=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},J=function(e,t){return function(){return e.apply(t,arguments)}};this.__apptools_preinit={},U={},L=function(e,t,n){var r,i,s,o,u,a,f,l,c;n==null&&(n=null);if(e===".")return t[t.length-1];l=e.split(/\./),e=l[0],o=2<=l.length?z.call(l,1):[];for(i=u=c=t.length-1;c<=-1?u<-1:u>-1;i=c<=-1?++u:--u){if(t[i]==null)continue;if(typeof t[i]=="object"&&e in(r=t[i])){n=r[e];break}continue}for(a=0,f=o.length;a<f;a++)s=o[a],n=L(s,[n]);return n instanceof Function&&(n=function(e){return function(){var t;return t=e.apply(r,arguments),t instanceof Function&&t.apply(null,arguments)||t}}(n)),n},k=function(){var e,t,n,r;return n=arguments[0],r=arguments[1],e=3<=arguments.length?z.call(arguments,2):[],function(){var i,s,o;o=[];for(i=0,s=r.length;i<s;i++)t=r[i],o.push(t.call.apply(t,[n].concat(z.call(e))));return o}().join("")},M=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,A,O,_;t==null&&(t=["{{","}}"]),n==null&&(n=null),f=U[C=t.join(" ")]||(U[C]={});if(e in f)return f[e];i=[],r=function(){var e,n;return n=t[0],e=t[1],RegExp("([\\s\\S]*?)([ \\t]*)(?:"+n+"\\s*(?:(!)\\s*([\\s\\S]+?)|(=)\\s*([\\s\\S]+?)\\s*=|({)\\s*(\\w[\\S]*?)\\s*}|([^0-9a-zA-Z._!={]?)\\s*([\\w.][\\S]*?))\\s*"+e+")","gm")},S=r(),S.lastIndex=b=(n||{start:0}).start,y=function(t,n){var r,i,s,o,u,a,f,l,h,p,d;(s=/$/gm).lastIndex=t,s.exec(e),p=e.substr(0,t).split("\n"),h=p.length,f=p[h-1],d=c+N.length,l=e.substr(d+1,t-d-1),u=(new Array(f.length-l.length+1)).join(" "),r=(new Array(l.length+1)).join("^"),f+=e.substr(t,s.lastIndex-t),o=new Error;for(a in i={message:""+n+"\n\nLine "+h+":\n"+f+"\n"+u+r,error:n,line:h,"char":u.length,tag:l})o[a]=i[a];return o};while(m=S.exec(e)){A=m.slice(1,3),l=A[0],N=A[1],T=m[3]||m[5]||m[7]||m[9],E=m[4]||m[6]||m[8]||m[10],c=b+l.length-1,b=S.lastIndex,v=(c===-1||e.charAt(c)==="\n")&&((O=e.charAt(b))===void 0||O===""||O==="\r"||O==="\n"),l&&i.push(function(e){return function(){return e}}(l)),v&&T!==""&&T!=="&"&&T!=="{"?(e.charAt(b)==="\r"&&(b+=1),e.charAt(b)==="\n"&&(b+=1)):N&&(i.push(function(e){return function(){return e}}(N)),c+=N.length,N="");switch(T){case"!":break;case"":case"&":case"{":s=function(e,t){return function(n){var r,i;return(r=(i=L(e,n))!=null?i:"")instanceof Function&&(r=k.apply(null,[this,M(""+r())].concat(z.call(arguments)))),t||(r=this.escape(""+r)),""+r}},i.push(s(E,T));break;case">":u=function(e,t){return function(n,r){var i;return i=r(e).toString(),t&&(i=i.replace(/^(?=.)/gm,t)),k.apply(null,[this,M(i)].concat(z.call(arguments)))}},i.push(u(E,N));break;case"#":case"^":w={name:E,start:b,error:y(S.lastIndex,"Unclosed section '"+E+"'!")},_=M(e,t,w),x=_[0],b=_[1],w["#"]=a=function(e,t,n){return function(r){var i,s,o,u;return u=L(e,r)||[],x=u instanceof Function?u(n):n,u instanceof Array||(u=[u]),i=M(x||"",t),r.push(u),s=function(){var e,t,n;n=[];for(e=0,t=u.length;e<t;e++)o=u[e],r[r.length-1]=o,n.push(k.apply(null,[this,i].concat(z.call(arguments))));return n}.apply(this,arguments),r.pop(),s.join("")}},w["^"]=o=function(e,t,n){return function(r){var i;return i=L(e,r)||[],i instanceof Array||(i=[1]),i=i.length===0?M(n,t):[],k.apply(null,[this,i].concat(z.call(arguments)))}},i.push(w[T](E,t,x));break;case"/":n==null?p="End Section tag '"+E+"' found, but not in section!":E!==(g=n.name)&&(p="End Section tag closes '"+E+"'; expected '"+g+"'!");if(p)throw y(S.lastIndex,p);return e=e.slice(n.start,c+1||9e9),f[e]=i,[e,b];case"=":(t=E.split(/\s+/)).length!==2&&(p="Set Delimiters tags should have two and only two values!");if(p)throw y(S.lastIndex,p);d=/[-[\]{}()*+?.,\\^$|#]/g,t=function(){var e,n,r;r=[];for(e=0,n=t.length;e<n;e++)h=t[e],r.push(h.replace(d,"\\$&"));return r}(),S=r();break;default:throw y(S.lastIndex,"Unknown tag type -- "+T)}S.lastIndex=b!=null?b:e.length}if(n!=null)throw n.error;return e.length!==b&&i.push(function(){return e.slice(b)}),f[e]=i},A={VERSION:"1.2.0",helpers:[],partials:null,escape:function(e){var t;return t={"&":"amp",'"':"quot","<":"lt",">":"gt"},e.replace(/[&"<>]/g,function(e){return"&"+t[e]+";"})},render:function(e,t,n){var r;return n==null&&(n=null),(n||(n=this.partials||{}))instanceof Function||(n=function(e){return function(t){if(t in e)return L(t,[e]);throw"Unknown partial '"+t+"'!"}}(n)),r=this.helpers instanceof Array?this.helpers:[this.helpers],k(this,M(e),r.concat([t]),n)}},this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes=[],this.__apptools_preinit.deferred_core_modules=[],this.__apptools_preinit.abstract_feature_interfaces=[],this.__apptools_preinit.deferred_library_integrations=[]):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[],abstract_feature_interfaces:[],deferred_library_integrations:[]},l=function(){function e(){}return e}(),this.__apptools_preinit.abstract_base_classes.push(l),b=function(){function e(){}return e}(),this.__apptools_preinit.abstract_base_classes.push(b),g=function(){function e(){}return e}(),this.__apptools_preinit.abstract_base_classes.push(g),m=function(e){function t(e,t,n){this.module=e,this.message=t,this.context=n}return X(t,e),t.prototype.toString=function(){return"["+this.module+"] CoreException: "+this.message},t}(Error),this.__apptools_preinit.abstract_base_classes.push(m),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return X(t,e),t.prototype.toString=function(){return"["+this.module+"] AppException: "+this.message},t}(m),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return X(t,e),t.prototype.toString=function(){return"["+this.module+"] AppToolsException: "+this.message},t}(m),this.__apptools_preinit.abstract_base_classes.push(t),this.__apptools_preinit.abstract_base_classes.push(i),this.Backbone!=null?(u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return X(t,e),t}(Backbone.View),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return X(t,e),t}(Backbone.Model),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return X(t,e),t}(Backbone.Router),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return X(t,e),t}(Backbone.Collection)):(u=function(){function e(){}return e}(),s=function(){function e(){}return e}(),o=function(){function e(){}return e}(),r=function(){function e(){}return e}()),this.__apptools_preinit.abstract_base_classes.push(u),this.__apptools_preinit.abstract_base_classes.push(s),this.__apptools_preinit.abstract_base_classes.push(o),this.__apptools_preinit.abstract_base_classes.push(r),p=function(e){function t(e,t){var n=this;this.config={},this.environment={},this.performance={},this.debug={logging:!0,eventlog:!0,verbose:!0,serverside:!1},this.setDebug=function(e){return n.debug=e,n._sendLog("[CoreDev] Debug has been set.",n.debug)},this._sendLog=function(){var e;return e=1<=arguments.length?z.call(arguments,0):[],console.log.apply(console,e)},this.log=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?z.call(arguments,2):[],e==null&&(e="{no context}"),n.debug.logging===!0&&n._sendLog.apply(n,["["+r+"] INFO: "+t].concat(z.call(e)))},this.warning=this.warn=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?z.call(arguments,2):[],e==null&&(e="{no context}"),n.debug.logging===!0&&n._sendLog.apply(n,["["+r+"] WARNING: "+t].concat(z.call(e)))},this.error=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?z.call(arguments,2):[],n.debug.logging===!0&&n._sendLog.apply(n,["["+r+"] ERROR: "+t].concat(z.call(e)))},this.verbose=function(){var e,t,r;r=arguments[0],t=arguments[1],e=3<=arguments.length?z.call(arguments,2):[],n.debug.verbose===!0&&n._sendLog.apply(n,["["+r+"] DEBUG: "+t].concat(z.call(e)))},this.exception=this.critical=function(){var e,r,i,s;throw s=arguments[0],i=arguments[1],r=arguments[2],e=4<=arguments.length?z.call(arguments,3):[],r==null&&(r=t.AppToolsException),n._sendLog("A critical error or unhandled exception occurred."),n._sendLog.apply(n,["["+s+"] CRITICAL: "+i].concat(z.call(e))),new r(s,i,e)}}return X(t,e),t.mount="dev",t.events=[],t}(l),this.__apptools_preinit.abstract_base_classes.push(p),y=function(e){function t(e,t){}return X(t,e),t.mount="model",t.events=[],t}(l),this.__apptools_preinit.abstract_base_classes.push(y),v=function(e){function t(e,t){var n=this;this.registry=[],this.callchain={},this.history=[],this.fire=this.trigger=function(){var t,r,i,s,o,u,a,f,l,c,h,p,d,v;s=arguments[0],t=2<=arguments.length?z.call(arguments,1):[],e.dev.verbose("Events","Triggered event:",s,t,n.callchain[s]);if(V.call(n.registry,s)>=0){a=0,u=0,o=[],l=[],l.push(s),v=n.callchain[s].hooks;for(c=0,p=v.length;c<p;c++){i=v[c];try{if(i.once===!0&&i.has_run===!0)continue;i.bridge!=null==0?(f=i.fn.apply(i,t),a++,n.history.push({event:s,callback:i,args:t,result:f}),i.has_run=!0):i.bridge===!0&&o.push({event:i.event,args:t})}catch(m){u++,n.history.push({event:s,callback:i,args:t,error:m})}}for(h=0,d=o.length;h<d;h++)r=o[h],l.push(r.event),n.trigger.apply(n,[r.event].concat(z.call(r.args)));return{events:l,executed:a,errors:u}}return!1},this.create=this.register=function(t){var r,i,s;t instanceof Array||(t=[t]);for(i=0,s=t.length;i<s;i++)r=t[i],n.registry.push.apply(n.registry,t),n.callchain[r]={hooks:[]};return e.dev.verbose("Events","Registered events:",{count:t.length,events:t}),!0},this.on=this.upon=this.when=this.hook=function(t,r,i){return i==null&&(i=!1),V.call(n.registry,t)<0&&(e.dev.warning("Events",""),n.register(t)),n.callchain[t].hooks.push({fn:r,once:i,has_run:!1,bridge:!1}),e.dev.verbose("Events","Hook registered on event.",t),!0},this.delegate=this.bridge=function(t,r){var i,s,o,u,a;typeof r=="string"&&(r=[r]),typeof t=="string"&&(t=[t]),a=[];for(o=0,u=t.length;o<u;o++)i=t[o],a.push(function(){var t,n,o;o=[];for(t=0,n=r.length;t<n;t++)s=r[t],e.dev.verbose("Events","Bridging events:",i,"->",s),this.callchain[i]==null&&(e.dev.warn("Events","Bridging from undefined source event:",i),this.register(i)),o.push(this.callchain[i].hooks.push({event:s,bridge:!0}));return o}.call(n));return a}}return X(t,e),t.mount="events",t.events=[],t}(l),this.__apptools_preinit.abstract_base_classes.push(v),h=function(e){function t(e,t){this._data={},this.platform={},this.capabilities={},e.lib.modernizr!=null&&(this.capabilities=e.lib.modernizr),this.capabilities.simple={},this._data={browsers:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:t.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}return X(t,e),t.mount="agent",t.events=["UA_DISCOVER"],t.prototype._makeMatch=function(e){var t,n,r,i,s;for(i=0,s=e.length;i<s;i++){r=e[i],n=r.string,t=r.prop,this._data.versionSearchString=r.versionSearch||r.identity;if(n!==null){if(r.string.indexOf(r.subString)!==-1)return r.identity}else if(t)return r.identity}},t.prototype._makeVersion=function(e){var t;t=e.indexOf(this._data.versionSearchString);if(t!==-1)return parseFloat(e.substring(t+this._data.versionSearchString.length+1))},t.prototype.discover=function(){var e,t,n,r,i;e=this._makeMatch(this._data.browsers)||"unknown",i=this._makeVersion(navigator.userAgent)||this._makeVersion(navigator.appVersion)||"unknown",n=this._makeMatch(this._data.os)||"unknown";if(e==="iPod/iPhone"||e==="Android")r="mobile",t=!1;this.platform={os:n,type:r,vendor:navigator.vendor,product:navigator.product,browser:e,version:i,flags:{online:navigator.onLine||!0,mobile:t,webkit:$.browser.webkit,msie:$.browser.msie,opera:$.browser.opera,mozilla:$.browser.mozilla}},this.capabilities.simple.cookies=navigator.cookieEnabled;if(window.jQuery!=null)return this.capabilities.simple.ajax=$.support.ajax},t}(l),this.__apptools_preinit.abstract_base_classes.push(h),d=function(e){function t(e,t){var n=this;this.state={opened:!1,receiving:!1,error:!1,history:{errors:[],received:[]},pending:{},complete:{}},this.init=function(){return n.state.opened=!0,e.dev.verbose("Dispatch","Dispatch startup signal received.")},this.expect=function(t,r,i){return n.state.pending[t]={request:r,callbacks:callbacks,xhr:i},e.dev.verbose("Dispatch","Received EXPECT signal.",t,r,callbacks,i)},this.receive=function(t){var r,i,s,o,u;try{i=JSON.parse(t.data)}catch(a){i=t.data}return e.dev.verbose("Dispatch","Parsed async message.",i),n.state.history.received.push(t),i.status==="ok"?(e.dev.verbose("Dispatch","Triggering deferred success callback."),n.state.complete[i.id]=n.state.pending[i.id],n.state.complete[i.id].response=i,delete n.state.pending[i.id],e.dev.log("RPC","Success",t.data,i.status,n.state.complete[i.id].xhr),e.api.rpc.lastResponse=t.data,e.api.rpc.history[i.id].xhr=n.state.complete[i.id].xhr,e.api.rpc.history[i.id].status=i.status,e.api.rpc.history[i.id].response=t.data,r={xhr:n.state.complete[i.id].xhr,status:i.status,data:t.data},e.events.trigger("RPC_SUCCESS",r),typeof (s=n.state.complete[i.id].callbacks).success=="function"?s.success(i.response.content):void 0):i.status==="notify"?(e.dev.verbose("Dispatch","Received NOTIFY signal."),typeof (o=n.state.pending[i.id].callbacks).notify=="function"?o.notify(i.response.content):void 0):(e.dev.error("Dispatch","Userland deferred task error. Calling error callback.",i),typeof (u=n.state.pending[i.id].callbacks).error=="function"?u.error(i.content):void 0)},this.error=function(t){return n.state.error=!0,n.history.errors.push(t),e.dev.error("Dispatch","Dispatch error state triggered.",t)},this.close=function(){return n.state.opened=!1,n.state.receiving=!1,e.dev.verbose("Dispatch","Dispatch shutdown signal received.")}}return X(t,e),t.mount="dispatch",t.events=[],t}(l),this.__apptools_preinit.abstract_base_classes.push(d),x=function(e){function t(e,t){var n=this;this._state={runtime:{index:{key_read_tally:{},key_write_tally:{},local_by_key:{},local_by_kind:{}},count:{total_keys:0,by_collection:[],by_kind:[]},data:{}},config:{autoload:!1,autosync:{enabled:!1,interval:120},adapters:{},obfuscate:!1,local_only:!1,callbacks:{ready:null,sync:null}},supervisor:{},cachebridge:{},model_kind_map:{},collection_kind_map:{}},this.internal={check_support:function(e){},bootstrap:function(e){},provision_collection:function(e,t,n){}},this.get=function(){},this.list=function(){},this.count=function(){},this.put=function(){},this.query=function(){},this["delete"]=function(){},this.sync=function(){},this._init=function(){return e.dev.verbose("Storage","Storage support is currently stubbed."),e.events.trigger("STORAGE_INIT"),e.events.trigger("STORAGE_READY")},e.events.bridge(["STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE"],"STORAGE_ACTIVITY"),e.events.bridge(["COLLECTION_CREATE","COLLECTION_UPDATE","COLLECTION_DESTROY","COLLECTION_SYNC","COLLECTION_SCAN"],"STORAGE_ACTIVITY")}return X(t,e),t.mount="storage",t.events=["STORAGE_INIT","STORAGE_READY","STORAGE_ERROR","STORAGE_ACTIVITY","STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE","COLLECTION_SCAN","COLLECTION_CREATE","COLLECTION_DESTROY","COLLECTION_UPDATE","COLLECTION_SYNC"],t}(l),R=function(e){function t(){return}return X(t,e),t.methods=[],t["export"]="private",t}(g),this.__apptools_preinit.abstract_base_classes.push(R),this.__apptools_preinit.abstract_base_classes.push(x),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:R,name:"storage"}),H=function(e){function t(e,t,n,r){var i,s,o,u;this.name=e,this.base_uri=t,this.methods=n,this.config=r;if(this.methods.length>0){u=this.methods;for(s=0,o=u.length;s<o;s++)i=u[s],this[i]=this._buildRPCMethod(i,t,r)}}return X(t,e),t.prototype._buildRPCMethod=function(e,t,n){var r,i,s=this;return r=this.name,i=function(t,n,i,s,o,u){return t==null&&(t={}),n==null&&(n=null),i==null&&(i=!1),s==null&&(s=!1),o==null&&(o={}),u==null&&(u={}),function(t,n,i,s,o){var a;return a=$.apptools.api.rpc.createRPCRequest({method:e,api:r,params:t||{},opts:o||{},async:i||!1,push:s||!1}),n!==null?a.fulfill(n,u):a}(t,n,i,s,o)},$.apptools.api.registerAPIMethod(r,e,t,n),i},t}(b),j=function(e){function t(e,t,n){this.params={},this.action=null,this.method=null,this.api=null,this.base_uri=null,this.envelope={id:null,opts:{},agent:{}},this.ajax={accepts:"application/json",async:!0,cache:!0,global:!0,http_method:"POST",crossDomain:!1,processData:!1,ifModified:!1,dataType:"json",push:!1,contentType:"application/json; charset=utf-8"},e!=null&&(this.envelope.id=e),t!=null&&(this.envelope.opts=t),n!=null&&(this.envelope.agent=n)}return X(t,e),t.prototype.fulfill=function(e,t){var n,r,i=this;return e==null&&(e={}),(e!=null?e.success:void 0)==null&&(r=function(e,t,n){return $.apptools.dev.log("RPC","RPC succeeded but had no success callback.",i,e,t,n)},e.success=r),(e!=null?e.failure:void 0)==null&&(n=function(e){return $.apptools.dev.error("RPC","RPC failed but had no failure callback.",i,e)},e.failure=n),$.apptools.api.rpc.fulfillRPCRequest(t,this,e)},t.prototype.setAsync=function(e){var t,n;return(t=this.ajax)!=null&&(n=t.async)==null&&(t.async=e),this},t.prototype.setPush=function(e){return e===!0&&(this.ajax.push=!0,this.envelope.opts.alt="socket",this.envelope.opts.token=$.apptools.push.state.config.token),this},t.prototype.setOpts=function(e){var t,n;return(t=this.envelope)!=null&&(t.opts=_.defaults(e,(n=this.envelope)!=null?n.opts:void 0)),this},t.prototype.setAgent=function(e){var t,n;return(t=this.envelope)!=null&&(n=t.agent)==null&&(t.agent=e),this},t.prototype.setAction=function(e){return this.action=e,this},t.prototype.setMethod=function(e){return this.method=e,this},t.prototype.setAPI=function(e){return this.api=e,this},t.prototype.setBaseURI=function(e){return this.base_uri=e,this},t.prototype.setParams=function(e){return this.params=e!=null?e:{},this},t.prototype.payload=function(){var e;return e={id:this.envelope.id,opts:this.envelope.opts,agent:this.envelope.agent,request:{params:this.params,method:this.method,api:this.api}},e},t}(b),F=function(e){function t(){var e;e=1<=arguments.length?z.call(arguments,0):[],$.apptools.dev.verbose("RPC","RPCResponse is not yet implemented and is currently stubbed.");return}return X(t,e),t}(b),E=function(e){function t(e,t){var r,i,s,o=this;this.state={sockets:{token:"__NULL__",enabled:!1,status:"DISCONNECTED","default":null,default_host:((i=e.config)!=null?(s=i.rpc)!=null?s.socket_host:void 0:void 0)!=null||null}},this.base_rpc_uri=e.config.rpc.base_uri||"/_api/rpc",this.socket_host=e.config.rpc.socket_host||null,e.sys.libraries.resolve("jQuery")!==!1?r=$.ajaxSettings.xhr:r=new XMLHTTPRequest,this.internals={transports:{xhr:{factory:function(){var t;return t=r(),t&&typeof t.addEventListener=="function"&&t.addEventListener("progress",function(t){return e.events.trigger("RPC_PROGRESS",{event:t})},!1),t}},websocket:{factory:function(){var t,n,r,i,s,u;if(e.agent.capabilities.websockets==null)throw e.dev.error("RPC","Socket factory can't produce a socket because the client platform does not support WebSockets."),"SocketsNotSupported: The client platform does not have support for websockets.";if(((r=o.state.sockets)!=null?r.enabled:void 0)!=null==1)return((i=o.state.sockets)!=null?i["default"]:void 0)!=null===null&&((s=o.state.sockets)!=null?(u=s.open)!=null?u.length:void 0:void 0)===0&&(n=new e.push.socket.establish,o.state.sockets.enabled=!0,o.state.sockets["default"]=n,o.state.sockets.status="CONNECTED"),t={},t}}},config:{headers:{"X-ServiceClient":["AppToolsJS/",[n.version.major.toString(),n.version.minor.toString(),n.version.micro.toString(),n.version.build.toString()].join("."),"-",n.version.release.toString()].join(""),"X-ServiceTransport":"AppTools/JSONRPC"}}},e.sys.libraries.resolve("jQuery")!==!1&&$.ajaxSetup({global:!0,xhr:function(){return o.internals.transports.xhr.factory()},headers:this.internals.config.headers}),this.rpc={lastRequest:null,lastFailure:null,lastResponse:null,history:{},action_prefix:null,alt_push_response:!1,used_ids:[],factory:function(t,n,r,i){return e.api[t]=new H(t,n,r,i)},_assembleRPCURL:function(e,t,n,r){if(t==null&&r==null)throw"[RPC] Error: Must specify either an API or base URI to generate an RPC endpoint.";return t!=null?r!=null?r=r+"/"+t:r=o.base_rpc_uri+"/"+t:r==null&&(r=o.base_rpc_uri),n!==null?[n+r,e].join("."):[r,e].join(".")},provisionRequestID:function(){var e;return o.rpc.used_ids.length>0?(e=Math.max.apply(o,o.rpc.used_ids)+1,o.rpc.used_ids.push(e),e):(o.rpc.used_ids.push(1),1)},decodeRPCResponse:function(e,t,n,r,i){return r(e,t)},createRPCRequest:function(t){var n;return n=new j(o.rpc.provisionRequestID()),t.api!=null&&n.setAPI(t.api),t.method!=null&&n.setMethod(t.method),t.agent!=null&&n.setAgent(t.agent),t.opts!=null&&n.setOpts(t.opts),t.base_uri!=null&&n.setBaseURI(t.base_uri),t.params!=null&&n.setParams(t.params),t.async!=null&&n.setAsync(t.async),t.push!=null?n.setPush(t.push):n.setPush(o.rpc.alt_push_response),e.dev.verbose("RPC","New Request",n,t),n.setAction(o.rpc._assembleRPCURL(n.method,n.api,o.rpc.action_prefix,o.base_rpc_uri)),n},fulfillRPCRequest:function(t,n,r,i){var s;i==null&&(i="xhr"),e.dev.verbose("RPC","Fulfill",t,n,r),o.rpc.lastRequest=n,o.rpc.history[n.envelope.id]={request:n,config:t,callbacks:r};if(n.action===null){if(n.method===null)throw"[RPC] Error: Request must specify at least an action or method.";if(n.base_uri===null){if(n.api===null)throw"[RPC] Error: Request must have an API or explicity defined BASE_URI.";n.action=o.rpc._assembleRPCURL(n.method,n.api,o.rpc.action_prefix)}else n.action=o.rpc._assembleRPCURL(n.method,null,o.rpc.action_prefix,n.base_uri)}if(n.action===null||n.action===void 0)throw"[RPC] Error: Could not determine RPC action.";return s={config:t,request:n,callbacks:r},e.events.trigger("RPC_FULFILL",s),function(e,t,n){var r,i,o,u,a=this;u={resourceId:t.api+"."+t.method,url:t.action,data:JSON.stringify(t.payload()),async:t.ajax.async,global:t.ajax.global,type:t.ajax.http_method||"POST",accepts:t.ajax.accepts||"application/json",crossDomain:t.ajax.crossDomain,dataType:t.ajax.dataType,processData:!1,ifModified:t.ajax.ifModified,contentType:t.ajax.contentType,beforeSend:function(r,i){return e.api.rpc.history[t.envelope.id].xhr=r,n!=null&&typeof n.status=="function"&&n.status("beforeSend"),r},error:function(r,i,o){return n!=null&&typeof n.status=="function"&&n.status("error"),e.dev.error("RPC","Error: ",{error:o,status:i,xhr:r}),e.api.rpc.lastFailure=o,e.api.rpc.history[t.envelope.id].xhr=r,e.api.rpc.history[t.envelope.id].status=i,e.api.rpc.history[t.envelope.id].failure=o,s={xhr:r,status:i,error:o},e.events.trigger("RPC_ERROR",s),e.events.trigger("RPC_COMPLETE",s),n!=null?typeof n.failure=="function"?n.failure(o):void 0:void 0},success:function(r,i,o){return r.status==="ok"?(n!=null&&typeof n.status=="function"&&n.status("success"),e.dev.log("RPC","Success",r,i,o),e.api.rpc.lastResponse=r,e.api.rpc.history[t.envelope.id].xhr=o,e.api.rpc.history[t.envelope.id].status=i,e.api.rpc.history[t.envelope.id].response=r,s={xhr:o,status:i,data:r},e.events.trigger("RPC_SUCCESS",s),e.events.trigger("RPC_COMPLETE",s),n!=null?typeof n.success=="function"?n.success(r.response.content,r.response.type,r):void 0:void 0):r.status==="wait"?(n!=null&&typeof n.status=="function"&&n.status("wait"),e.dev.log("RPC","PushWait",r,i,o),s={xhr:o,status:i,data:r},n!=null&&typeof n.wait=="function"&&n.wait(r,i,o),e.push.internal.expect(t.envelope.id,t,o)):r.status==="fail"?(n!=null&&typeof n.status=="function"&&n.status("error"),e.dev.error("RPC","Error: ",{error:r,status:i,xhr:o}),e.api.rpc.lastFailure=r,e.api.rpc.history[t.envelope.id].xhr=o,e.api.rpc.history[t.envelope.id].status=i,e.api.rpc.history[t.envelope.id].failure=r,s={xhr:o,status:i,error:r},e.events.trigger("RPC_ERROR",s),e.events.trigger("RPC_COMPLETE",s),n!=null?typeof n.failure=="function"?n.failure(r):void 0:void 0):n!=null?typeof n.success=="function"?n.success(r.response.content,r.response.type,r):void 0:void 0},statusCode:{404:function(){return e.dev.error("RPC","HTTP/404","Could not resolve RPC action URI."),e.events.trigger("RPC_ERROR",{message:"RPC 404: Could not resolve RPC action URI.",code:404})},403:function(){return e.dev.error("RPC","HTTP/403","Not authorized to access the specified endpoint."),e.events.trigger("RPC_ERROR",{message:"RPC 403: Not authorized to access the specified endpoint.",code:403})},500:function(){return e.dev.error("RPC","HTTP/500","Internal server error."),e.events.trigger("RPC_ERROR",{message:"RPC 500: Woops! Something went wrong. Please try again.",code:500})}}},r=e.sys.drivers.resolve("transport");if(r.name==="amplify")e.dev.verbose("RPC","Fulfilling with AmplifyJS transport adapter."),o=r.driver.request,i=o(u);else{if(r.name!=="jquery")throw e.dev.error("RPC","Native RPC adapter is currently stubbed."),"[RPC]: No valid AJAX transport adapter found.";e.dev.verbose("RPC","Fulfilling with jQuery AJAX transport adapter.",u),i=jQuery.ajax(u.url,u)}return e.dev.verbose("RPC","Resulting XHR: ",i)}(e,n,r),{id:n.envelope.id,request:n}}},this.ext=null,this.registerAPIMethod=function(t,n,r,i){var s,u,a,f;if(e!=null?(f=e.sys)!=null?f.drivers:void 0:void 0){s=e.sys.drivers.resolve("transport","amplify");if(s!==!1)return e.dev.log("RPCAPI",'Registering request procedure "'+t+"."+n+'" with AmplifyJS.'),a=t+"."+n,u={accepts:"application/json",type:"POST",dataType:"json",contentType:"application/json",url:o.rpc._assembleRPCURL(n,t,null,r),decoder:o.rpc.decodeRPCResponse},i.caching!=null?(i.caching===!0&&(u.caching="persist"),s.request.define(a,"ajax",u)):s.request.define(a,"ajax",u)}}}return X(t,e),t.mount="api",t.events=["RPC_CREATE","RPC_FULFILL","RPC_SUCCESS","RPC_ERROR","RPC_COMPLETE","RPC_PROGRESS"],t}(l),B=function(e){function t(){return}return X(t,e),t.methods=[],t["export"]="private",t}(g),this.__apptools_preinit.abstract_base_classes.push(H),this.__apptools_preinit.abstract_base_classes.push(B),this.__apptools_preinit.abstract_base_classes.push(E),this.__apptools_preinit.abstract_base_classes.push(j),this.__apptools_preinit.abstract_base_classes.push(F),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:B,name:"transport"}),T=function(e){function t(e,t){this.current_user=null}return X(t,e),t.mount="user",t.events=["SET_USER_INFO"],t.prototype.setUserInfo=function(e){return this.current_user=e.current_user||null,$.apptools.dev.log("UserAPI","Set server-injected userinfo: ",this.current_user),$.apptools.events.trigger("SET_USER_INFO",this.current_user)},t}(l),this.__apptools_preinit.abstract_base_classes.push(T),w=function(e){function t(e,t){var n=this;this.state={ready:!1,status:"init",transport:{sockets:[],channel:null},callbacks:{open:null,expect:null,activity:null,error:null,close:null},config:{token:null}},e.events.bridge(["PUSH_READY","PUSH_SOCKET_ESTABLISH","PUSH_SOCKET_ERROR","PUSH_SOCKET_OPEN","PUSH_SOCKET_CLOSE"],"PUSH_STATE_CHANGE"),e.events.hook("PUSH_SOCKET_OPEN",function(){var t;return t=1<=arguments.length?z.call(arguments,0):[],e.api.rpc.alt_push_response=!0}),e.events.hook("PUSH_SOCKET_CLOSE",function(){var t;return t=1<=arguments.length?z.call(arguments,0):[],e.api.rpc.alt_push_response=!1}),this.events={on_open:function(t){if(n.state.transport.sockets.length=0)n.state.status="ready";return e.events.trigger("PUSH_SOCKET_OPEN",n.state),e.dev.verbose("PushSocket","Message transport opened.")},on_message:function(t,r){var i;return n.state.status="receiving",e.dev.verbose("PushSocket","Message received.",r),e.events.trigger("PUSH_SOCKET_ACTIVITY",n.state),typeof (i=n.state.callbacks).activity=="function"&&i.activity(r),e.events.trigger("PUSH_SOCKET_ACTIVITY_FINISH",n.state)},on_error:function(t,r){return n.state.status="error",e.dev.error("PushSocket","Message transport error.",r),e.events.trigger("PUSH_SOCKET_ERROR",n.state)},on_close:function(t){return n.state.ready=!1,n.state.status="close",e.dev.verbose("PushSocket","Message transport closed."),e.events.trigger("PUSH_SOCKET_CLOSE",n.state)}},this.internal={open_channel:function(t){return e.events.trigger("PUSH_INIT",{token:t,type:"channel"}),n.state.config.token=t,n.state.transport.channel=new goog.appengine.Channel(n.state.config.token),n.internal._add_socket(n.state.transport.channel)},open_websocket:function(t,r){return e.events.trigger("PUSH_INIT",{token:t,server:r,type:"websocket"}),e.dev.log("Push","WARNING: WebSockets support is currently experimental."),n.internal._add_socket(n.state.transport.socket)},_add_socket:function(t,r){var i;return i=t.open(),n.state.transport.sockets.push(i),e.events.trigger("PUSH_SOCKET_ESTABLISH",i),i.onopen=function(){var e,t;return e=1<=arguments.length?z.call(arguments,0):[],(t=n.events).on_open.apply(t,[i].concat(z.call(e)))},i.onmessage=function(){var e,t;return e=1<=arguments.length?z.call(arguments,0):[],(t=n.events).on_message.apply(t,[i].concat(z.call(e)))},i.onerror=function(){var e,t;return e=1<=arguments.length?z.call(arguments,0):[],(t=n.events).on_error.apply(t,[i].concat(z.call(e)))},i.onclose=function(){var e,t;return e=1<=arguments.length?z.call(arguments,0):[],(t=n.events).on_close.apply(t,[i].concat(z.call(e)))},n.internal},expect:function(e,t,r){var i,s;return(i=n.state)!=null&&(s=i.callbacks)!=null&&typeof s.expect=="function"&&s.expect(e,t,r),n.internal}},this.channel={establish:function(e){return n.internal.open_channel(e)}},this.socket={establish:function(t,r){return r==null&&(r=null),n.internal.open_websocket(t,r||e.config.sockets.host)}},this.listen=function(e){return n.state.callbacks=_.defaults(e,n.state.callbacks),n.state.ready=!0,n.internal}}return X(t,e),t.mount="push",t.events=["PUSH_INIT","PUSH_READY","PUSH_STATE_CHANGE","PUSH_SOCKET_OPEN","PUSH_SOCKET_ESTABLISH","PUSH_SOCKET_ACTIVITY","PUSH_SOCKET_ACTIVITY_FINISH","PUSH_SOCKET_ERROR","PUSH_SOCKET_CLOSE"],t}(l),D=function(e){function t(){return}return X(t,e),t.methods=[],t["export"]="private",t}(g),this.__apptools_preinit.abstract_base_classes.push(D),this.__apptools_preinit.abstract_base_classes.push(w),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:D,name:"transport"}),S=function(e){function t(e,t){return}return X(t,e),t.mount="render",t.events=["ADD_TEMPLATE","RENDER_TEMPLATE"],t["export"]="private",t.prototype._init=function(){},t}(l),I=function(e){function t(){return}return X(t,e),t["export"]="private",t.methods=["render","register_template"],t}(g),P=function(e){function t(){return}return X(t,e),t["export"]="private",t.methods=["element_by_id","elements_by_class"],t}(g),this.__apptools_preinit.abstract_base_classes.push(P),this.__apptools_preinit.abstract_base_classes.push(I),this.__apptools_preinit.abstract_base_classes.push(S),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:I,name:"render"}),C=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return X(t,e),t.mount="widget",t.events=[],t.prototype._init=function(e){e.sys.state.add_flag("widgets"),e.dev.verbose("CoreWidget","Widget functionality is currently stubbed.")},t}(l),N=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return X(t,e),t.prototype.animation={duration:400,easing:null,complete:null},t.prototype.prepare_overlay=function(e){var t,n;return e==null&&(e="apptools"),n=document.createElement("div"),n.className="fixed overlay",n.setAttribute("id",e+"-overlay-"+(t=Math.floor(Math.random()*1e3))),n.setAttribute("data-overlay-id",t),n.style.opacity=0,n},t}(b),this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes==null&&(this.__apptools_preinit.abstract_base_classes=[
]),this.__apptools_preinit.deferred_core_modules==null&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]},this.__apptools_preinit.abstract_base_classes.push(N),this.__apptools_preinit.abstract_base_classes.push(C),this.__apptools_preinit.deferred_core_modules.push({module:C}),c=function(e){function t(){return this._init=J(this._init,this),t.__super__.constructor.apply(this,arguments)}return X(t,e),t.mount="admin",t.events=[],t.prototype._init=function(e){e.sys.state.add_flag("admin"),e.dev.log("AdminAPI","NOTICE: Admin APIs are enabled.")},t}(l),this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes==null&&(this.__apptools_preinit.abstract_base_classes=[]),this.__apptools_preinit.deferred_core_modules==null&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]},this.__apptools_preinit.abstract_base_classes.push(c),this.__apptools_preinit.deferred_core_modules.push({module:c}),a=function(e){function t(e,t){e.dev.verbose("BlogManager","AppToolsXMS BlogManager is currently stubbed.")}return X(t,e),t.mount="blog",t.events=[],t}(c),this.__apptools_preinit.abstract_base_classes.push(a),this.__apptools_preinit.deferred_core_modules.push({module:a,"package":"admin"}),O=function(e){function t(e,t,n){e.dev.verbose("PageManager","AppToolsXMS PageManager is currently stubbed.")}return X(t,e),t.mount="page",t.events=["PAGE_EDIT","PAGE_SAVE","PAGE_META_SAVE"],t}(c),this.__apptools_preinit.abstract_base_classes.push(O),this.__apptools_preinit.deferred_core_modules.push({module:O,"package":"admin"}),q=function(e){function t(e,t,n){e.dev.verbose("SiteManager","AppToolsXMS SiteManager is currently stubbed.")}return X(t,e),t.mount="site",t.events=["SITE_EDIT","SITE_SAVE","SITE_META_SAVE"],t}(c),this.__apptools_preinit.abstract_base_classes.push(q),this.__apptools_preinit.deferred_core_modules.push({module:q,"package":"admin"}),f=function(t){function n(t,n,r){var i,s,o,u,a,f,l=this;s=!1,a={},u={},i=0,o={panel:{commands:{undo:function(){return document.execCommand("undo")},redo:function(){return document.execCommand("redo")},cut:function(){return document.execCommand("cut")},paste:function(){return document.execCommand("paste")},table:function(){return document.execCommand("enableInlineTableEditing")},resize:function(){return document.execCommand("enableObjectResizing")},clip:null,b:function(){return document.execCommand("bold")},u:function(){return document.execCommand("underline")},i:function(){return document.execCommand("italic")},clear:function(){return document.execCommand("removeFormat")},h1:function(){var e;return e=document.selection?document.selection():r.getSelection(),document.execCommand("insertHTML",!1,'<h1 class="h1">'+String(e)+"</h1>")},h2:function(){var e;return e=document.selection?document.selection():r.getSelection(),document.execCommand("insertHTML",!1,'<h2 class="h2">'+String(e)+"</h2>")},h3:function(){var e;return e=document.selection?document.selection():r.getSelection(),document.execCommand("insertHTML",!1,'<h3 class="h3">'+String(e)+"</h3>")},fontColor:function(){var e,t;return t=document.selection?document.selection():r.getSelection(),e=prompt("Please enter a hexidecimal color value (i.e. #ffffff)"),e=e[0]==="#"?e:"#"+e,document.execCommand("insertHTML",!1,'<span style="color:'+e+';">'+t+"</span>")},fontSize:function(){var e,t;return t=document.selection?document.selection():r.getSelection(),e=prompt("Please enter desired point size (i.e. 10)"),document.execCommand("insertHTML",!1,'<span style="font-size:'+e+'pt;">'+t+"</span>")},fontFace:null,l:function(){return document.execCommand("justifyLeft")},r:function(){return document.execCommand("justifyRight")},c:function(){return document.execCommand("justifyCenter")},"in":function(){return document.execCommand("indent")},out:function(){return document.execCommand("outdent")},bullet:function(){return document.execCommand("insertUnorderedList")},number:function(){return document.execCommand("insertOrderedList")},indentSpecial:null,lineSpacing:null,link:function(){var e,t;return t=document.selection?document.selection():r.getSelection(),util.is(t)||(t=prompt("What link text do you want to display?")),e=prompt("What URL do you want to link to?"),document.execCommand("insertHTML",!1,'<a href="'+e+'">'+t+"</a>")},image:null,video:null},panel_html:['<div id="CMS_wrap">','<div id="CMS_panel" class="fixed panel" style="opacity: 0;">','<div id="CMS_frame" class="nowrap">','<div class="cms_pane" id="buttons">','<div class="cms_subpane">','<h1 class="cms_sp">editing</h1>',"<p>",'<button id="cms_undo" value="undo">undo</button>','<button id="cms_redo" value="redo">redo</button>','<button id="cms_cut" value="cut">cut</button>','<button id="cms_paste" value="paste">paste</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">typography</h1>',"<p>",'<select id="cms_headers" class="cms">','<option id="cms_h1" class="h1">Heading 1</option>','<option id="cms_h2" class="h2">Heading 2</option>','<option id="cms_h3" class="h3">Heading 3</option>',"</select>",'<button id="cms_b" value="bold">B</button>','<button id="cms_u" value="underline">U</button>','<button id="cms_i" value="italic">I</button>','<button id="cms_clear" value="clear formatting">clear</button>','<button id="cms_fontColor" value="font color">font color</button>','<button id="cms_fontSize" value="font size">font size</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">alignment</h1>','<p style="text-lign:center">','<button id="cms_l" value="left">left</button>','<button id="cms_c" value="center">center</button>','<button id="cms_r" value="right">right</button>',"<br>",'<button id="cms_in" value="indent">&raquo;</button>','<button id="cms_out" value="outdent">&laquo;</button>',"<br>",'<button id="cms_ul" value="unordered list">&lt;ul&gt;</button>','<button id="cms_ol" value="ordered list">&lt;ol&gt;</button>',"</p>","</div>","<hr/>",'<div class="cms_subpane">','<h1 class="cms_sp">interactive</h1>',"<p>",'<button id="cms_link" value="link">add link</button>',"</p>","</div>","</div>",'<div class="cms_pane" id="styles">','<div class="cms_subpane">','<h1 class="cms_sp">styles</h1>',"<p>MIDDLE</p>","</div>","</div>",'<div class="cms_pane" id="assets">','<div class="cms_subpane">','<h1 class="cms_sp">drop files here</h1>','<div id="upload_wrap">','<div id="upload" class="dragdrop">','<span class="center-text" id="up_content">+</span>',"</div>","</div>","</div>","<hr>",'<div class="cms_subpane">','<h1 class="cms_sp">uploaded assets</h1>',"<p>",'<button id="pop_assets_button" class="pop" name="assets" value="pop out this pane!">pop me out</button>',"</p>","</div>","</div>","</div>",'<div id="CMS_nav">','<a class="scroll" href="#buttons">buttons</a>','<a class="scroll" href="#styles">styles</a>','<a class="scroll" href="#assets">assets</a>',"</div>",'<div id="CMS_panel_footer">&copy; momentum labs 2012</div>',"</div>","</div>"].join("\n"),status_html:'<div class="fixed panel bigger" id="cms_edit_on" style="vertical-align: middle; left: -305px;top: 50px;width: 300px;text-align: right;padding-right: 10px;opacity: 0;"><span id="cms_span" style="color: #222;cursor: pointer">content editing <span style="color: green;font-weight: bold;">ON</span></span></div>',init:!1},scroller:{animation:{duration:500,easing:"easeInOutExpo",complete:null},axis:"horizontal",frame:"CMS_frame",init:!1},pop:{animation:{duration:500,easing:"easeInOutExpo",complete:null},position:{bottom:"60px",right:"60px"},init:!1},modal:{animation:{duration:400,easing:"easeInOutExpo",complete:null},initial:{width:"0px",height:"0px",top:r.innerHeight/2+"px",left:r.innerWidth/2+"px"},ratio:{x:.4,y:.4},html:['<div id="modal_wrap" style="opacity: 0;" class="modal_wrap">','<div id="modal" style="opacity: 0;" class="fixed modal">','<div id="modal_status"></div>','<div id="modal_content">',"*****","</div>",'<div id="modal_ui"><button id="mod-close">close</button></div>',"</div>","</div>"].join("\n"),content:'<span style="font-size: 25px;margin: 10px auto;color: #5f5f5f;font-weight:bold">hello, lightbox!</span>',rounded:!0,init:!1},overlay:'<div id="m-overlay" class="fixed" style="opacity: 0;"></div>',init:!1},this.config=$.extend(!0,{},o),this.util={bind:function(e,t,n){var r;return r={},r[t]=n,e.bind(r)},imgPreview:function(e){var t,n;return n=e.target.result,t=document.createElement("img"),t.classList.add("preview"),t.src=n,document.getElementById("upload").appendChild(t)},is:function(e){return $.inArray(e,[!1,null,NaN,void 0,0,{},[],"","false","False","null","NaN","undefined","0","none","None"])===-1?!0:!1},isID:function(e){return String(e).split("")[0]==="#"||document.getElementById(e)!==null?!0:!1},handleDrag:function(t){var n;e.preventDefault(),e.stopPropagation(),n=e.target;if(e.type==="dragenter")return $(n).addClass("hover");if(e.type!=="dragover")return $(n).removeClass("hover")},makeDragDrop:function(e){return e.addEventListener("dragenter",l.util.handleDrag,!1),e.addEventListener("dragexit",l.util.handleDrag,!1),e.addEventListener("dragleave",l.util.handleDrag,!1),e.addEventListener("dragover",l.util.handleDrag,!1),e.addEventListener("drop",l.uploadAsset,!1)},wrap:function(e){var t;return t=Array.prototype.slice.call(arguments,1),function(){return e.apply(this,t)}}},this.edit=function(e){var t,n,r;return n=$(e),r=n.offset(),t=n.attr("id"),console.log("Enabling inline editing of #"+t),e.contentEditable=!0,s=!0,a[t]=n.attr("style"),u[t]=n.html(),n.unbind("click"),$("body").append(l.config.overlay),$("#m-overlay").animate({opacity:.75},{duration:400,easing:"easeInOutExpo"}),n.css({"z-index":function(){var e;return e=900+Math.floor(Math.random()*81)}}),n.offset(r),l.util.isID("CMS_panel")||(l.panel.make(),l.panel.live()),$("#m-overlay").bind({click:l.util.wrap(l.save,e)})},this.save=function(e){var t,n,r,o,a;return r=$(e),t=r.attr("id"),o=r.html(),n=r.data("snippet-keyname")?r.data("snippet-keyname"):"default-key",a=l,e.contentEditable=!1,s=!1,l.panel.destroy(),l.util.bind(r,"click",l.util.wrap(l.edit,e)),l.util.isID("CMS_sync")||$("body").append('<div class="cms_message warn" id="CMS_sync" style="top: 50px;opacity: 0;"><div id="sync_loader" class="loader">syncing changes...</div></div>'),$("#m-overlay").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){$("#m-overlay").remove();if(o!==u[t])return $("#CMS_sync").animate({opacity:1},{duration:700,easing:"easeInOutExpo",complete:function(){return i++,a.sync({snippet_keyname:n,inner_html:o})}})}})},this.sync=function(e){var t;return t=l,$.apptools.dev.verbose("CMS","Initiating sync operation for snippet.",e),$.apptools.api.content.save_snippet(e).fulfill({success:function(){return i-1===0?($("#CMS_sync").html("changes saved!"),$("#CMS_sync").removeClass("warn").removeClass("error").addClass("yay"),setTimeout(function(){return $("#CMS_sync").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){return $("#CMS_sync").remove()}})},700),i--):i--},failure:function(n){return $("#CMS_sync").html("error syncing page."),$("#CMS_sync").removeClass("warn").addClass("error"),setTimeout(function(){return $("#CMS_sync").append('<br><a id="sync_retry" style="pointer: cursor;text-decoration: underline;">retry sync</a>'),t.util.bind($("#sync_retry"),"click",t.util.wrap(t.sync,e))},1500)}})},this.revert=function(e){var t;return t=$(e).data("snippet-keyname"),$.apptools.api.content.revert_snippet({snippet_keyname:t}).fulfill({success:function(){return $(_o).html(response.inner_html),$("body").append('div id="CMS_revert" class="cms_message yay" style="opacity: 0;">changes reverted!</div>'),$("#CMS_revert").animate({opacity:1},{duration:400,easing:"easeInOutExpo",complete:function(){return setTimeout(function(){return $("#CMS_revert").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){return $("#CMS_revert").remove()}})},700)}})},failure:function(e){return $("#CMS_revert").html("error reverting page."),$("#CMS_revert").removeClass("warn").addClass("error")}})},this.uploadAsset=function(e){var t,n,r,i,s,o;e.preventDefault(),e.stopPropagation(),$(e.target).removeClass("hover"),n=e.dataTransfer.files,r=function(e){var t;if(e.type.match(/image.*/))return t=new FileReader,t.onloadend=this.util.imgPreview,t.readAsDataURL(e)},o=[];for(i=0,s=n.length;i<s;i++)t=n[i],o.push(r(t));return o},this.placeAsset=function(e){},this.panel={make:function(){var e;return e=l.config.panel.panel_html,$("body").append(e),$("#CMS_panel").css({bottom:"0px"}),$("#CMS_wrap").css({opacity:1}),$("#CMS_panel").animate({bottom:"60px",opacity:1},{duration:500,easing:"easeInOutExpo"})},live:function(){var e,t,n,r,i,s;n=l.config.panel.commands,r=l.config.scroller.frame,s=document.getElementById("upload"),i=l,$(".scroll").each(function(){var e,t,n;return n=this,e=$(n),t=String(e.attr("href")).slice(1),e.attr("id","scr"+t),e.attr("href","javascript:void(0);"),$("#"+r).data("scroller",{axis:"horizontal"}),i.util.bind(e,"click",i.util.wrap(i.scroller.jump,t)),i.config.scroller.init=!0}),l.scroller.classify(r),$(".pop").each(function(){var e,t,n;return n=this,e=$(n),t=e.attr("name"),e.removeAttr("name"),e.data("pop",{target:t}),i.util.bind(e,"click",i.util.wrap(i.pop.pop,t)),i.config.pop.init=!0}),l.util.makeDragDrop(s);for(t in n)e=n[t],l.util.bind($("#cms_"+t),"click",e);return l.config.panel.init=!0},die:function(){var e,t,n,r;n=l.config.panel.commands,r=[];for(t in n)e=n[t],r.push($("#cms_"+t).unbind("click"));return r},destroy:function(){var e;$("#m-overlay").unbind(),e=!0;if(s===!1)return $("#CMS_panel").animate({opacity:0,bottom:"0px"},{duration:450,easing:"easeInOutExpo",complete:function(){return e===!0?$("#CMS_wrap").remove():$("#CMS_wrap").css({opacity:1})}})},toggle:function(){return l.util.is($("#CMS_panel"))?(l.panel.destroy,$("#cms_span").html("&gt;")):(l.panel.make(),l.panel.live(),$("#cms_span").html("x"))}},this.scroller={classify:function(e){var t,n;t=$("#"+e),n=t.data("scroller");if(n.axis==="horizontal"||!l.util.is(n.axis))return $(".cms_pane").removeClass("left").removeClass("clear").addClass("in-table"),t.addClass("nowrap");if(n.axis==="vertical")return t.removeClass("nowrap"),$(".cms_pane").removeClass("in-table").addClass("left").addClass("clear")},jump:function(t,n,r){var i,s,o,u,a,f;l.util.is(e)&&(e.preventDefault(),e.stopPropagation()),s=$("#"+l.config.scroller.frame),i=s.data("scroller"),o=l.util.is(n)?$.extend({},l.config.scroller.animation,{complete:n}):l.config.scroller.animation,a=s.offset(),f=$("#"+t).offset();if(i.axis==="vertical")return u=Math.floor(f.top-a.top),s.animate({scrollTop:"+="+u},o);if(i.axis==="horizontal")return u=Math.floor(f.left-a.left),s.animate({scrollLeft:"+="+u},o)}},this.pop={pop:function(e){var t,n,r,i,s,o,u,a,f;return f=l,t=$("#"+e),s="pop_"+e,r=s+"_button",u=l.config.pop.position,i=t.html(),a=t.prev().attr("id"),$b.unbind("click"),n=$.extend({},l.config.pop.animation,{complete:function(){return t.remove(),$("#"+r).html("pop back in"),f.util.bind($("#"+r),"click",f.util.wrap(f.pop.reset,e,"CMS_frame")),f.util.makeDragDrop(document.getElementById("upload"))}}),o='<div id="'+s+'" class="fixed panel" style="opacity:0;">'+i+"</div>",$("body").append(o),$("#"+s).css({bottom:"0px",right:u.right,"z-index":989}),$("#"+s).animate({bottom:u.bottom,opacity:1},n),l.scroller.jump(a)},reset:function(e,t){var n,r,i,s,o;return t===!1||!l.util.is(t)?$("#pop_"+e).remove():(o=l,s="pop_"+iD,n=$("#"+t),i=s+"_button",$(i).unbind("click"),r=$.extend({},l.config.pop.animation,{complete:function(){return $("#"+s).remove(),$("#"+i).html("pop me out"),o.util.bind($("#"+i),"click",o.util.wrap(o.pop.pop,e)),o.util.makeDragDrop(document.getElementById("upload"))}}))}},this.modal={show:function(e,t,n){var i,s,o,u,a,f;return i={opacity:1},a=this.util.is(n)?$.extend({},this.config.modal.animation,{complete:n}):this.config.modal.animation,f=this.config.modal.html.split("*****"),s=f[0]+t+f[1],u=Math.floor(this.config.modal.ratio.x*r.innerWidth),o=Math.floor(this.config.modal.ratio.y*r.innerHeight),i.width=u+"px",i.height=o+"px",i.top=Math.floor((r.innerHeight-o)/2),i.left=Math.floor((r.innerWidth-u)/2),$("body").append(this.config.overlay),$("#m-overlay").animate({opacity:.5},{duration:400,easing:"easeInOutExpo",complete:function(){return this.util.bind($("#m-overlay"),"click",this.modal.hide)}}),$("body").append(s),$("#modal-wrap").css({opacity:1}),this.config.modal.rounded&&$("#modal").addClass("rounded"),$("#modal").css(this.config.modal.initial),$("#modal").animate(i,a),this.util.bind($("#mod-close"),"click",this.modal.hide)},hide:function(){var e,t;return e=$("#modal"),t=$.extend({},this.config.modal.initial,{left:"0px",width:r.innerWidth,right:"0px",opacity:.5}),setTimeout(function(){return e.removeClass("rounded"),e.css({padding:0})},150),e.animate(t,{duration:400,easing:"easeInOutExpo",complete:function(){return e.animate({opacity:0},{duration:250,easing:"easeInOutExpo"}),$("#m-overlay").animate({opacity:0},{duration:500,easing:"easeInOutExpo",complete:function(){return $("#m-overlay").remove(),$("#modal_wrap").remove()}})}})}},t.dev.verbose("CMS","Initializing Momentum extensible management system..."),f=this,$("body").append(this.config.panel.status_html),setTimeout(function(){return $("#cms_span").animate({opacity:1},{duration:450,easing:"easeInOutExpo"}),$("#cms_edit_on").animate({opacity:1,left:"-155px"},{duration:400,easing:"easeInOutExpo",complete:function(){return setTimeout(function(){return $("#cms_edit_on").animate({left:"-290px"},{duration:400,easing:"easeInOutExpo",complete:function(){return f.util.bind($("#cms_edit_on"),"click",f.panel.toggle),f.panel.toggle()}})},1750)}})},500),$(".editable").each(function(){var e=this;f.util.bind($(e),"click",f.util.wrap(f.edit,e))})}return X(n,t),n.mount="content",n.events=[],n}(c),this.__apptools_preinit.abstract_base_classes.push(f),this.__apptools_preinit.deferred_core_modules.push({module:f,"package":"admin"}),n=function(){function e(e){var t,n,r,i,s,o=this;this.config={rpc:{base_uri:"/_api/rpc",host:null,enabled:!0},sockets:{host:null,enabled:!1}},this.lib={},this.sys={platform:{},version:this.version,core_events:["SYS_MODULE_LOADED","SYS_LIB_LOADED","SYS_DRIVER_LOADED"],state:{status:"NOT_READY",flags:["base"],modules:{},classes:{},interfaces:{},integrations:[],add_flag:function(e){return this.sys.flags.push(e)},consider_preinit:function(t){var n,r,i,s,u,a,f,l,c,h,p,d;if(t.abstract_base_classes!=null){h=t.abstract_base_classes;for(i=0,f=h.length;i<f;i++){n=h[i],o.sys.state.classes[n.name]=n,n["package"]!=null&&o.sys.state.modules[n["package"]]!=null&&(o.sys.state.modules[n["package"]].classes[n.name]=n);if(n["export"]!=null&&n["export"]==="private")continue;e[n.name]=n}}if(t.deferred_library_integrations!=null){p=t.deferred_library_integrations;for(u=0,l=p.length;u<l;u++)r=p[u],o.sys.libraries.install(r.name,r.library)}if(t.abstract_feature_interfaces!=null){d=t.abstract_feature_interfaces;for(a=0,c=d.length;a<c;a++)s=d[a],o.sys.interfaces.install(s.name,s.adapter)}return t}},modules:{install:function(t,n,r){var i,s,u,a;return n==null&&(n=null),r==null&&(r=null),n!=null&&(typeof n=="function"?(r=n,s=null):s=n),s!=null?(o[s]==null&&(o[s]={}),s=o[s],u=!0):(s=o,u=!1),t.mount!=null?i=t.mount:i=t.name.toLowerCase(),t.events!=null&&o.events!=null&&o.events.register(t.events),s[i]==null&&(u?(a=s[i]=new t(o,s,e),o.sys.state.modules[i]={module:a,classes:{}}):(a=s[i]=new t(o,e),o.sys.state.modules[i]={module:a,classes:{}})),t._init!=null&&t._init(o),o.dev!=null&&o.dev.verbose!=null&&o.dev.verbose("ModuleLoader","Installed module:",a," at mountpoint: ",s," under the name: ",i),o.events!=null&&o.events.trigger("SYS_MODULE_LOADED",{module:a,mountpoint:s}),r!=null&&r(a),a}},libraries:{install:function(e,t,n){return n==null&&(n=null),o.lib[e.toLowerCase()]=t,o.sys.state.integrations.push(e.toLowerCase()),o.dev.verbose("LibLoader",e+" detected."),o.events.trigger("SYS_LIB_LOADED",{name:e,library:t}),n!=null&&n(t,e),o.lib[e.toLowerCase()]},resolve:function(e){var t,n,r,i;e=e.toLowerCase(),i=o.sys.state.integrations;for(n=0,r=i.length;n<r;n++){t=i[n];if(t!==e)continue;return o.lib[e.toLowerCase()]}}},interfaces:{install:function(e,t){return o.dev.verbose("InterfaceLoader",'Installed "'+e+'" interface.'),o.events.trigger("SYS_INTERFACE_LOADED",{name:e,adapter:t}),o.sys.state.interfaces[e]={adapter:t,methods:t.methods},o.sys.state.interfaces[e]},resolve:function(e){return o.sys.state.interfaces[e]!=null?o.sys.state.interfaces[e]:!1}},drivers:{query:{},loader:{},transport:{},storage:{},render:{},install:function(e,t,n,r,i,s,u){return u==null&&(u=null),o.sys.drivers[e][t]={name:t,driver:r,enabled:i,priority:s,"interface":n},u!=null&&u(o.sys.drivers[e][t].driver),o.events.trigger("SYS_DRIVER_LOADED",o.sys.drivers[e][t]),o.sys.drivers[e][t]},resolve:function(e,t,n){var r,i,s;t==null&&(t=null),n==null&&(n=!1);if(o.sys.drivers[e]==null){apptools.dev.critical("CORE",'Unkown driver type "'+e+'".');return}if(t!=null)return o.sys.drivers[e][t]!=null?o.sys.drivers[e][t].driver:(n&&apptools.dev.critical("CORE","Could not resolve driver ",t," of type ",e,"."),!1);i=-1,s=!1;for(r in o.sys.drivers[e]){r=o.sys.drivers[e][r];if(r.priority>i){s=r;break}}return s}},go:function(){return o.dev.log("Core","All systems go."),o.sys.state.status="READY",o}},this.sys.modules.install(p,function(e){return e.verbose("CORE","CoreDevAPI is up and running.")}),this.sys.modules.install(v,function(e){return e.register(o.sys.core_events)}),e.__apptools_preinit!=null&&this.sys.state.consider_preinit(e.__apptools_preinit),(e!=null?e.Modernizr:void 0)!=null&&this.sys.libraries.install("Modernizr",e.Modernizr,function(e,t){return o.load=function(){var e,t;return e=1<=arguments.length?z.call(arguments,0):[],(t=o.lib.modernizr).load.apply(t,e)}}),(e!=null?e.jQuery:void 0)!=null&&this.sys.libraries.install("jQuery",e.jQuery,function(e,t){return o.sys.drivers.install("query","jquery",o.sys.state.classes.QueryDriver,o.lib.jquery,!0,100,null),o.sys.drivers.install("transport","jquery",o.sys.state.classes.RPCDriver,o.lib.jquery,!0,100,null)}),(e!=null?e.Zepto:void 0)!=null&&this.sys.libraries.install("Zepto",e.Zepto,function(e,t){return o.sys.drivers.install("query","zepto",o.sys.state.classes.QueryDriver,o.lib.zepto,!0,500,null),o.sys.drivers.install("transport","zepto",o.sys.state.classes.RPCDriver,o.lib.zepto,!0,500,null)}),(e!=null?e._:void 0)!=null&&this.sys.libraries.install("Underscore",e._,function(e,t){return o.sys.drivers.install("query","underscore",o.sys.state.classes.QueryDriver,o.lib.underscore,!0,50,null),o.sys.drivers.install("render","underscore",o.sys.state.classes.RenderDriver,o.lib.underscore,!0,50,null)}),(e!=null?e.Backbone:void 0)!=null&&this.sys.libraries.install("Backbone",e.Backbone),(e!=null?e.Lawnchair:void 0)!=null&&this.sys.libraries.install("Lawnchair",e.Lawnchair,function(e){return o.sys.drivers.install("storage","lawnchair",o.sys.state.classes.StorageDriver,o.lib.lawnchair,!0,500,function(e){return o.dev.verbose("Lawnchair","Storage is currently stubbed. Come back later.")})}),(e!=null?e.amplify:void 0)!=null&&this.sys.libraries.install("Amplify",e.amplify,function(e){return o.sys.drivers.register("transport","amplify",o.sys.state.classes.RPCDriver,o.lib.amplify,!0,500,null),o.sys.drivers.register("storage","amplify",o.sys.state.classes.StorageDriver,o.lib.amplify,!0,100,null)}),(e!=null?e.Milk:void 0)!=null&&this.sys.libraries.install("Milk",e.Milk,function(e){return o.sys.drivers.install("render","milk",o.sys.state.classes.RenderDriver,o.lib.milk,!0,100,function(e){return o.dev.verbose("Milk","Render support is currently stubbed. Come back later.")})}),(e!=null?e.Mustache:void 0)!=null&&this.sys.libraries.install("Mustache",e.Mustache,function(e){return o.sys.drivers.register("render","mustache",o.sys.state.classes.RenderDriver,o.lib.mustache,!0,500,function(e){return o.dev.verbose("Mustache","Render support is currently stubbed. Come back later.")})}),this.sys.modules.install(y),this.sys.modules.install(h),this.sys.modules.install(d),this.sys.modules.install(E),this.sys.modules.install(w),this.sys.modules.install(T),this.sys.modules.install(x),this.sys.modules.install(S);if(((i=e.__apptools_preinit)!=null?i.deferred_core_modules:void 0)!=null){s=e.__apptools_preinit.deferred_core_modules;for(n=0,r=s.length;n<r;n++)t=s[n],t["package"]!=null?this.sys.modules.install(t.module,t["package"]):this.sys.modules.install(t.module)}return this.sys.go()}return e.version={major:0,minor:1,micro:4,build:4282012,release:"BETA",get:function(){return[[[this.major.toString(),this.minor.toString(),this.micro.toString()].join("."),this.build.toString()].join("-"),this.release].join(" ")}},e}(),window.AppTools=n,window.apptools=new n(window),window.jQuery!=null?$.extend({apptools:window.apptools}):(window.$=function(e){return document.getElementById(e)},window.$.apptools=window.apptools)}).call(this);