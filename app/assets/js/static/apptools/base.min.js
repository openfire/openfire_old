// Generated by CoffeeScript 1.3.3
(function(){var Accordion,AccordionAPI,AppException,AppTools,AppToolsCollection,AppToolsException,AppToolsModel,AppToolsRouter,AppToolsView,ArrayBufferUploader,BinaryUploader,CoreAPI,CoreAgentAPI,CoreDevAPI,CoreDispatchAPI,CoreEventsAPI,CoreException,CoreInterface,CoreModelAPI,CoreObject,CorePushAPI,CoreRPCAPI,CoreRenderAPI,CoreStorageAPI,CoreUserAPI,CoreWidget,CoreWidgetAPI,DataURLUploader,Editor,EditorAPI,Expand,Find,IndexedDBDriver,IndexedDBEngine,KeyEncoder,LocalStorageDriver,LocalStorageEngine,Milk,Modal,ModalAPI,Model,Parse,PushDriver,QueryDriver,RPCAPI,RPCDriver,RPCRequest,RPCResponse,RenderDriver,Scroller,ScrollerAPI,SessionStorageDriver,SessionStorageEngine,SimpleKeyEncoder,Sticky,StickyAPI,StorageAdapter,StorageDriver,Tabs,TabsAPI,Template,TemplateCache,Uploader,UploaderAPI,Util,WebSQLDriver,WebSQLEngine,_simple_key_encoder,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1},_this=this;this.__apptools_preinit={},TemplateCache={},Find=function(name,stack,value){var ctx,i,part,parts,_i,_j,_len,_ref,_ref1;value==null&&(value=null);if(name===".")return stack[stack.length-1];_ref=name.split(/\./),name=_ref[0],parts=2<=_ref.length?__slice.call(_ref,1):[];for(i=_i=_ref1=stack.length-1;_ref1<=-1?_i<-1:_i>-1;i=_ref1<=-1?++_i:--_i){if(stack[i]==null)continue;if(typeof stack[i]=="object"&&name in(ctx=stack[i])){value=ctx[name];break}continue}for(_j=0,_len=parts.length;_j<_len;_j++)part=parts[_j],value=Find(part,[value]);return value instanceof Function&&(value=function(value){return function(){var val;return val=value.apply(ctx,arguments),val instanceof Function&&val.apply(null,arguments)||val}}(value)),value},Expand=function(){var args,f,obj,tmpl;return obj=arguments[0],tmpl=arguments[1],args=3<=arguments.length?__slice.call(arguments,2):[],function(){var _i,_len,_results;_results=[];for(_i=0,_len=tmpl.length;_i<_len;_i++)f=tmpl[_i],_results.push(f.call.apply(f,[obj].concat(__slice.call(args))));return _results}().join("")},Parse=function(template,delimiters,section){var BuildRegex,buffer,buildInterpolationTag,buildInvertedSectionTag,buildPartialTag,buildSectionTag,cache,content,contentEnd,d,error,escape,isStandalone,match,name,parseError,pos,sectionInfo,tag,tagPattern,tmpl,type,whitespace,_name,_ref,_ref1,_ref2;delimiters==null&&(delimiters=["{{","}}"]),section==null&&(section=null),cache=TemplateCache[_name=delimiters.join(" ")]||(TemplateCache[_name]={});if(template in cache)return cache[template];buffer=[],BuildRegex=function(){var tagClose,tagOpen;return tagOpen=delimiters[0],tagClose=delimiters[1],RegExp("([\\s\\S]*?)([ \\t]*)(?:"+tagOpen+"\\s*(?:(!)\\s*([\\s\\S]+?)|(=)\\s*([\\s\\S]+?)\\s*=|({)\\s*(\\w[\\S]*?)\\s*}|([^0-9a-zA-Z._!={]?)\\s*([\\w.][\\S]*?))\\s*"+tagClose+")","gm")},tagPattern=BuildRegex(),tagPattern.lastIndex=pos=(section||{start:0}).start,parseError=function(pos,msg){var carets,e,endOfLine,error,indent,key,lastLine,lastTag,lineNo,parsedLines,tagStart;(endOfLine=/$/gm).lastIndex=pos,endOfLine.exec(template),parsedLines=template.substr(0,pos).split("\n"),lineNo=parsedLines.length,lastLine=parsedLines[lineNo-1],tagStart=contentEnd+whitespace.length,lastTag=template.substr(tagStart+1,pos-tagStart-1),indent=(new Array(lastLine.length-lastTag.length+1)).join(" "),carets=(new Array(lastTag.length+1)).join("^"),lastLine+=template.substr(pos,endOfLine.lastIndex-pos),error=new Error;for(key in e={message:""+msg+"\n\nLine "+lineNo+":\n"+lastLine+"\n"+indent+carets,error:msg,line:lineNo,"char":indent.length,tag:lastTag})error[key]=e[key];return error};while(match=tagPattern.exec(template)){_ref=match.slice(1,3),content=_ref[0],whitespace=_ref[1],type=match[3]||match[5]||match[7]||match[9],tag=match[4]||match[6]||match[8]||match[10],contentEnd=pos+content.length-1,pos=tagPattern.lastIndex,isStandalone=(contentEnd===-1||template.charAt(contentEnd)==="\n")&&((_ref1=template.charAt(pos))===void 0||_ref1===""||_ref1==="\r"||_ref1==="\n"),content&&buffer.push(function(content){return function(){return content}}(content)),isStandalone&&type!==""&&type!=="&"&&type!=="{"?(template.charAt(pos)==="\r"&&(pos+=1),template.charAt(pos)==="\n"&&(pos+=1)):whitespace&&(buffer.push(function(whitespace){return function(){return whitespace}}(whitespace)),contentEnd+=whitespace.length,whitespace="");switch(type){case"!":break;case"":case"&":case"{":buildInterpolationTag=function(name,is_unescaped){return function(context){var value,_ref2;return(value=(_ref2=Find(name,context))!=null?_ref2:"")instanceof Function&&(value=Expand.apply(null,[this,Parse(""+value())].concat(__slice.call(arguments)))),is_unescaped||(value=this.escape(""+value)),""+value}},buffer.push(buildInterpolationTag(tag,type));break;case">":buildPartialTag=function(name,indentation){return function(context,partials){var partial;return partial=partials(name).toString(),indentation&&(partial=partial.replace(/^(?=.)/gm,indentation)),Expand.apply(null,[this,Parse(partial)].concat(__slice.call(arguments)))}},buffer.push(buildPartialTag(tag,whitespace));break;case"#":case"^":sectionInfo={name:tag,start:pos,error:parseError(tagPattern.lastIndex,"Unclosed section '"+tag+"'!")},_ref2=Parse(template,delimiters,sectionInfo),tmpl=_ref2[0],pos=_ref2[1],sectionInfo["#"]=buildSectionTag=function(name,delims,raw){return function(context){var parsed,result,v,value;return value=Find(name,context)||[],tmpl=value instanceof Function?value(raw):raw,value instanceof Array||(value=[value]),parsed=Parse(tmpl||"",delims),context.push(value),result=function(){var _i,_len,_results;_results=[];for(_i=0,_len=value.length;_i<_len;_i++)v=value[_i],context[context.length-1]=v,_results.push(Expand.apply(null,[this,parsed].concat(__slice.call(arguments))));return _results}.apply(this,arguments),context.pop(),result.join("")}},sectionInfo["^"]=buildInvertedSectionTag=function(name,delims,raw){return function(context){var value;return value=Find(name,context)||[],value instanceof Array||(value=[1]),value=value.length===0?Parse(raw,delims):[],Expand.apply(null,[this,value].concat(__slice.call(arguments)))}},buffer.push(sectionInfo[type](tag,delimiters,tmpl));break;case"/":section==null?error="End Section tag '"+tag+"' found, but not in section!":tag!==(name=section.name)&&(error="End Section tag closes '"+tag+"'; expected '"+name+"'!");if(error)throw parseError(tagPattern.lastIndex,error);return template=template.slice(section.start,contentEnd+1||9e9),cache[template]=buffer,[template,pos];case"=":(delimiters=tag.split(/\s+/)).length!==2&&(error="Set Delimiters tags should have two and only two values!");if(error)throw parseError(tagPattern.lastIndex,error);escape=/[-[\]{}()*+?.,\\^$|#]/g,delimiters=function(){var _i,_len,_results;_results=[];for(_i=0,_len=delimiters.length;_i<_len;_i++)d=delimiters[_i],_results.push(d.replace(escape,"\\$&"));return _results}(),tagPattern=BuildRegex();break;default:throw parseError(tagPattern.lastIndex,"Unknown tag type -- "+type)}tagPattern.lastIndex=pos!=null?pos:template.length}if(section!=null)throw section.error;return template.length!==pos&&buffer.push(function(){return template.slice(pos)}),cache[template]=buffer},Milk={VERSION:"1.2.0",helpers:[],partials:null,escape:function(value){var entities;return entities={"&":"amp",'"':"quot","<":"lt",">":"gt"},value.replace(/[&"<>]/g,function(ch){return"&"+entities[ch]+";"})},render:function(template,data,partials){var context;return partials==null&&(partials=null),(partials||(partials=this.partials||{}))instanceof Function||(partials=function(partials){return function(name){if(name in partials)return Find(name,[partials]);throw"Unknown partial '"+name+"'!"}}(partials)),context=this.helpers instanceof Array?this.helpers:[this.helpers],Expand(this,Parse(template),context.concat([data]),partials)}},this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes=[],this.__apptools_preinit.deferred_core_modules=[],this.__apptools_preinit.abstract_feature_interfaces=[],this.__apptools_preinit.deferred_library_integrations=[]):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[],abstract_feature_interfaces:[],deferred_library_integrations:[]},CoreAPI=function(){function CoreAPI(){}return CoreAPI}(),this.__apptools_preinit.abstract_base_classes.push(CoreAPI),CoreObject=function(){function CoreObject(){}return CoreObject}(),this.__apptools_preinit.abstract_base_classes.push(CoreObject),CoreInterface=function(){function CoreInterface(){}return CoreInterface}(),this.__apptools_preinit.abstract_base_classes.push(CoreInterface),CoreException=function(_super){function CoreException(module,message,context){this.module=module,this.message=message,this.context=context}return __extends(CoreException,_super),CoreException.prototype.toString=function(){return"["+this.module+"] CoreException: "+this.message},CoreException}(Error),this.__apptools_preinit.abstract_base_classes.push(CoreException),AppException=function(_super){function AppException(){return AppException.__super__.constructor.apply(this,arguments)}return __extends(AppException,_super),AppException.prototype.toString=function(){return"["+this.module+"] AppException: "+this.message},AppException}(CoreException),AppToolsException=function(_super){function AppToolsException(){return AppToolsException.__super__.constructor.apply(this,arguments)}return __extends(AppToolsException,_super),AppToolsException.prototype.toString=function(){return"["+this.module+"] AppToolsException: "+this.message},AppToolsException}(CoreException),this.__apptools_preinit.abstract_base_classes.push(AppException),this.__apptools_preinit.abstract_base_classes.push(AppToolsException),this.Backbone!=null?(AppToolsView=function(_super){function AppToolsView(){return AppToolsView.__super__.constructor.apply(this,arguments)}return __extends(AppToolsView,_super),AppToolsView}(Backbone.View),AppToolsModel=function(_super){function AppToolsModel(){return AppToolsModel.__super__.constructor.apply(this,arguments)}return __extends(AppToolsModel,_super),AppToolsModel}(Backbone.Model),AppToolsRouter=function(_super){function AppToolsRouter(){return AppToolsRouter.__super__.constructor.apply(this,arguments)}return __extends(AppToolsRouter,_super),AppToolsRouter}(Backbone.Router),AppToolsCollection=function(_super){function AppToolsCollection(){return AppToolsCollection.__super__.constructor.apply(this,arguments)}return __extends(AppToolsCollection,_super),AppToolsCollection}(Backbone.Collection)):(AppToolsView=function(){function AppToolsView(){}return AppToolsView}(),AppToolsModel=function(){function AppToolsModel(){}return AppToolsModel}(),AppToolsRouter=function(){function AppToolsRouter(){}return AppToolsRouter}(),AppToolsCollection=function(){function AppToolsCollection(){}return AppToolsCollection}()),this.__apptools_preinit.abstract_base_classes.push(AppToolsView),this.__apptools_preinit.abstract_base_classes.push(AppToolsModel),this.__apptools_preinit.abstract_base_classes.push(AppToolsRouter),this.__apptools_preinit.abstract_base_classes.push(AppToolsCollection),Util=function(){function Util(){this.zero_fill=__bind(this.zero_fill,this),this.wrap=__bind(this.wrap,this),this.to_rgb=__bind(this.to_rgb,this),this.to_hex=__bind(this.to_hex,this),this.extend=__bind(this.extend,this),this.throttle=__bind(this.throttle,this),this.prep_animation=__bind(this.prep_animation,this),this.timestamp=__bind(this.timestamp,this),this.now=__bind(this.now,this),this.block=__bind(this.block,this),this.unbind=__bind(this.unbind,this),this.bind=__bind(this.bind,this),this.is_id=__bind(this.is_id,this),this.has_class=__bind(this.has_class,this),this.get_offset=__bind(this.get_offset,this),this.get=__bind(this.get,this),this.remove=__bind(this.remove,this),this.add=__bind(this.add,this),this.create_doc_frag=__bind(this.create_doc_frag,this),this.create_element_string=__bind(this.create_element_string,this),this.filter=__bind(this.filter,this),this.to_array=__bind(this.to_array,this),this.in_array=__bind(this.in_array,this),this.is_body=__bind(this.is_body,this),this.is_empty_object=__bind(this.is_empty_object,this),this.is_raw_object=__bind(this.is_raw_object,this),this.is_object=__bind(this.is_object,this),this.is_function=__bind(this.is_function,this),this.is=__bind(this.is,this);var _this=this;this._state={active:null,queues:{fx:[],dom:[],handlers:{}}},this.internal={queues:{add:function(name,callback){return _this._state.queues[name]=[],_this._state.queues.handlers[name]=_this.debounce(function(n,c){return _this.internal.queues.process(n,c)},_this.prep_animation().duration,!0)},remove:function(name,callback){var handler,q;return handler=_this._state.queues.handlers[name],delete _this._state.queues.handlers[name],q=_this._state.queues[name],delete _this._state.queues[name],q.length>0?{queue:q,handler:handler}:!0},go:function(name,callback){return _this._state.queues.handlers[name](name,callback)},process:function(name,callback){var q;return q=_this._state.queues[name],_this._state.queues[name]=[],callback!=null?callback.call(_this,{queue:q,name:name}):void 0}}},this._init=function(apptools){}}var _this=this;return Util.mount="util",Util.events=[],Util.prototype.is=function(thing){return!this.in_array(thing,[!1,null,NaN,void 0,0,{},[],"","false","False","null","NaN","undefined","0","none","None"])},Util.prototype.is_function=function(object){return typeof object=="function"},Util.prototype.is_object=function(object){return typeof object=="object"},Util.prototype.is_raw_object=function(object){return!object||typeof object!="object"||object.nodeType||typeof object=="object"&&__indexOf.call(object,"setInterval")>=0?!1:object.constructor!=null&&!object.hasOwnProperty("constructor")&&!object.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0},Util.prototype.is_empty_object=function(object){var key,_i,_len;for(_i=0,_len=object.length;_i<_len;_i++)return key=object[_i],!1;return!0},Util.prototype.is_body=function(object){return this.is_object(object)&&(Object.prototype.toString.call(object)==="[object HTMLBodyElement]"||object.constructor.name==="HTMLBodyElement")},Util.prototype.is_array=Array.isArray||function(object){return typeof object=="array"||Object.prototype.toString.call(object)==="[object Array]"||object.constructor.name==="Array"},Util.prototype.in_array=function(item,array){var it,matches,_fn,_i,_len,_this=this;if(array.indexOf!=null)return!!~array.indexOf(item);matches=[],_fn=function(it){if(it===item)return matches.push(it)};for(_i=0,_len=array.length;_i<_len;_i++)it=array[_i],_fn(it);return matches.length>0},Util.prototype.to_array=function(node_or_token_list){var array;array=[];for(i=node_or_token_list.length;i--;array.unshift(node_or_token_list[i]));return array},Util.prototype.filter=function(array,condition){var item,new_array,_i,_len;new_array=[];for(_i=0,_len=array.length;_i<_len;_i++)item=array[_i],condition(item)&&new_array.push(item);return new_array},Util.prototype.sort=null,Util.prototype.create_element_string=function(tag,attrs,separator){var el_str,k,no_close,v;separator==null&&(separator="*"),no_close=["area","base","basefont","br","col","frame","hr","img","input","link"],tag=tag.toLowerCase(),el_str="<"+tag;for(k in attrs)v=attrs[k],el_str+=" "+k+'="'+v+'"';return el_str+=">",this.in_array(tag,no_close)||(el_str+=separator+"</"+tag+">"),el_str},Util.prototype.create_doc_frag=function(html_string){var frag,range;return range=document.createRange(),range.selectNode(document.getElementsByTagName("div").item(0)),frag=range.createContextualFragment(html_string),frag},Util.prototype.add=function(element_type,attrs,parent_node){var node_id,q_name,_this=this;return element_type==null||!this.is_object(attrs)?!1:(q_name=this.is_body(parent_node)||parent_node==null||!(node_id=parent_node.getAttribute("id"))?"dom":node_id,this._state.queues[q_name]==null&&this.internal.queues.add(q_name),this._state.queues[q_name].push([element_type,attrs]),this.internal.queues.go(q_name,function(response){var args,dfrag,html,parent,q,_i,_len;q=response.queue,parent=response.name==="dom"?document.body:_this.get(response.name),html=[];for(_i=0,_len=q.length;_i<_len;_i++)args=q[_i],html.push(_this.create_element_string.apply(_this,args));return dfrag=_this.create_doc_frag(html.join("")),parent.appendChild(dfrag)}))},Util.prototype.remove=function(node){return node.parentNode.removeChild(node)},Util.prototype.get=function(query,node){var cls,id,tg;return node==null&&(node=document),query==null?null:query.nodeType?query:(id=document.getElementById(query))!=null?id:(cls=node.getElementsByClassName(query)).length>0?this.to_array(cls):(tg=node.getElementsByTagName(query)).length>0?this.to_array(tg):null},Util.prototype.get_offset=function(elem){var offL,offT;offL=offT=0;for(;;){offL+=elem.offsetLeft,offT+=elem.offsetTop;if(!(elem=elem.offsetParent))break}return{left:offL,top:offT}},Util.prototype.has_class=function(element,cls){var _ref;return((_ref=element.classList)!=null?typeof _ref.contains=="function"?_ref.contains(cls):void 0:void 0)||element.className&&(new RegExp("\\s*"+cls+"\\s*")).test(element.className)},Util.prototype.is_id=function(str){return str.charAt(0)==="#"?!0:document.getElementById(str)!==null?!0:!1},Util.prototype.bind=function(element,event,fn,prop){var el,ev,evt,func,_i,_j,_len,_len1,_results,_results1,_results2;prop==null&&(prop=!1);if(element==null)return!1;if(this.is_array(element)){_results=[];for(_i=0,_len=element.length;_i<_len;_i++)el=element[_i],_results.push(this.bind(el,event,fn,prop));return _results}if(this.is_array(event)){_results1=[];for(_j=0,_len1=event.length;_j<_len1;_j++)evt=event[_j],_results1.push(this.bind(element,evt,fn,prop));return _results1}if(this.is_raw_object(event)){_results2=[];for(ev in event)func=event[ev],_results2.push(this.bind(element,ev,func,prop));return _results2}return element.addEventListener(event,fn,prop)},Util.prototype.unbind=function(element,event){var el,ev,_i,_j,_len,_len1,_results,_results1,_results2;if(element==null)return!1;if(this.is_array(element)){_results=[];for(_i=0,_len=element.length;_i<_len;_i++)el=element[_i],_results.push(this.unbind(el,event));return _results}if(this.is_array(event)){_results1=[];for(_j=0,_len1=event.length;_j<_len1;_j++)ev=event[_j],_results1.push(this.unbind(element,ev));return _results1}if(this.is_raw_object(element)){_results2=[];for(el in element)ev=element[el],_results2.push(this.unbind(el,ev));return _results2}return element.constructor.name==="NodeList"?this.unbind(this.to_array(element),event):element.removeEventListener(event)},Util.prototype.block=function(async_method,object){var result,_done;object==null&&(object={}),console.log("[Util] Enforcing blocking at user request... :("),_done=!1,result=null,async_method(object,function(x){return result=x,_done=!0});for(;;)if(_done!==!1)break;return result},Util.prototype.now=function(){return+(new Date)},Util.prototype.timestamp=function(d){return d==null&&(d=new Date),[[d.getMonth()+1,d.getDate(),d.getFullYear()].join("-"),[d.getHours(),d.getMinutes(),d.getSeconds()].join(":")].join(" ")},Util.prototype.prep_animation=function(t,e,c){var options;return options=t==null?{duration:400}:t!=null&&this.is_object(t)?this.extend({},t):{complete:c||!c&&e||is_function(t&&t),duration:t,easing:c&&e||e&&!is_function(e)},options},Util.prototype.throttle=function(fn,buffer,prefire){var last,timer_id,_this=this;return timer_id=null,last=0,function(){var args,clear,elapsed,go;return args=arguments,elapsed=_this.now()-last,clear=function(){return go(),timer_id=null},go=function(){return last=_this.now(),fn.apply(_this,args)},prefire&&!timer_id&&go(),!timer_id||clearTimeout(timer_id),prefire==null&&elapsed>=buffer?go():timer_id=setTimeout(prefire?clear:go,prefire==null?buffer-elapsed:buffer)}},Util.prototype.debounce=function(fn,buffer,prefire){return buffer==null&&(buffer=200),prefire==null&&(prefire=!1),this.throttle(fn,buffer,prefire)},Util.prototype.extend=function(){var arg,args,deep,i,len,target,_fn,_i,_len,_this=this;target=arguments[0]||{},i=1,deep=!1,len=arguments.length,typeof target=="boolean"&&(deep=target,target=arguments[1]||{},i++),!this.is_object(target)&&!this.is_function(target)&&(target={}),args=Array.prototype.slice.call(arguments,i),_fn=function(arg){var a,clone,copied_src,o,option,options,src,value,_results;options=arg,_results=[];for(option in options){value=options[option];if(target===value)continue;o=String(option),clone=value,src=target[option],deep&&clone!=null&&(_this.is_raw_object(clone)||(a=_this.is_array(clone)))?(a!=null?(a=!1,copied_src=src&&(_this.is_array(src)?src:[])):copied_src=src&&(_this.is_raw_object(src)?src:{}),_results.push(target[option]=_this.extend(deep,copied_src,clone))):clone!=null?_results.push(target[option]=clone):_results.push(void 0)}return _results};for(_i=0,_len=args.length;_i<_len;_i++)arg=args[_i],_fn(arg);return target},Util.prototype.to_hex=function(color){var b,c,g,r;if(color.match(/^#?[0-9A-F]{6}|[0-9A-F]{3}$\/i/))return color.charAt(!1)?color:"#"+color;if(!color.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/))return!1;c=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)];if(c.length===3)return r=this.zero_fill(c[0].toString(16,2)),g=this.zero_fill(c[1].toString(16,2)),b=this.zero_fill(c[2].toString(16,2)),"#"+r+g+b},Util.prototype.to_rgb=function(color){var b,c,g,r;return color.match(/^rgb\(\s*\d{1,3}\s*,\s\d{1,3}\s*,\s*\d{1,3}\s*\)$/)?color:color.match(/^#?([0-9A-F]{1,2})([0-9A-F]{1,2})([0-9A-F]{1,2})$\/i/)?(c=[parseInt(RegExp.$1,16),parseInt(RegExp.$2,16),parseInt(RegExp.$3,16)],r=c[0].toString(10),g=c[1].toString(10),b=c[2].toString(10),"rgb("+r+","+g+","+b+")"):!1},Util.prototype.wrap=function(e,fn){var args,i;return i=2,e.preventDefault!=null?(e.preventDefault(),e.stopPropagation()):(fn=e,i--),args=Array.prototype.slice.call(arguments,i),function(){return fn.apply(this,args)}},Util.prototype.zero_fill=function(num,length){return(Array(length).join("0")+num).slice(-length)},Util}.call(this),this.__apptools_preinit.abstract_base_classes.push(Util),this.__apptools_preinit.deferred_core_modules.push({module:Util}),window.Util=Util=new Util,CoreDevAPI=function(_super){function CoreDevAPI(apptools,window){var _this=this;this.config={},this.environment={},this.performance={},this.debug={logging:!0,eventlog:!0,verbose:!0,serverside:!1},this.setDebug=function(debug){return _this.debug=debug,_this._sendLog("[CoreDev] Debug has been set.",_this.debug)},this._sendLog=function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],console.log.apply(console,args)},this.log=function(){var context,message,module;module=arguments[0],message=arguments[1],context=3<=arguments.length?__slice.call(arguments,2):[],context==null&&(context="{no context}"),_this.debug.logging===!0&&_this._sendLog.apply(_this,["["+module+"] INFO: "+message].concat(__slice.call(context)))},this.warning=this.warn=function(){var context,message,module;module=arguments[0],message=arguments[1],context=3<=arguments.length?__slice.call(arguments,2):[],context==null&&(context="{no context}"),_this.debug.logging===!0&&_this._sendLog.apply(_this,["["+module+"] WARNING: "+message].concat(__slice.call(context)))},this.error=function(){var context,message,module;module=arguments[0],message=arguments[1],context=3<=arguments.length?__slice.call(arguments,2):[],_this.debug.logging===!0&&_this._sendLog.apply(_this,["["+module+"] ERROR: "+message].concat(__slice.call(context)))},this.verbose=function(){var context,message,module;module=arguments[0],message=arguments[1],context=3<=arguments.length?__slice.call(arguments,2):[],_this.debug.verbose===!0&&_this._sendLog.apply(_this,["["+module+"] DEBUG: "+message].concat(__slice.call(context)))},this.exception=this.critical=function(){var context,exception,message,module;throw module=arguments[0],message=arguments[1],exception=arguments[2],context=4<=arguments.length?__slice.call(arguments,3):[],exception==null&&(exception=window.AppToolsException),_this._sendLog("A critical error or unhandled exception occurred."),_this._sendLog.apply(_this,["["+module+"] CRITICAL: "+message].concat(__slice.call(context))),new exception(module,message,context)}}return __extends(CoreDevAPI,_super),CoreDevAPI.mount="dev",CoreDevAPI.events=[],CoreDevAPI}(CoreAPI),this.__apptools_preinit.abstract_base_classes.push(CoreDevAPI),CoreModelAPI=function(_super){function CoreModelAPI(){var _this=this;this.internal={block:function(){var async_method,params,results,_done;async_method=arguments[0],params=2<=arguments.length?__slice.call(arguments,1):[],_done=!1,results=null,async_method.apply(null,__slice.call(params).concat([function(r){return results=r,_done=!0}]));for(;;)if(_done!==!1)break;return results},validate:function(model,_model){var invalid,item,prop,_i,_len;_model==null&&(_model=model.constructor.prototype),invalid=[];for(prop in model){if(!{}.hasOwnProperty.call(model,prop))continue;if(model[prop].constructor.name===_model[prop].constructor.name)continue;invalid.push(prop)}for(_i=0,_len=invalid.length;_i<_len;_i++)return item=invalid[_i],invalid;return!0}},this.put=function(object){return _this.internal.block(_this.put_async,object)},this.get=function(key,kind){return _this.internal.block(_this.get_async,key,kind)},this["delete"]=function(key,kind){return _this.internal.block(_this.delete_async,key,kind)},this.put_async=function(callback){return callback==null&&(callback=function(x){return x}),apptools.storage.put(_this.constructor.prototype.name,callback)},this.get_async=function(key,callback){return callback==null&&(callback=function(x){return x}),apptools.storage.get(_this.key,_this.constructor.prototype.name,callback)},this.delete_async=function(callback){return callback==null&&(callback=function(x){return x}),apptools.storage["delete"](_this.key,_this.constructor.prototype.name,callback)},this.all=function(callback){throw callback==null||(Util!=null?!Util.is_function(callback):!void 0)?callback!=null?"Provided callback isn't a function. Whoops.":"all() requires a callback.":"all() currently in active development, sorry."},this.register=function(){return apptools.dev.verbose("CoreModelAPI","register() currently in active development, sorry.")}}return __extends(CoreModelAPI,_super),CoreModelAPI.mount="model",CoreModelAPI.events=[],CoreModelAPI.init=function(){},CoreModelAPI}(CoreAPI),Model=function(){function Model(){this.render=__bind(this.render,this),this.all=__bind(this.all,this),this.delete_async=__bind(this.delete_async,this),this.get_async=__bind(this.get_async,this),this.put_async=__bind(this.put_async,this),this["delete"]=__bind(this["delete"],this),this.get=__bind(this.get,this),this.put=__bind(this.put,this)}return Model.prototype.key=null,Model.prototype.put=function(){var args,_ref;return args=1<=arguments.length?__slice.call(arguments,0):[],(_ref=apptools.model).put.apply(_ref,[this].concat(__slice.call(args)))},Model.prototype.get=function(){var args,_ref;return args=1<=arguments.length?__slice.call(arguments,0):[],(_ref=apptools.model).get.apply(_ref,[this].concat(__slice.call(args)))},Model.prototype["delete"]=function(){var args,_ref;return args=1<=arguments.length?__slice.call(arguments,0):[],(_ref=apptools.model)["delete"].apply(_ref,[this].concat(__slice.call(args)))},Model.prototype.put_async=function(){var args,_ref;return args=1<=arguments.length?__slice.call(arguments,0):[],(_ref=apptools.model).put_async.apply(_ref,[this].concat(__slice.call(args)))},Model.prototype.get_async=function(){var args,_ref;return args=1<=arguments.length?__slice.call(arguments,0):[],(_ref=apptools.model).get_async.apply(_ref,[this].concat(__slice.call(args)))},Model.prototype.delete_async=function(){var args,_ref;return args=1<=arguments.length?__slice.call(arguments,0):[],(_ref=apptools.model).delete_async.apply(_ref,[this].concat(__slice.call(args)))},Model.prototype.all=function(){var args,_ref;return args=1<=arguments.length?__slice.call(arguments,0):[],(_ref=apptools.model).all.apply(_ref,[this].concat(__slice.call(args)))},Model.prototype.render=function(template){},Model}(),this.__apptools_preinit.abstract_base_classes.push(CoreModelAPI),this.__apptools_preinit.abstract_base_classes.push(Model),CoreEventsAPI=function(_super){function CoreEventsAPI(apptools,window){var _this=this;this.registry=[],this.callchain={},this.history=[],this.fire=this.trigger=function(){var args,bridge,callback_directive,event,event_bridges,hook_error_count,hook_exec_count,result,touched_events,_i,_j,_len,_len1,_ref;event=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],apptools.dev.verbose("Events","Triggered event:",event,args,_this.callchain[event]);if(__indexOf.call(_this.registry,event)>=0){hook_exec_count=0,hook_error_count=0,event_bridges=[],touched_events=[],touched_events.push(event),_ref=_this.callchain[event].hooks;for(_i=0,_len=_ref.length;_i<_len;_i++){callback_directive=_ref[_i];try{if(callback_directive.once===!0&&callback_directive.has_run===!0)continue;callback_directive.bridge!=null==0?(result=callback_directive.fn.apply(callback_directive,args),hook_exec_count++,_this.history.push({event:event,callback:callback_directive,args:args,result:result}),callback_directive.has_run=!0):callback_directive.bridge===!0&&event_bridges.push({event:callback_directive.event,args:args})}catch(error){hook_error_count++,_this.history.push({event:event,callback:callback_directive,args:args,error:error})}}for(_j=0,_len1=event_bridges.length;_j<_len1;_j++)bridge=event_bridges[_j],touched_events.push(bridge.event),_this.trigger.apply(_this,[bridge.event].concat(__slice.call(bridge.args)));return{events:touched_events,executed:hook_exec_count,errors:hook_error_count}}return!1},this.create=this.register=function(names){var name,_i,_len;names instanceof Array||(names=[names]);for(_i=0,_len=names.length;_i<_len;_i++)name=names[_i],_this.registry.push.apply(_this.registry,names),_this.callchain[name]={hooks:[]};return apptools.dev.verbose("Events","Registered events:",{count:names.length,events:names}),!0},this.on=this.upon=this.when=this.hook=function(event,callback,once){return once==null&&(once=!1),__indexOf.call(_this.registry,event)<0&&(apptools.dev.warning("Events",""),_this.register(event)),_this.callchain[event].hooks.push({fn:callback,once:once,has_run:!1,bridge:!1}),apptools.dev.verbose("Events","Hook registered on event.",event),!0},this.delegate=this.bridge=function(from_events,to_events){var source_ev,target_ev,_i,_len,_results;typeof to_events=="string"&&(to_events=[to_events]),typeof from_events=="string"&&(from_events=[from_events]),_results=[];for(_i=0,_len=from_events.length;_i<_len;_i++)source_ev=from_events[_i],_results.push(function(){var _j,_len1,_results1;_results1=[];for(_j=0,_len1=to_events.length;_j<_len1;_j++)target_ev=to_events[_j],apptools.dev.verbose("Events","Bridging events:",source_ev,"->",target_ev),this.callchain[source_ev]==null&&(apptools.dev.warn("Events","Bridging from undefined source event:",source_ev),this.register(source_ev)),_results1.push(this.callchain[source_ev].hooks.push({event:target_ev,bridge:!0}));return _results1}.call(_this));return _results}}return __extends(CoreEventsAPI,_super),CoreEventsAPI.mount="events",CoreEventsAPI.events=[],CoreEventsAPI}(CoreAPI),this.__apptools_preinit.abstract_base_classes.push(CoreEventsAPI),CoreAgentAPI=function(_super){function CoreAgentAPI(apptools,window){this._data={},this.platform={},this.capabilities={},apptools.lib.modernizr!=null&&(this.capabilities=apptools.lib.modernizr),this.capabilities.simple={},this._data={browsers:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString
:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}return __extends(CoreAgentAPI,_super),CoreAgentAPI.mount="agent",CoreAgentAPI.events=["UA_DISCOVER"],CoreAgentAPI.prototype._makeMatch=function(data){var prop,string,value,_i,_len;for(_i=0,_len=data.length;_i<_len;_i++){value=data[_i],string=value.string,prop=value.prop,this._data.versionSearchString=value.versionSearch||value.identity;if(string!==null){if(value.string.indexOf(value.subString)!==-1)return value.identity}else if(prop)return value.identity}},CoreAgentAPI.prototype._makeVersion=function(dataString){var index;index=dataString.indexOf(this._data.versionSearchString);if(index!==-1)return parseFloat(dataString.substring(index+this._data.versionSearchString.length+1))},CoreAgentAPI.prototype.discover=function(){var browser,mobile,os,type,version;browser=this._makeMatch(this._data.browsers)||"unknown",version=this._makeVersion(navigator.userAgent)||this._makeVersion(navigator.appVersion)||"unknown",os=this._makeMatch(this._data.os)||"unknown";if(browser==="iPod/iPhone"||browser==="Android")type="mobile",mobile=!1;this.platform={os:os,type:type,vendor:navigator.vendor,product:navigator.product,browser:browser,version:version,flags:{online:navigator.onLine||!0,mobile:mobile,webkit:$.browser.webkit,msie:$.browser.msie,opera:$.browser.opera,mozilla:$.browser.mozilla}},this.capabilities.simple.cookies=navigator.cookieEnabled;if(window.jQuery!=null)return this.capabilities.simple.ajax=$.support.ajax},CoreAgentAPI}(CoreAPI),this.__apptools_preinit.abstract_base_classes.push(CoreAgentAPI),CoreDispatchAPI=function(_super){function CoreDispatchAPI(apptools,window){var _this=this;this.state={opened:!1,receiving:!1,error:!1,history:{errors:[],received:[]},pending:{},complete:{}},this.init=function(){return _this.state.opened=!0,apptools.dev.verbose("Dispatch","Dispatch startup signal received.")},this.expect=function(id,request,xhr){return _this.state.pending[id]={request:request,callbacks:callbacks,xhr:xhr},apptools.dev.verbose("Dispatch","Received EXPECT signal.",id,request,callbacks,xhr)},this.receive=function(raw_response){var context,response,_base,_base1,_base2;try{response=JSON.parse(raw_response.data)}catch(e){response=raw_response.data}return apptools.dev.verbose("Dispatch","Parsed async message.",response),_this.state.history.received.push(raw_response),response.status==="ok"?(apptools.dev.verbose("Dispatch","Triggering deferred success callback."),_this.state.complete[response.id]=_this.state.pending[response.id],_this.state.complete[response.id].response=response,delete _this.state.pending[response.id],apptools.dev.log("RPC","Success",raw_response.data,response.status,_this.state.complete[response.id].xhr),apptools.api.rpc.lastResponse=raw_response.data,apptools.api.rpc.history[response.id].xhr=_this.state.complete[response.id].xhr,apptools.api.rpc.history[response.id].status=response.status,apptools.api.rpc.history[response.id].response=raw_response.data,context={xhr:_this.state.complete[response.id].xhr,status:response.status,data:raw_response.data},apptools.events.trigger("RPC_SUCCESS",context),typeof (_base=_this.state.complete[response.id].callbacks).success=="function"?_base.success(response.response.content):void 0):response.status==="notify"?(apptools.dev.verbose("Dispatch","Received NOTIFY signal."),typeof (_base1=_this.state.pending[response.id].callbacks).notify=="function"?_base1.notify(response.response.content):void 0):(apptools.dev.error("Dispatch","Userland deferred task error. Calling error callback.",response),typeof (_base2=_this.state.pending[response.id].callbacks).error=="function"?_base2.error(response.content):void 0)},this.error=function(error){return _this.state.error=!0,_this.history.errors.push(error),apptools.dev.error("Dispatch","Dispatch error state triggered.",error)},this.close=function(){return _this.state.opened=!1,_this.state.receiving=!1,apptools.dev.verbose("Dispatch","Dispatch shutdown signal received.")}}return __extends(CoreDispatchAPI,_super),CoreDispatchAPI.mount="dispatch",CoreDispatchAPI.events=[],CoreDispatchAPI}(CoreAPI),this.__apptools_preinit.abstract_base_classes.push(CoreDispatchAPI),StorageDriver=function(_super){function StorageDriver(){}return __extends(StorageDriver,_super),StorageDriver.methods=["compatible","construct"],StorageDriver["export"]="public",StorageDriver}(CoreInterface),this.compatible=function(){},this.construct=function(){},StorageAdapter=function(_super){function StorageAdapter(){return}return __extends(StorageAdapter,_super),StorageAdapter.methods=["get","put","delete","clear","get_async","put_async","delete_async","clear_async"],StorageAdapter["export"]="public",StorageAdapter}(CoreInterface),KeyEncoder=function(_super){function KeyEncoder(){return}return __extends(KeyEncoder,_super),KeyEncoder.methods=["build_key","encode_key","build_cluster","encode_cluster"],KeyEncoder["export"]="public",KeyEncoder}(CoreInterface),this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes==null&&(this.__apptools_preinit.abstract_base_classes=[]),this.__apptools_preinit.deferred_core_modules==null&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]},this.__apptools_preinit.detected_storage_engines=[],this.__apptools_preinit.abstract_base_classes.push(StorageDriver),this.__apptools_preinit.abstract_base_classes.push(StorageAdapter),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:StorageDriver,name:"storage"}),SimpleKeyEncoder=function(_super){function SimpleKeyEncoder(){var _this=this;this.build_key=function(){},this.encode_key=function(){},this.build_cluster=function(){},this.encode_cluster=function(){}}return __extends(SimpleKeyEncoder,_super),SimpleKeyEncoder}(KeyEncoder),_simple_key_encoder=new SimpleKeyEncoder,LocalStorageEngine=function(_super){function LocalStorageEngine(name){var _this=this;this.name=name,this.get_async=function(key,callback){var object;return callback.call(object=_this.get(key))},this.put_async=function(key,value,callback){return _this.put(key,value),callback.call(value)},this.delete_async=function(key,callback){return _this["delete"](key),callback.call(_this)},this.clear_async=function(callback){return _this.clear(),callback.call(_this)},this.get=function(key){return localStorage.getItem(key)},this.put=function(key,value){return _this.get(key)==null&&_this._state.runtime.count.total_keys++,localStorage.setItem(key,value)},this["delete"]=function(key){return _this._state.runtime.count.total_keys--,localStorage.removeItem(key)},this.clear=function(){return _this._state.runtime.count.total_keys=0,localStorage.clear()};return}return __extends(LocalStorageEngine,_super),LocalStorageEngine._state={runtime:{count:{total_keys:0,by_kind:[]}}},LocalStorageEngine}(StorageAdapter),SessionStorageEngine=function(_super){function SessionStorageEngine(name){var _this=this;this.name=name,this.get_async=function(key,callback){var object;return callback.call(object=_this.get(key))},this.put_async=function(key,value,callback){return _this.put(key,value),callback.call(value)},this.delete_async=function(key,callback){return _this["delete"](key),callback.call(_this)},this.clear_async=function(callback){return _this.clear(),callback.call(_this)},this.get=function(key){return sessionStorage.getItem(key)},this.put=function(key,value){return _this.get(key)==null&&_this._state.runtime.count.total_keys++,sessionStorage.setItem(key,value)},this["delete"]=function(key){return _this._state.runtime.count.total_keys--,sessionStorage.removeItem(key)},this.clear=function(){return _this._state.runtime.count.total_keys=0,sessionStorage.clear()};return}return __extends(SessionStorageEngine,_super),SessionStorageEngine._state={runtime:{count:{total_keys:0,by_kind:[]}}},SessionStorageEngine}(StorageAdapter),LocalStorageDriver=function(_super){function LocalStorageDriver(){return LocalStorageDriver.__super__.constructor.apply(this,arguments)}return __extends(LocalStorageDriver,_super),LocalStorageDriver._state={constructor:function(){var _this=this;this.compatible=function(){return!!window.localStorage},this.construct=function(name){var new_engine;return name==null&&(name="appstorage"),_this.compatible()?new_engine=new LocalStorageEngine(name):!1}}},LocalStorageDriver}(StorageDriver),SessionStorageDriver=function(_super){function SessionStorageDriver(){return SessionStorageDriver.__super__.constructor.apply(this,arguments)}return __extends(SessionStorageDriver,_super),SessionStorageDriver._state={constructor:function(){var _this=this;this.compatible=function(){return!!window.sessionStorage},this.construct=function(name){var new_engine;return name==null&&(name="appstorage"),_this.compatible()?new_engine=new SessionStorageEngine(name):!1}}},SessionStorageDriver}(StorageDriver),this.__apptools_preinit.detected_storage_engines.push({name:"LocalStorage",adapter:LocalStorageEngine,driver:LocalStorageDriver,key_encoder:_simple_key_encoder}),this.__apptools_preinit.detected_storage_engines.push({name:"SessionStorage",adapter:SessionStorageEngine,driver:SessionStorageDriver,key_encoder:_simple_key_encoder}),IndexedDBEngine=function(_super){function IndexedDBEngine(){return}return __extends(IndexedDBEngine,_super),IndexedDBEngine}(StorageAdapter),IndexedDBDriver=function(_super){function IndexedDBDriver(){return}return __extends(IndexedDBDriver,_super),IndexedDBDriver}(StorageDriver),this.__apptools_preinit.detected_storage_engines.push({name:"IndexedDB",adapter:IndexedDBEngine,driver:IndexedDBDriver}),WebSQLEngine=function(_super){function WebSQLEngine(){return}return __extends(WebSQLEngine,_super),WebSQLEngine}(StorageAdapter),WebSQLDriver=function(_super){function WebSQLDriver(){return}return __extends(WebSQLDriver,_super),WebSQLDriver}(StorageDriver),this.__apptools_preinit.detected_storage_engines.push({name:"WebSQL",adapter:WebSQLEngine,driver:WebSQLDriver}),CoreStorageAPI=function(_super){function CoreStorageAPI(apptools,window){var _this=this;this._state={runtime:{index:{key_read_tally:{},key_write_tally:{},local_by_key:{},local_by_kind:{}},count:{total_keys:0,by_collection:[],by_kind:[]},data:{}},config:{autoload:!1,autosync:{enabled:!1,interval:120},drivers:[],engines:{},encrypt:!1,integrity:!1,obfuscate:!1,local_only:!1,callbacks:{ready:null,sync:null}},supervisor:{},cachebridge:{},model_kind_map:{},collection_kind_map:{}},this.internal={check_support:function(modernizr){},bootstrap:function(lawnchair){},provision_collection:function(name,adapter,callback){},add_storage_engine:function(name,driver,engine){var d,e;try{d=new driver(apptools),e=new engine(apptools)}catch(err){return!1}return e.compatible()?(_this._state.config.engines[name]=e,driver.adapter=_this._state.config.engines[name],_this._state.config.drivers.push(driver),apptools.sys.drivers.install("storage",name,d,d.enabled!=null|!0,d.priority!=null|50,function(driver){return apptools.events.trigger("ENGINE_LOADED",{driver:driver,engine:driver.adapter})}),!0):(apptools.dev.verbose("StorageEngine","Detected incompatible storage engine. Skipping.",name,driver,engine),!1)}},this.get=function(){},this.list=function(){},this.count=function(){},this.put=function(){},this.query=function(){},this["delete"]=function(){},this.sync=function(){},this._init=function(){var engine,_i,_len,_ref,_ref1,_ref2;apptools.events.trigger("STORAGE_INIT"),apptools.dev.verbose("Storage","Storage support is currently under construction.");if(((_ref=apptools.sys)!=null?(_ref1=_ref.preinit)!=null?_ref1.detected_storage_engines:void 0:void 0)!=null){_ref2=apptools.sys.preinit.detected_storage_engines;for(_i=0,_len=_ref2.length;_i<_len;_i++)engine=_ref2[_i],_this.internal.add_storage_engine(engine.name,engine.driver,engine.adapter)}return apptools.events.trigger("STORAGE_READY")},apptools.events.bridge(["STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE"],"STORAGE_ACTIVITY"),apptools.events.bridge(["COLLECTION_CREATE","COLLECTION_UPDATE","COLLECTION_DESTROY","COLLECTION_SYNC","COLLECTION_SCAN"],"STORAGE_ACTIVITY")}return __extends(CoreStorageAPI,_super),CoreStorageAPI.mount="storage",CoreStorageAPI.events=["STORAGE_INIT","ENGINE_LOADED","STORAGE_READY","STORAGE_ERROR","STORAGE_ACTIVITY","STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE","COLLECTION_SCAN","COLLECTION_CREATE","COLLECTION_DESTROY","COLLECTION_UPDATE","COLLECTION_SYNC"],CoreStorageAPI}(CoreAPI),this.__apptools_preinit.abstract_base_classes.push(CoreStorageAPI),RPCAPI=function(_super){function RPCAPI(name,base_uri,methods,config){var method,_i,_len,_ref;this.name=name,this.base_uri=base_uri,this.methods=methods,this.config=config;if(this.methods.length>0){_ref=this.methods;for(_i=0,_len=_ref.length;_i<_len;_i++)method=_ref[_i],this[method]=this._buildRPCMethod(method,base_uri,config)}}return __extends(RPCAPI,_super),RPCAPI.prototype._buildRPCMethod=function(method,base_uri,config){var api,rpcMethod,_this=this;return api=this.name,rpcMethod=function(params,callbacks,async,push,opts,config){return params==null&&(params={}),callbacks==null&&(callbacks=null),async==null&&(async=!1),push==null&&(push=!1),opts==null&&(opts={}),config==null&&(config={}),function(params,callbacks,async,push,opts){var request;return request=$.apptools.api.rpc.createRPCRequest({method:method,api:api,params:params||{},opts:opts||{},async:async||!1,push:push||!1}),callbacks!==null?request.fulfill(callbacks,config):request}(params,callbacks,async,push,opts)},$.apptools.api.registerAPIMethod(api,method,base_uri,config),rpcMethod},RPCAPI}(CoreObject),RPCRequest=function(_super){function RPCRequest(id,opts,agent){this.params={},this.action=null,this.method=null,this.api=null,this.base_uri=null,this.envelope={id:null,opts:{},agent:{}},this.ajax={accept:"application/json",async:!0,cache:!0,global:!0,http_method:"POST",crossDomain:!1,processData:!1,ifModified:!1,dataType:"json",push:!1,contentType:"application/json; charset=utf-8"},id!=null&&(this.envelope.id=id),opts!=null&&(this.envelope.opts=opts),agent!=null&&(this.envelope.agent=agent)}return __extends(RPCRequest,_super),RPCRequest.prototype.fulfill=function(callbacks,config){var defaultFailureCallback,defaultSuccessCallback,_this=this;return callbacks==null&&(callbacks={}),(callbacks!=null?callbacks.success:void 0)==null&&(defaultSuccessCallback=function(context,type,data){return $.apptools.dev.log("RPC","RPC succeeded but had no success callback.",_this,context,type,data)},callbacks.success=defaultSuccessCallback),(callbacks!=null?callbacks.failure:void 0)==null&&(defaultFailureCallback=function(context){return $.apptools.dev.error("RPC","RPC failed but had no failure callback.",_this,context)},callbacks.failure=defaultFailureCallback),$.apptools.api.rpc.fulfillRPCRequest(config,this,callbacks)},RPCRequest.prototype.setAsync=function(async){var _ref,_ref1;return(_ref=this.ajax)!=null&&(_ref1=_ref.async)==null&&(_ref.async=async),this},RPCRequest.prototype.setPush=function(push){return push===!0&&(this.ajax.push=!0,this.envelope.opts.alt="socket",this.envelope.opts.token=$.apptools.push.state.config.token),this},RPCRequest.prototype.setOpts=function(opts){var _ref,_ref1;return(_ref=this.envelope)!=null&&(_ref.opts=_.defaults(opts,(_ref1=this.envelope)!=null?_ref1.opts:void 0)),this},RPCRequest.prototype.setAgent=function(agent){var _ref,_ref1;return(_ref=this.envelope)!=null&&(_ref1=_ref.agent)==null&&(_ref.agent=agent),this},RPCRequest.prototype.setAction=function(action){return this.action=action,this},RPCRequest.prototype.setMethod=function(method){return this.method=method,this},RPCRequest.prototype.setAPI=function(api){return this.api=api,this},RPCRequest.prototype.setBaseURI=function(base_uri){return this.base_uri=base_uri,this},RPCRequest.prototype.setParams=function(params){return this.params=params!=null?params:{},this},RPCRequest.prototype.payload=function(){var _payload;return _payload={id:this.envelope.id,opts:this.envelope.opts,agent:this.envelope.agent,request:{params:this.params,method:this.method,api:this.api}},_payload},RPCRequest}(CoreObject),RPCResponse=function(_super){function RPCResponse(){var args;args=1<=arguments.length?__slice.call(arguments,0):[],$.apptools.dev.verbose("RPC","RPCResponse is not yet implemented and is currently stubbed.");return}return __extends(RPCResponse,_super),RPCResponse}(CoreObject),CoreRPCAPI=function(_super){function CoreRPCAPI(apptools,window){var original_xhr,_ref,_ref1,_this=this;this.state={sockets:{token:"__NULL__",enabled:!1,status:"DISCONNECTED","default":null,default_host:((_ref=apptools.config)!=null?(_ref1=_ref.rpc)!=null?_ref1.socket_host:void 0:void 0)!=null||null}},this.base_rpc_uri=apptools.config.rpc.base_uri||"/_api/rpc",this.socket_host=apptools.config.rpc.socket_host||null,apptools.sys.libraries.resolve("jQuery")!==!1?original_xhr=$.ajaxSettings.xhr:original_xhr=new XMLHTTPRequest,this.internals={transports:{xhr:{factory:function(){var req;return req=original_xhr(),req&&typeof req.addEventListener=="function"&&req.addEventListener("progress",function(ev){return apptools.events.trigger("RPC_PROGRESS",{event:ev})},!1),req}},websocket:{factory:function(){var req,socket,_ref2,_ref3,_ref4,_ref5;if(apptools.agent.capabilities.websockets==null)throw apptools.dev.error("RPC","Socket factory can't produce a socket because the client platform does not support WebSockets."),"SocketsNotSupported: The client platform does not have support for websockets.";if(((_ref2=_this.state.sockets)!=null?_ref2.enabled:void 0)!=null==1)return((_ref3=_this.state.sockets)!=null?_ref3["default"]:void 0)!=null===null&&((_ref4=_this.state.sockets)!=null?(_ref5=_ref4.open)!=null?_ref5.length:void 0:void 0)===0&&(socket=new apptools.push.socket.establish,_this.state.sockets.enabled=!0,_this.state.sockets["default"]=socket,_this.state.sockets.status="CONNECTED"),req={},req}}},config:{headers:{"X-ServiceClient":["AppToolsJS/",[AppTools.version.major.toString(),AppTools.version.minor.toString(),AppTools.version.micro.toString(),AppTools.version.build.toString()].join("."),"-",AppTools.version.release.toString()].join(""),"X-ServiceTransport":"AppTools/JSONRPC"}}},this.rpc={lastRequest:null,lastFailure:null,lastResponse:null,history:{},action_prefix:null,alt_push_response:!1,used_ids:[],factory:function(name,base_uri,methods,config){return apptools.api[name]=new RPCAPI(name,base_uri,methods,config)},_assembleRPCURL:function(method,api,prefix,base_uri){if(api==null&&base_uri==null)throw"[RPC] Error: Must specify either an API or base URI to generate an RPC endpoint.";return api!=null?base_uri!=null?base_uri=base_uri+"/"+api:base_uri=_this.base_rpc_uri+"/"+api:base_uri==null&&(base_uri=_this.base_rpc_uri),prefix!==null?[prefix+base_uri,method].join("."):[base_uri,method].join(".")},provisionRequestID:function(){var id;return _this.rpc.used_ids.length>0?(id=Math.max.apply(_this,_this.rpc.used_ids)+1,_this.rpc.used_ids.push(id),id):(_this.rpc.used_ids.push(1),1)},decodeRPCResponse:function(data,status,xhr,success,error){return success(data,status)},createRPCRequest:function(config){var request;return request=new RPCRequest(_this.rpc.provisionRequestID()),config.api!=null&&request.setAPI(config.api),config.method!=null&&request.setMethod(config.method),config.agent!=null&&request.setAgent(config.agent),config.opts!=null&&request.setOpts(config.opts),config.base_uri!=null&&request.setBaseURI(config.base_uri),config.params!=null&&request.setParams(config.params),config.async!=null&&request.setAsync(config.async),config.push!=null?request.setPush(config.push):request.setPush(_this.rpc.alt_push_response),apptools.dev.verbose("RPC","New Request",request,config),request.setAction(_this.rpc._assembleRPCURL(request.method,request.api,_this.rpc.action_prefix,_this.base_rpc_uri)),request},fulfillRPCRequest:function(config,request,callbacks,transport){var context;transport==null&&(transport="xhr"),apptools.dev.verbose("RPC","Fulfill",config,request,callbacks),apptools.sys.libraries.resolve("jQuery")!==!1&&$.ajaxSetup({type:"POST",accepts:"application/json",contentType:"application/json",global:!0,xhr:function(){return _this.internals.transports.xhr.factory()},headers:_this.internals.config.headers}),_this.rpc.lastRequest=request,_this.rpc.history[request.envelope.id]={request:request,config:config,callbacks:callbacks};if(request.action===null){if(request.method===null)throw"[RPC] Error: Request must specify at least an action or method.";if(request.base_uri===null){if(request.api===null)throw"[RPC] Error: Request must have an API or explicity defined BASE_URI.";request.action=_this.rpc._assembleRPCURL(request.method,request.api,_this.rpc.action_prefix)}else request.action=_this.rpc._assembleRPCURL(request.method,null,_this.rpc.action_prefix,request.base_uri)}if(request.action===null||request.action===void 0)throw"[RPC] Error: Could not determine RPC action.";return context={config:config,request:request,callbacks:callbacks},apptools.events.trigger("RPC_FULFILL",context),function(apptools,request,callbacks){var driver,xhr,xhr_action,xhr_settings,_this=this;xhr_settings={resourceId:request.api+"."+request.method,url:request.action,data:JSON.stringify(request.payload()),async:request.ajax.async,global:request.ajax.global,type:request.ajax.http_method||"POST",accepts:request.ajax.accepts||"application/json",crossDomain:request.ajax.crossDomain,dataType:request.ajax.dataType,processData:!1,ifModified:request.ajax.ifModified,contentType:request.ajax.contentType,beforeSend:function(xhr,settings){return apptools.api.rpc.history[request.envelope.id].xhr=xhr,callbacks!=null&&typeof callbacks.status=="function"&&callbacks.status("beforeSend"),xhr},error:function(xhr,status,error){return callbacks!=null&&typeof callbacks.status=="function"&&callbacks.status("error"),apptools.dev.error("RPC","Error: ",{error:error,status:status,xhr:xhr}),apptools.api.rpc.lastFailure=error,apptools.api.rpc.history[request.envelope.id].xhr=xhr,apptools.api.rpc.history[request.envelope.id].status=status,apptools.api.rpc.history[request.envelope.id].failure=error,context={xhr:xhr,status:status,error:error},apptools.events.trigger("RPC_ERROR",context),apptools.events.trigger("RPC_COMPLETE",context),callbacks!=null?typeof callbacks.failure=="function"?callbacks.failure(error):void 0:void 0},success:function(data,status,xhr){return data.status==="ok"?(callbacks!=null&&typeof callbacks.status=="function"&&callbacks.status("success"),apptools.dev.log("RPC","Success",data,status,xhr),apptools.api.rpc.lastResponse=data,apptools.api.rpc.history[request.envelope.id].xhr=xhr,apptools.api.rpc.history[request.envelope.id].status=status,apptools.api.rpc.history[request.envelope.id].response=data,context={xhr:xhr,status:status,data:data},apptools.events.trigger("RPC_SUCCESS",context),apptools.events.trigger("RPC_COMPLETE",context),callbacks!=null?typeof callbacks.success=="function"?callbacks.success(data.response.content,data.response.type,data):void 0:void 0):data.status==="wait"?(callbacks!=null&&typeof callbacks.status=="function"&&callbacks.status("wait"),apptools.dev.log("RPC","PushWait",data,status,xhr),context={xhr:xhr,status:status,data:data},callbacks!=null&&typeof callbacks.wait=="function"&&callbacks.wait(data,status,xhr),apptools.push.internal.expect(request.envelope.id,request,xhr)):data.status==="fail"?(callbacks!=null&&typeof callbacks.status=="function"&&callbacks.status("error"),apptools.dev.error("RPC","Error: ",{error:data,status:status,xhr:xhr}),apptools.api.rpc.lastFailure=data,apptools.api.rpc.history[request.envelope.id].xhr=xhr,apptools.api.rpc.history[request.envelope.id].status=status,apptools.api.rpc.history[request.envelope.id].failure=data,context={xhr:xhr,status:status,error:data},apptools.events.trigger("RPC_ERROR",context),apptools.events.trigger("RPC_COMPLETE",context),callbacks!=null?typeof callbacks.failure=="function"?callbacks.failure(data):void 0:void 0):callbacks!=null?typeof callbacks.success=="function"?callbacks.success(data.response.content,data.response.type,data):void 0:void 0},statusCode:{404:function(){return apptools.dev.error("RPC","HTTP/404","Could not resolve RPC action URI."),apptools.events.trigger("RPC_ERROR",{message:"RPC 404: Could not resolve RPC action URI.",code:404})},403:function(){return apptools.dev.error("RPC","HTTP/403","Not authorized to access the specified endpoint."),apptools.events.trigger("RPC_ERROR",{message:"RPC 403: Not authorized to access the specified endpoint.",code:403})},500:function(){return apptools.dev.error("RPC","HTTP/500","Internal server error."),apptools.events.trigger("RPC_ERROR",{message:"RPC 500: Woops! Something went wrong. Please try again.",code:500})}}},driver=apptools.sys.drivers.resolve("transport");if(driver.name==="amplify")apptools.dev.verbose("RPC","Fulfilling with AmplifyJS transport adapter."),xhr_action=driver.driver.request,xhr=xhr_action(xhr_settings);else{if(driver.name!=="jquery")throw apptools.dev.error("RPC","Native RPC adapter is currently stubbed."),"[RPC]: No valid AJAX transport adapter found.";apptools.dev.verbose("RPC","Fulfilling with jQuery AJAX transport adapter.",xhr_settings),xhr=jQuery.ajax(xhr_settings.url,xhr_settings)}return apptools.dev.verbose("RPC","Resulting XHR: ",xhr)}(apptools,request,callbacks),{id:request.envelope.id,request:request}}},this.ext=null,this.registerAPIMethod=function(api,name,base_uri,config){var amplify,base_settings,resourceId,_ref2;if(apptools!=null?(_ref2=apptools.sys)!=null?_ref2.drivers:void 0:void 0){amplify=apptools.sys.drivers.resolve("transport","amplify");if(amplify!==!1)return apptools.dev.log("RPCAPI",'Registering request procedure "'+api+"."+name+'" with AmplifyJS.'),resourceId=api+"."+name,base_settings={accepts:"application/json",type:"POST",dataType:"json",contentType:"application/json",url:_this.rpc._assembleRPCURL(name,api,null,base_uri),decoder:_this.rpc.decodeRPCResponse},config.caching!=null?(config.caching===!0&&(base_settings.caching="persist"),amplify.request.define(resourceId,"ajax",base_settings)):amplify.request.define(resourceId,"ajax",base_settings)}}}return __extends(CoreRPCAPI,_super),CoreRPCAPI.mount="api",CoreRPCAPI.events=["RPC_CREATE","RPC_FULFILL","RPC_SUCCESS","RPC_ERROR","RPC_COMPLETE","RPC_PROGRESS"],CoreRPCAPI}(CoreAPI),RPCDriver=function(_super){function RPCDriver(){return}return __extends(RPCDriver,_super),RPCDriver.methods=[],RPCDriver["export"]="private",RPCDriver}(CoreInterface),this.__apptools_preinit.abstract_base_classes.push(RPCAPI),this.__apptools_preinit.abstract_base_classes.push(RPCDriver),this.__apptools_preinit.abstract_base_classes.push(CoreRPCAPI),this.__apptools_preinit.abstract_base_classes.push(RPCRequest),this.__apptools_preinit.abstract_base_classes.push(RPCResponse),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:RPCDriver,name:"transport"}),CoreUserAPI=function(_super){function CoreUserAPI(apptools,window){this.current_user=null}return __extends(CoreUserAPI,_super),CoreUserAPI.mount="user",CoreUserAPI.events=["SET_USER_INFO"],CoreUserAPI.prototype.setUserInfo=function(userinfo){return this.current_user=userinfo.current_user||null,$.apptools.dev.log("UserAPI","Set server-injected userinfo: ",this.current_user),$.apptools.events.trigger("SET_USER_INFO",this.current_user)},CoreUserAPI}(CoreAPI),this.__apptools_preinit.abstract_base_classes.push(CoreUserAPI),CorePushAPI=function(_super){function CorePushAPI(apptools,window){var _this=this;this.state={ready:!1,status:"init",transport:{sockets:[],channel:null},callbacks:{open:null,expect:null,activity:null,error:null,close:null},config:{token:null}},apptools.events.bridge(["PUSH_READY","PUSH_SOCKET_ESTABLISH","PUSH_SOCKET_ERROR","PUSH_SOCKET_OPEN","PUSH_SOCKET_CLOSE"],"PUSH_STATE_CHANGE"),apptools.events.hook("PUSH_SOCKET_OPEN",function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],apptools.api.rpc.alt_push_response=!0}),apptools.events.hook("PUSH_SOCKET_CLOSE",function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],apptools.api.rpc.alt_push_response=!1}),this.events={on_open:function(socket){if(_this.state.transport.sockets.length=0)_this.state.status="ready";return apptools.events.trigger("PUSH_SOCKET_OPEN",_this.state),apptools.dev.verbose("PushSocket","Message transport opened.")},on_message:function(socket,payload){var _base;return _this.state.status="receiving",apptools.dev.verbose("PushSocket","Message received.",payload),apptools.events.trigger("PUSH_SOCKET_ACTIVITY",_this.state),typeof (_base=_this.state.callbacks).activity=="function"&&_base.activity(payload),apptools.events.trigger("PUSH_SOCKET_ACTIVITY_FINISH",_this.state)},on_error:function(socket,error){return _this.state.status="error",apptools.dev.error("PushSocket","Message transport error.",error),apptools.events.trigger("PUSH_SOCKET_ERROR",_this.state)},on_close:function(socket){return _this.state.ready=!1,_this.state.status="close",apptools.dev.verbose("PushSocket","Message transport closed."),apptools.events.trigger("PUSH_SOCKET_CLOSE",_this.state)}},this.internal={open_channel:function(token){return apptools.events.trigger("PUSH_INIT",{token:token,type:"channel"}),_this.state.config.token=token,_this.state.transport.channel=new goog.appengine.Channel(_this.state.config.token),_this.internal._add_socket(_this.state.transport.channel)},open_websocket:function(token,server){return apptools.events.trigger("PUSH_INIT",{token:token,server:server,type:"websocket"}),apptools.dev.log("Push","WARNING: WebSockets support is currently experimental."),_this.internal._add_socket(_this.state.transport.socket)},_add_socket:function(transport,callbacks){var socket;return socket=transport.open(),_this.state.transport.sockets.push(socket),apptools.events.trigger("PUSH_SOCKET_ESTABLISH",socket),socket.onopen=function(){var args,_ref;return args=1<=arguments.length?__slice.call(arguments,0):[],(_ref=_this.events).on_open.apply(_ref,[socket].concat(__slice.call(args)))},socket.onmessage=function(){var args,_ref;return args=1<=arguments.length?__slice.call(arguments,0):[],(_ref=_this.events).on_message.apply(_ref,[socket].concat(__slice.call(args)))},socket.onerror=function(){var args,_ref;return args=1<=arguments.length?__slice.call(arguments,0):[],(_ref=_this.events).on_error.apply(_ref,[socket].concat(__slice.call(args)))},socket.onclose=function(){var args,_ref;return args=1<=arguments.length?__slice.call(arguments,0):[],(_ref=_this.events).on_close.apply(_ref,[socket].concat(__slice.call(args)))},_this.internal},expect:function(id,request,xhr){var _ref,_ref1;return(_ref=_this.state)!=null&&(_ref1=_ref.callbacks)!=null&&typeof _ref1.expect=="function"&&_ref1.expect(id,request,xhr),_this.internal}},this.channel={establish:function(token){return _this.internal.open_channel(token)}},this.socket={establish:function(token,host){return host==null&&(host=null),_this.internal.open_websocket(token,host||apptools.config.sockets.host)}},this.listen=function(callbacks){return _this.state.callbacks=_.defaults(callbacks,_this.state.callbacks),_this.state.ready=!0,_this.internal}}return __extends(CorePushAPI,_super),CorePushAPI.mount="push",CorePushAPI.events=["PUSH_INIT","PUSH_READY","PUSH_STATE_CHANGE","PUSH_SOCKET_OPEN","PUSH_SOCKET_ESTABLISH","PUSH_SOCKET_ACTIVITY","PUSH_SOCKET_ACTIVITY_FINISH","PUSH_SOCKET_ERROR","PUSH_SOCKET_CLOSE"],CorePushAPI}(CoreAPI),PushDriver=function(_super){function PushDriver(){return}return __extends(PushDriver,_super),PushDriver.methods=[],PushDriver["export"]="private",PushDriver}(CoreInterface),this.__apptools_preinit.abstract_base_classes.push(PushDriver),this.__apptools_preinit.abstract_base_classes.push(CorePushAPI),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:PushDriver,name:"transport"}),CoreRenderAPI=function(_super){function CoreRenderAPI(apptools,window){return}return __extends(CoreRenderAPI,_super),CoreRenderAPI.mount="render",CoreRenderAPI.events=["ADD_TEMPLATE","RENDER_TEMPLATE"],CoreRenderAPI["export"]="private",CoreRenderAPI.prototype._init=function(){},CoreRenderAPI}(CoreAPI),RenderDriver=function(_super){function RenderDriver(){return}return __extends(RenderDriver,_super),RenderDriver["export"]="private",RenderDriver.methods=["render","register_template"],RenderDriver}(CoreInterface),QueryDriver=function(_super){function QueryDriver(){return}return __extends(QueryDriver,_super
),QueryDriver["export"]="private",QueryDriver.methods=["element_by_id","elements_by_class"],QueryDriver}(CoreInterface),Template=function(_super){function Template(){this.name="",this.source="",this.cacheable={rendered:!1,source:!1}}return __extends(Template,_super),Template}(Model),this.__apptools_preinit.abstract_base_classes.push(QueryDriver),this.__apptools_preinit.abstract_base_classes.push(RenderDriver),this.__apptools_preinit.abstract_base_classes.push(CoreRenderAPI),this.__apptools_preinit.abstract_feature_interfaces.push({adapter:RenderDriver,name:"render"}),CoreWidgetAPI=function(_super){function CoreWidgetAPI(){return CoreWidgetAPI.__super__.constructor.apply(this,arguments)}return __extends(CoreWidgetAPI,_super),CoreWidgetAPI}(CoreAPI),CoreWidget=function(_super){function CoreWidget(){var _this=this;this._init=function(){}}return __extends(CoreWidget,_super),CoreWidget}(CoreObject),this.__apptools_preinit!=null?(this.__apptools_preinit.abstract_base_classes==null&&(this.__apptools_preinit.abstract_base_classes=[]),this.__apptools_preinit.deferred_core_modules==null&&(this.__apptools_preinit.deferred_core_modules=[])):this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]},this.__apptools_preinit.abstract_base_classes.push(CoreWidget),this.__apptools_preinit.abstract_base_classes.push(CoreWidgetAPI),this.__apptools_preinit.deferred_core_modules.push({module:CoreWidgetAPI}),ModalAPI=function(_super){function ModalAPI(apptools,widget,window){var _this=this;this._state={modals:[],modals_by_id:{},init:!1},this.create=function(target,trigger,callback,options){var id,modal;return options==null&&(options=target.hasAttribute("data-options")?JSON.parse(target.getAttribute("data-options")):{}),modal=new Modal(target,trigger,options),id=modal._state.cached_id,_this._state.modals_by_id[id]=_this._state.modals.push(modal)-1,callback!=null?callback.call(_this,modal._init()):modal._init()},this.destroy=function(modal){var id;return id=modal._state.element_id,_this._state.modals.splice(_this._state.modals_by_id[id],1),delete _this._state.modals_by_id[id],document.body.removeChild(Util.get(id)),modal},this.enable=function(modal){var trigger;return trigger=Util.get(modal._state.trigger_id),Util.bind(trigger,"mousedown",modal.open,!1),modal},this.disable=function(modal){return Util.unbind(Util.get(modal._state.trigger_id)),modal},this.get=function(element_id){var index;return(index=_this._state.modals_by_id[element_id])!=null?_this._state.modals[index]:!1},this._init=function(){var modal,modals,_i,_len,_m,_t;modals=Util.get("pre-modal");if(modals!=null)for(_i=0,_len=modals.length;_i<_len;_i++)modal=modals[_i],_m=_this.create(modal,_t=Util.get("a-"+modal.getAttribute("id"))),_this.enable(_m);return _this._state.init=!0,_this}}return __extends(ModalAPI,_super),ModalAPI.mount="modal",ModalAPI.events=["MODAL_READY","MODAL_API_READY"],ModalAPI}(CoreWidgetAPI),Modal=function(_super){function Modal(target,trigger,options){var _this=this;this._state={cached_id:target.getAttribute("id"),cached_html:null,trigger_id:trigger.getAttribute("id"),element_id:null,overlay:null,active:!1,init:!1,config:{initial:{width:"0px",height:"0px",top:window.innerHeight/2+"px",left:window.innerHeight/2+"px"},ratio:{x:.4,y:.4},template:['<div id="modal-dialog" style="opacity: 0;" class="fixed dropshadow">','<div id="modal-fade" style="opacity: 0">','<div id="modal-content">&nbsp;</div>','<div id="modal-ui" class="absolute">','<div id="modal-title" class="absolute"></div>','<div id="modal-close" class="absolute">X</div>',"</div>","</div>","</div>"].join("\n"),rounded:!0,calc:null,padding:null}},this._state.config=Util.extend(this._state.config,options),this.internal={calc:function(){var css,dH,dW,r,wH,wW;return _this._state.config.calc!=null?_this._state.config.calc():(css={},r=_this._state.config.ratio,wW=window.innerWidth,wH=window.innerHeight,dW=Math.floor(r.x*wW),dH=Math.floor(r.y*wH),css.width=dW+"px",css.height=dH+"px",css.left=Math.floor((wW-dW)/2),css.top=Math.floor((wH-dH)/2),css)},classify:function(element,method){var ecl;if(method==="close"||method==null)return Util.in_array("dropshadow",ecl=element.classList)&&ecl.remove("dropshadow"),Util.in_array("rounded",ecl)&&ecl.remove("rounded"),element.style.padding="0px",element;if(method==="open")return Util.in_array("dropshadow",ecl=element.classList)||ecl.add("dropshadow"),!Util.in_array("rounded",ecl)&&_this._state.config.rounded&&ecl.add("rounded"),element.style.padding="10px",element;if(element==null)return!1}},this.make=function(){var close_x,content,d,dialog,fade,id,pre,prop,range,t,template,title,ui,val,_ref,_ref1;template=_this._state.config.template,range=document.createRange(),range.selectNode(document.getElementsByTagName("div").item(0)),d=range.createContextualFragment(template),document.body.appendChild(d),dialog=Util.get("modal-dialog"),title=Util.get("modal-title"),content=Util.get("modal-content"),ui=Util.get("modal-ui"),close_x=Util.get("modal-close"),fade=Util.get("modal-fade"),id=_this._state.cached_id,pre=Util.get(id),dialog.classList.add(dialog.getAttribute("id")),dialog.setAttribute("id",id+"-modal-dialog"),_this._state.config.rounded&&dialog.classList.add("rounded"),_ref=_this._state.config.initial;for(prop in _ref)val=_ref[prop],dialog.style[prop]=val;content.classList.add(content.getAttribute("id")),content.setAttribute("id",id+"-modal-content"),_ref1=pre.style;for(prop in _ref1)val=_ref1[prop],content.style[prop]=val;return content.style.opacity=1,content.style.height=_this.internal.calc().height,content.innerHTML=(t=Util.get(id)).innerHTML,title.classList.add(title.getAttribute("id")),title.setAttribute("id",id+"-modal-title"),title.innerHTML=t.getAttribute("data-title"),ui.classList.add(ui.getAttribute("id")),ui.setAttribute("id",id+"-modal-ui"),close_x.classList.add(close_x.getAttribute("id")),close_x.setAttribute("id",id+"-modal-close"),fade.classList.add(fade.getAttribute("id")),fade.setAttribute("id",id+"-modal-fade"),_this._state.element_id=dialog.getAttribute("id"),_this._state.cached_html=t.innerHTML,t.innerHTML="",dialog},this.open=function(){var close_x,dialog,dialog_animation,fade_animation,final,id;return id=_this._state.cached_id,dialog=Util.get(_this._state.element_id),close_x=Util.get(id+"-modal-close"),_this._state.active=!0,fade_animation=Util.prep_animation(),dialog_animation=Util.prep_animation(),dialog_animation.complete=function(){return _this.internal.classify(dialog,"open"),$("#"+id+"-modal-fade").animate({opacity:1},fade_animation)},final=_this.internal.calc(),final.opacity=1,dialog.style.display="block",$(dialog).animate(final,dialog_animation),Util.bind(close_x,"mousedown",_this.close),_this},this.close=function(){var dialog,id,midpoint;return id=_this._state.cached_id,dialog=Util.get(_this._state.element_id),Util.unbind(Util.get(id+"-modal-close"),"mousedown"),midpoint=Util.extend({},_this._state.config.initial,{opacity:.5}),Util.get(id+"-modal-content").style.overflow="hidden",$("#"+id+"-modal-fade").animate({opacity:0},{duration:300,complete:function(){return _this.internal.classify(dialog,"close"),$(dialog).animate(midpoint,{duration:200,complete:function(){return $(dialog).animate({opacity:0},{duration:250,complete:function(){var prop,val,_ref;dialog.style.display="none",_ref=_this._state.config.initial;for(prop in _ref)val=_ref[prop],dialog.style[prop]=val;return _this._state.active=!1}})}})}}),_this},this._init=function(){var dialog;return dialog=_this.make(),Util.get(_this._state.trigger_id).removeAttribute("href"),_this._state.init=!0,_this}}return __extends(Modal,_super),Modal}(CoreWidget),this.__apptools_preinit.abstract_base_classes.push(Modal),this.__apptools_preinit.abstract_base_classes.push(ModalAPI),this.__apptools_preinit.deferred_core_modules.push({module:ModalAPI,"package":"widgets"}),AccordionAPI=function(_super){function AccordionAPI(apptools,widget,window){var _this=this;this._state={accordions:[],accordions_by_id:{},init:!1},this.create=function(target){var accordion,id,options;return options=target.hasAttribute("data-options")?JSON.parse(target.getAttribute("data-options")):{},accordion=new Accordion(target,options),id=accordion._state.element_id,_this._state.accordions_by_id[id]=_this._state.accordions.push(accordion)-1,accordion._init()},this.destroy=function(accordion){var id;return id=accordion._state.element_id,_this._state.accordions.splice(_this._state.accordions_by_id[id],1),delete _this._state.accordions_by_id[id],accordion},this.enable=function(accordion){var f,trigger,_i,_len,_ref;_ref=accordion._state.folds;for(_i=0,_len=_ref.length;_i<_len;_i++)f=_ref[_i],(trigger=Util.get("a-"+f))!=null&&trigger.nodeType&&trigger.addEventListener("click",accordion.fold,!1);return accordion},this.disable=function(accordion){var fold,trigger,_i,_len,_ref;_ref=accordion._state.folds;for(_i=0,_len=_ref.length;_i<_len;_i++)fold=_ref[_i],(trigger=Util.get("a-"+fold))!=null&&trigger.nodeType&&trigger.removeEventListener("click");return accordion},this.get=function(element_id){var u;return(u=_this._state.accordions_by_id[element_id])!=null?_this._state.accordions[u]:!1},this._init=function(){var accordion,accordions,_i,_len;accordions=Util.get("pre-accordion");if(accordions!=null)for(_i=0,_len=accordions.length;_i<_len;_i++)accordion=accordions[_i],_this.enable(_this.create(accordion));return apptools.events.trigger("ACCORDION_API_READY",_this),_this._state.init=!0,_this}}return __extends(AccordionAPI,_super),AccordionAPI.mount="accordion",AccordionAPI.events=["ACCORDION_READY","ACCORDION_API_READY"],AccordionAPI}(CoreWidgetAPI),Accordion=function(_super){function Accordion(target,options){var _this=this;this._state={element_id:target.getAttribute("id"),folds:[],current_fold:null,active:!1,init:!1,config:{axis:"vertical",vertical:{closed:{height:"0px",opacity:0},opened:{height:"150px",opacity:1}},horizontal:{closed:{width:"0px",opacity:0},opened:{width:"300px",opacity:1}}}},this._state.config=Util.extend(!0,this._state.config,options),this.internal={register_fold:function(anchor){var anchor_id,f,fold,fold_id;return fold_id=(f=anchor.getAttribute("href")).charAt(0)!=="#"?f:f.slice(1),fold=Util.get(fold_id),anchor_id="a-"+fold_id,fold.classList.add("accordion-fold"),fold.classList.add("none"),anchor.removeAttribute("href"),anchor.setAttribute("id",anchor_id),anchor.classList.add("accordion-link"),_this._state.folds.push(fold_id)}},this.fold=function(e){var accordion,axis,block_folds,close_anim,closed,curr_folds,current,current_fold,folds,open_anim,open_tab,opened,prop,same,tab,target_div,target_id,trigger,unique_folds,_i,_j,_k,_len,_len1,_len2,_ref,_ref1;e.preventDefault&&(e.preventDefault(),e.stopPropagation()),trigger=e.target,target_div=Util.get(target_id=trigger.getAttribute("id").split("-").splice(1).join("-")),current_fold=Util.get(_this._state.current_fold)||!1,current=!1,same=target_div===current_fold,accordion=Util.get(_this._state.element_id),_ref=[Util.get("current-fold",accordion),Util.get("block",accordion)],curr_folds=_ref[0],block_folds=_ref[1],_ref1=[curr_folds,block_folds];for(_i=0,_len=_ref1.length;_i<_len;_i++)folds=_ref1[_i],folds!=null&&(folds=Util.filter(folds,function(el){return el.parentNode===accordion}));unique_folds=curr_folds;if(block_folds)for(_j=0,_len1=block_folds.length;_j<_len1;_j++)tab=block_folds[_j],Util.in_array(tab,unique_folds)||unique_folds.push(tab);unique_folds!=null&&(current=!0),_this._state.active=!0,opened=_this._state.config[axis=_this._state.config.axis].opened,closed=_this._state.config[axis].closed,open_anim=close_anim=Util.prep_animation();if(unique_folds!=null)for(_k=0,_len2=unique_folds.length;_k<_len2;_k++)open_tab=unique_folds[_k],$(open_tab).animate(closed,{duration:400,complete:function(){var cls,_l,_len3,_ref2;_ref2=["current-fold","block"];for(_l=0,_len3=_ref2.length;_l<_len3;_l++)cls=_ref2[_l],open_tab.classList.remove(cls);return open_tab.classList.add("none")}});open_anim.complete=function(){return target_div.classList.add("current-fold"),_this._state.active=!1,_this};for(prop in closed)target_div.style[prop];return Util.has_class(target_div,"none")&&(target_div.classList.remove("none"),target_div.classList.add("block")),same||$(target_div).animate(opened,open_anim),_this._state.current_fold=target_id,_this},this._init=function(){var accordion,e,link,links,_i,_len;accordion=Util.get(_this._state.element_id),links=Util.filter(Util.get("a",accordion),function(el){return el.parentNode===accordion});if(links!=null)for(_i=0,_len=links.length;_i<_len;_i++)link=links[_i],_this.internal.register_fold(link);return typeof current_fold!="undefined"&&current_fold!==null&&(e={},e.target=links[0],_this.fold(e)),_this._state.init=!0,_this}}return __extends(Accordion,_super),Accordion}(CoreWidget),this.__apptools_preinit.abstract_base_classes.push(Accordion),this.__apptools_preinit.abstract_base_classes.push(AccordionAPI),this.__apptools_preinit.deferred_core_modules.push({module:AccordionAPI,"package":"widgets"}),ScrollerAPI=function(_super){function ScrollerAPI(apptools,widget,window){var _this=this;this._state={scrollers:[],scrollers_by_id:{},init:!1},this.internal={make:function(scroller){return scroller=_this.create(scroller),console.log("CREATED SCROLLER: ",scroller),scroller=_this.enable(scroller),console.log("ENABLED SCROLLER: ",scroller),scroller}},this.create=function(target,options){var id,scroller;return options==null&&(options=target.hasAttribute("data-options")?JSON.parse(target.getAttribute("data-options")):{}),scroller=new Scroller(target,options),id=scroller._state.element_id,_this._state.scrollers_by_id[id]=_this._state.scrollers.push(scroller)-1,scroller._init()},this.destroy=function(scroller){var id;return id=scroller._state.element_id,_this._state.scrollers.splice(_this._state.scrollers_by_id[id],1),delete _this._state.scrollers_by_id[id],document.body.removeChild(Util.get(id)),scroller},this.enable=function(scroller){var k,v,_fn,_ref;_ref=scroller._state.panes,_fn=function(k,v){return console.log("[Scroller]","K: ",k),console.log("[Scroller]","V: ",v),Util.bind(Util.get(k),"mousedown",scroller.jump(v))};for(k in _ref)v=_ref[k],_fn(k,v);return scroller},this.disable=function(scroller){var k,_i,_len,_ref;_ref=scroller._state.panes;for(_i=0,_len=_ref.length;_i<_len;_i++)k=_ref[_i],Util.unbind(k,"mousedown");return scroller},this._init=function(){var scroller,scrollers,_i,_len;scrollers=Util.get("pre-scroller")||[];for(_i=0,_len=scrollers.length;_i<_len;_i++)scroller=scrollers[_i],_this.create(_this.enable(scroller));return _this._state.init=!0,_this}}return __extends(ScrollerAPI,_super),ScrollerAPI.mount="scroller",ScrollerAPI.events=["SCROLLER_READY","SCROLLER_API_READY"],ScrollerAPI}(CoreWidgetAPI),Scroller=function(_super){function Scroller(target,options){var _this=this;this._state={frame_id:target.getAttribute("id"),panes:{},current_pane:null,active:!1,init:!1,config:{axis:"horizontal"}},this._state.config=Util.extend(!0,this._state.config,options),this.classify=function(){var pane,panes,_i,_len,_results;target=Util.get(_this._state.frame_id),Util.in_array(target.classList,"pre-scroller")&&target.classList.remove("pre-scroller"),panes=Util.get("scroller-pane",target),_results=[];for(_i=0,_len=panes.length;_i<_len;_i++)pane=panes[_i],_results.push(function(pane){var trigger_id;trigger_id="a-"+pane.getAttribute("id"),_this._state.panes[trigger_id]=pane;if(_this._state.config.axis==="horizontal")return pane.classList.remove("left"),pane.classList.remove("clear"),pane.classList.add("in-table"),target.classList.add("nowrap");if(_this._state.config.axis==="vertical")return target.classList.remove("nowrap"),pane.classList.remove("in-table"),pane.classList.add("left"),pane.classList.add("clear")}(pane));return _results},this.jump=function(pane){var animation,diff,frameO,paneO;_this._state.active=!0,animation=_this.animation,animation.complete=function(){return _this._state.active=!1},_this._state.current_pane=pane.getAttribute("id"),frameO=Util.get_offset(target),paneO=Util.get_offset(pane);if(_this._state.config.axis==="horizontal")return diff=Math.floor(paneO.left-frameO.left),$(target).animate({scrollLeft:"+="+diff},animation);if(_this._state.config.axis==="vertical")return diff=Math.floor(paneO.top-frameO.left),$(target).animate({scrollTop:"+="+diff},animation)},this._init=function(){return _this.classify(),_this._state.init=!0,_this}}return __extends(Scroller,_super),Scroller}(CoreWidget),this.__apptools_preinit.abstract_base_classes.push(Scroller),this.__apptools_preinit.abstract_base_classes.push(ScrollerAPI),this.__apptools_preinit.deferred_core_modules.push({module:ScrollerAPI,"package":"widgets"}),TabsAPI=function(_super){function TabsAPI(apptools,widget,window){var _this=this;this._state={tabs:[],tabs_by_id:{},init:!1},this.create=function(target){var id,options,tabs;return options=target.hasAttribute("data-options")?JSON.parse(target.getAttribute("data-options")):{},tabs=new Tabs(target,options),id=tabs._state.element_id,_this._state.tabs_by_id[id]=_this._state.tabs.push(tabs)-1,tabs._init()},this.destroy=function(tabs){var id;return id=tabs._state.element_id,_this._state.tabs.splice(_this._state.tabs_by_id,1),delete _this._state.tabs_by_id[id],document.body.removeChild(Util.get(id)),tabs},this.enable=function(tabs){var trigger;for(trigger in tabs._state.tabs)Util.bind(Util.get(trigger),"mousedown",tabs["switch"],!1);return tabs},this.disable=function(tabs){var trigger;for(trigger in tabs._state.tabs)Util.unbind(Util.get(trigger),"mousedown");return tabs},this._init=function(){var tabs,tabsets,_i,_len;tabsets=Util.get("pre-tabs");if(tabsets!=null)for(_i=0,_len=tabsets.length;_i<_len;_i++)tabs=tabsets[_i],_this.enable(_this.create(tabs));return _this._state.init=!0}}return __extends(TabsAPI,_super),TabsAPI.mount="tabs",TabsAPI.events=["TABS_READY","TABS_API_READY"],TabsAPI}(CoreAPI),Tabs=function(_super){function Tabs(target,options){var _this=this;this._state={element_id:target.getAttribute("id"),current_tab:null,tab_count:0,tabs:{},active:!1,init:!1,config:{rounded:!0,width:"500px",div_string:"div"}},this._state.config=Util.extend(!0,this._state.config,options),this.internal={classify:function(){var cls,div_string,tab,tabs,test,trigger,triggers,_cls,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1;div_string=_this._state.config.div_string,target=Util.get(_this._state.element_id),tabs=Util.filter(Util.get(div_string,target),test=function(el){return el.parentNode===target}),triggers=Util.filter(Util.get("a",target),test),target.style.width=_this._state.config.width,_ref=["relative","tabset"];for(_i=0,_len=_ref.length;_i<_len;_i++)cls=_ref[_i],target.classList.add(cls);for(_j=0,_len1=triggers.length;_j<_len1;_j++)trigger=triggers[_j],_this._state.config.rounded?trigger.classList.add("tab-rounded"):trigger.classList.add("tab-link");for(_k=0,_len2=tabs.length;_k<_len2;_k++){tab=tabs[_k],_ref1=["absolute","tab"];for(_l=0,_len3=_ref1.length;_l<_len3;_l++)_cls=_ref1[_l],tab.classList.add(_cls)}return _this}},this.make=function(){var trigger,triggers,_fn,_i,_len;target=Util.get(_this._state.element_id),triggers=Util.filter(Util.get("a",target),function(x){return x.parentNode===target}),_fn=function(trigger){var content_div,content_id,trigger_id;return content_div=Util.get(content_id=trigger.getAttribute("href").slice(1)),trigger.setAttribute("id",trigger_id="a-"+content_id),content_div==null?!1:(content_div.style.opacity=0,content_div.classList.remove("pre-tabs"),trigger.removeAttribute("href"),_this._state.tabs[trigger_id]=content_id,_this._state.tab_count++)};for(_i=0,_len=triggers.length;_i<_len;_i++)trigger=triggers[_i],_fn(trigger);return _this.internal.classify()},this["switch"]=function(e){var c,current,current_a,current_tab,div_string,tabset,target_id,target_tab,trigger;return tabset=Util.get(_this._state.element_id),div_string=_this._state.config.div_string,current_tab=Util.get(_this._state.current_tab)||((c=Util.get("current-tab",tabset))!=null?Util.filter(c,function(x){return x.parentNode===tabset&&x.tagName.toLowerCase()===div_string})[0]:null)||null,current=!1,e!=null?e.preventDefault?(e.preventDefault(),e.stopPropagation(),target_tab=Util.get(target_id=(trigger=e.target).getAttribute("id").split("-").splice(1).join("-"))):e!=null&&e.nodeType?(target_tab=e,trigger=Util.get("a-"+(target_id=e.getAttribute("id")))):(target_tab=Util.get(e),trigger=Util.get("a-"+(target_id=e))):target_tab=Util.get(target_id=(trigger=Util.get("a",tabset)[0]).getAttribute("id").split("-").splice(1).join("-")),current_tab!=null&&(current_a=Util.get("a-"+current_tab.getAttribute("id"))||Util.get("a-"+_this._state.current_tab),current=!0),current_tab===target_tab?_this:(_this._state.active=!0,console.log("Switching to tab: "+target_id),current?$(current_tab).animate({opacity:0},{duration:200,complete:function(){return current_a.classList.remove("current-tab"),current_tab.classList.remove("current-tab"),current_tab.classList.remove("block"),target_tab.classList.remove("none"),current_tab.classList.add("none"),target_tab.classList.add("block"),target_tab.classList.add("current-tab"),trigger.classList.add("current-tab"),_this._state.current_tab=target_tab.getAttribute("id"),$(target_tab).animate({opacity:1},{duration:300,complete:function(){return _this._state.active=!1}})}}):(target_tab.classList.remove("none"),target_tab.classList.add("current-tab"),target_tab.classList.add("block"),trigger.classList.add("current-tab"),_this._state.current_tab=target_tab.getAttribute("id"),$(target_tab).animate({opacity:1},{duration:300,complete:function(){return _this._state.active=!1}})),_this)},this._init=function(){var tabs;return tabs=_this.make(),_this["switch"](),_this._state.init=!0,_this}}return __extends(Tabs,_super),Tabs}(CoreWidget),this.__apptools_preinit.abstract_base_classes.push(Tabs),this.__apptools_preinit.abstract_base_classes.push(TabsAPI),this.__apptools_preinit.deferred_core_modules.push({module:TabsAPI,"package":"widgets"}),EditorAPI=function(_super){function EditorAPI(apptools,widget,window){var _this=this;this._state={editors:[],editors_by_id:{},init:!1},this.create=function(target){var editor,id,options;return options=target.hasAttribute("data-options")?JSON.parse(target.getAttribute("data-options")):{},editor=new Editor(target,options),id=editor._state.element_id,_this._state.editors_by_id[id]=_this._state.editors.push(editor)-1,editor._init()},this.destroy=function(editor){var id;return id=editor._state.element_id,_this._state.editors.splice(_this._state.editors_by_id[id],1),delete _this._state.editors_by_id[id],editor},this.enable=function(editor){var target;return target=Util.get(editor._state.element_id),Util.bind(target,"dblclick",editor.edit,!1),editor},this.disable=function(editor){return Util.unbind(Util.get(editor._state.element_id),"dblclick"),editor},this._init=function(){var editor,editors,_i,_len;editors=Util.get("mini-editable");if(editors!=null)for(_i=0,_len=editors.length;_i<_len;_i++)editor=editors[_i],_this.enable(_this.create(editor));return _this}}return __extends(EditorAPI,_super),EditorAPI.mount="editor",EditorAPI.events=["EDITOR_READY","EDITOR_API_READY"],EditorAPI}(CoreWidgetAPI),Editor=function(_super){function Editor(target,options){var _this=this;this._state={element_id:target.getAttribute("id"),pane_id:null,active:!1,init:!1,config:{bundles:{plain:{save:function(){return _this.save()}},basic:{b:function(){return document.execCommand("bold")},u:function(){return document.execCommand("underline")},i:function(){return document.execCommand("italic")},clear:function(){return document.execCommand("removeFormat")},undo:function(){return document.execCommand("undo")},redo:function(){return document.execCommand("redo")},cut:function(){return document.execCommand("cut")},paste:function(){return document.execCommand("paste")}},rich:{h1:function(){return document.execCommand("heading",!1,"h1")},h2:function(){return document.execCommand("heading",!1,"h2")},h3:function(){return document.execCommand("heading",!1,"h3")},fontColor:function(){var c,sel;return c=Util.toHex(prompt("Please enter hex (#000000) or RGB (rgb(0,0,0)) values.")),sel=document.selection()||window.getSelection(),document.execCommand("insertHTML",!1,'<span style="color: '+c+';">'+sel+"</span>")},fontSize:function(){var s,sel;return s=prompt("Please enter desired numerical pt size (i.e. 10)"),sel=document.selection()||window.getSelection(),document.execCommand("insertHTML",!1,'<span style="font-size: '+s+';">'+sel+"</span>")},left:function(){return document.execCommand("justifyLeft")},right:function(){return document.execCommand("justifyRight")},center:function(){return document.execCommand("justifyCenter")},indent:function(){return document.execCommand("indent")},outdent:function(){return document.execCommand("outdent")},link:function(){var l,t,_t;return t=document.selection()||window.getSelection(),t!=null&&t.match(/^http|www/)?(_t=t,t=prompt("What link text do you want to display?")):t==null&&(t=prompt("What link text do you want to display?")),l=_t||prompt("What URL do you want to link to? (http://www...)"),document.execCommand("insertHTML",!1,'<a href="'+Util.strip_script(l+'">'+t+"</a>"))}}},bundle:"plain",width:150}},this._state.config=Util.extend(!0,this._state.config,options),this.make=function(){var button,command,feature,features,k,pane,pane_id,t,t_id,t_off,v,width,_ref;t=Util.get(t_id=_this._state.element_id),width=_this._state.config.width,pane=document.createElement("div"),pane.setAttribute("id",pane_id="editor-pane-"+t_id),pane.classList.add("absolute"),pane.style.width=width+"px",pane.style.left=(t_off=Util.get_offset(t)).left-width+"px",pane.style.top=t_off.top+"px",pane.style.zIndex="9990",pane.style.opacity=0,features=_this._state.config.bundles.plain;if(_this._state.config.bundle==="rich"){_ref=_this._state.config.bundles.rich;for(k in _ref)v=_ref[k],features[k]=v}for(feature in features)command=features[feature],button=document.createElement("button"),button.value=button.innerHTML=feature,button.className="editorbutton",Util.bind(button,"mousedown",command),pane.appendChild(button);return document.body.appendChild(pane),_this._state.pane_id=pane_id,pane},this.show=function(){var p;return $("#"+(p=_this._state.pane_id)).animate({opacity:1},Util.prep_animation()),_this},this.hide=function(){return $("#"+_this._state.pane_id).animate({opacity:0},Util.prep_animation()),_this},this.edit=function(e){var el;return e.preventDefault&&(e.preventDefault(),e.stopPropagation()),_this.show(),(el=Util.get(_this._state.element_id)).contentEditable=!0,_this._state.active=!0,Util.bind(document.body,"dblclick",_this.save),el.focus(),_this},this.save=function(e){var el;return console.log("Saving..."),_this.hide(),(el=Util.get(_this._state.element_id)).contentEditable=!1,_this._state.active=!1,Util.unbind(document.body,"dblclick"),_this},this._init=function(){var pane;return pane=this.make(),document.body.appendChild(pane),this._state.init=!0,this}}return __extends(Editor,_super),Editor}(CoreWidget),this.__apptools_preinit.abstract_base_classes.push(Editor),this.__apptools_preinit.abstract_base_classes.push(EditorAPI),this.__apptools_preinit.deferred_core_modules.push({module:EditorAPI,"package":"widgets"}),UploaderAPI=function(_super){function UploaderAPI(apptools,widget,window){var _this=this;this._state={uploaders:[],uploaders_by_id:{},init:!1},this.create=function(kind,options){var bound,id,uploader;return Util.is_raw_object(kind)&&(options=kind,kind=null),options==null&&(options={}),uploader=kind==null?new DataURLUploader(options):kind==="data"?new DataURLUploader(options):kind==="array"?new ArrayBufferUploader(options):kind==="binary"?new BinaryUploader(options):new Uploader(options),(options!=null?options.id:void 0)!=null?(id=options.id,Util.is_id(id)&&(uploader=_this.enable(uploader))):((bound=uploader._state.boundary).match(/^-+(\w+)-+$/),uploader._state.config.id=id=RegExp.$1),_this._state.uploaders_by_id[id]=_this._state.uploaders.push(uploader)-1,uploader._init()},this.destroy=function(uploader){var id;return id=uploader._state.config.id,_this._state.uploaders.splice(_this._state.uploaders_by_id[id],1),delete _this._state.uploaders_by_id[id],uploader},this.enable=function(uploader){var id,target;return target=Util.get(id=uploader._state.config.id),console.log("[UPLOADER:INIT]","Enabling drop zone on #"+id),target!=null&&target.addEventListener("drop",uploader.upload,!1),uploader},this.disable=function(uploader){var target;return target=Util.get(uploader._state.config.id),target!=null&&Util.unbind(target,"drop"),uploader},this.get=function(element_id){var u;return(u=_this._state.uploaders_by_id[element_id])!=null?_this._state.uploaders[u]:!1},this._init=function(){var uploader,uploaders,_i,_j,_len;uploaders=Util.get("pre-uploader"),_i=function(_u){var options;return options=Util.extend(!0,_u.hasAttribute("data-options")?JSON.parse(_u.getAttribute("data-options")):{},{id:_u.getAttribute("id")}),_u.classList.remove("pre-uploader"),_u.classList.add("uploader"),_u=_this.create(options)};if(uploaders!=null)for(_j=0,_len=uploaders.length;_j<_len;_j++)uploader=uploaders[_j],_i(uploader);return apptools.events.trigger("UPLOADER_API_READY",_this),_this._state.init=!0,_this}}return __extends(UploaderAPI,_super),UploaderAPI.mount="uploader",UploaderAPI.events=["UPLOADER_READY","UPLOADER_API_READY"],UploaderAPI}(CoreAPI),Uploader=function(_super){function Uploader(options){var _this=this;this._state={boundary:null,active:!1,init:!1,queued:0,session:null,config:{boundary_base:"d4v1dR3K0W",banned_types:["application/exe"],banned_extensions:[".exe"],max_cache:15,endpoints:[],finish:null},cache:{uploads_by_type:{},uploaded:[]}},this._state.config=Util.extend(this._state.config,options),this.internal={allow:function(file){var extension,type;return extension=file.name.split(".").pop(),type=file.type,Util.in_array(extension,_this._state.config.banned_extensions)?!1:Util.in_array(type,_this._state.config.banned_types)?!1:!0},finish:function(response){return _this._state.config.finish!=null?_this._state.config.finish.call(_this,response):response},prep_body:function(file,data){var body,boundary,crlf;return _this.internal.allow(file)?(boundary=_this._state.boundary,crlf="\r\n",body="--"+boundary+crlf,body+='Content-Disposition: form-data; name="filename"; filename="'+file.name+'"'+crlf,body+="Content-type: "+file.type+crlf+crlf,body+=data+crlf+crlf+"--"+boundary+"--",body):!1},preview:function(e){},progress:function(file,xhr){return xhr.upload.onprogress=function(ev){var percent,_f;_f=file.name.split(".")[0];if(ev.lengthComputable)return percent=Math.floor(ev.loaded/ev.total*100),console.log(percent)}},provision_boundary:function(){var base,char,rand,_b,_i,_len,_ref;_b=["-----"],base=_this._state.config.boundary_base,rand=Math.floor(Math.pow(Math.random()*1e4,3)),_ref=rand.toString().split("");for(_i=0,_len=_ref.length;_i<_len;_i++)char=_ref[_i],_b.push(base[char]);return _b.push("-----"),_b.join("")},read:function(file,callback){var reader;return reader=new FileReader,reader.file=file,reader.onloadend=callback,reader.readAsBinaryString(file)},ready:function(file,xhr){return xhr.onreadystatechange=function(){var response;return xhr.readyState===4&&xhr.status===200?(response=xhr.responseText,_this.internal.update_cache(file,xhr),_this.internal.finish(JSON.parse(response))):xhr.readyState===4?"XHR send finished with status "+xhr.status:"XHR send failed at readyState "+xhr.readyState}},send:function(file,data,url){var body,xhr;return xhr=new XMLHttpRequest,body=_this.internal.prep_body(file,data),_this.internal.progress(file,xhr),xhr.open("POST",url,!0),xhr.setRequestHeader("Content-type","multipart/form-data; boundary="+_this._state.boundary),_this.internal.ready(file,xhr),apptools.dev.verbose("UPLOADER","About to upload file: "+file.name),body?xhr.send(body):!1},update_cache:function(file,xhr){var l,mx,name,remaining,t,type,u;remaining=_this._state.queued--,remaining===0&&(_this._state.config.endpoints=[]),(t=_this._state.cache.uploads_by_type)[type=file.type]!=null?t[type]++:t[type]=name=file.name,(u=_this._state.cache.uploaded).push(name);if((l=u.length)>(mx=_this._state.config.max_cache))return u=u.splice(l-mx)}},this._state.boundary=this.internal.provision_boundary(),this.add_endpoint=function(endpoint){var endpt,_i,_len;if(Util.is_array(endpoint))for(_i=0,_len=endpoint.length;_i<_len;_i++)endpt=endpoint[_i],_this.add_endpoint(endpt);else _this._state.config.endpoints.push(endpoint);return _this},this.add_callback=function(callback){return Util.is_function(callback)&&(_this._state.config.finish=callback),_this},this.handle=function(e){var target;e.preventDefault&&(e.preventDefault(),e.stopPropagation(
)),target=e.target;switch(e.type){case"dragenter":case"dragover":target.style.border="2px dashed green";break;case"dragexit":case"dragleave":target.style.border="2px solid transparent";break;default:console.log("[Uploader]","Not sure how to handle a "+e.type+" event...:(")}return _this},this.upload=function(e){var diff,file,files,i,process_upload,_i,_len;e.preventDefault?(e.preventDefault(),e.stopPropagation(),files=e.dataTransfer.files):Util.is_array(e)?files=e:e.size?files=[e]:files=[],process_upload=function(f,url){return _this._state.active=!0,_this.internal.read(f,function(ev){var data,_f;return ev.preventDefault(),ev.stopPropagation(),_f=ev.target.file,data=ev.target.result,_this.internal.send(_f,data,url)})};if((e=_this._state.config.endpoints)==null||e.length<files.length)e==null&&(_this._state.config.endpoints=[]),diff=files.length-_this._state.config.endpoints.length,$.apptools.api.media.generate_endpoint({backend:"blobstore",file_count:diff}).fulfill({success:function(response){var endpt,_i,_len,_ref,_results;_ref=response.endpoints,_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++)endpt=_ref[_i],_results.push(_this._state.config.endpoints.push(endpt));return _results},failure:function(error){return alert("Uploader endpoint generation failed.")}});_this._state.queued=files.length;for(i=_i=0,_len=files.length;_i<_len;i=++_i)file=files[i],process_upload(file,_this._state.config.endpoints[i]);return _this},this._init=function(){return _this._state.init=!0,_this}}return __extends(Uploader,_super),Uploader}(CoreWidget),BinaryUploader=function(_super){function BinaryUploader(){return BinaryUploader.__super__.constructor.apply(this,arguments)}return __extends(BinaryUploader,_super),BinaryUploader}(Uploader),DataURLUploader=function(_super){function DataURLUploader(options){var _this=this;DataURLUploader.__super__.constructor.call(this,options),this.internal.read=function(file,callback){var reader;return reader=new FileReader,reader.file=file,reader.onloadend=callback,reader.readAsDataURL(file)}}return __extends(DataURLUploader,_super),DataURLUploader}(Uploader),ArrayBufferUploader=function(_super){function ArrayBufferUploader(options){var _this=this;ArrayBufferUploader.__super__.constructor.call(this,options),this.internal.send=function(file,data,url){var fd,to_blob,xhr;return typeof ArrayBuffer=="undefined"||ArrayBuffer===null?!1:(xhr=new XMLHttpRequest,_this.internal.progress(file,xhr),to_blob=function(dataURL){var abuff,abuff_view,blobb,bytes,char,d,i,l,mime,_i,_len;bytes=atob((d=dataURL.split(","))[1]),mime=d[0].split(":")[1].split(";")[0],abuff=new ArrayBuffer(l=bytes.length),abuff_view=new Uint8Array(abuff);for(i=_i=0,_len=bytes.length;_i<_len;i=++_i)char=bytes[i],abuff_view[i]=bytes.charCodeAt(i);return blobb=window.BlobBuilder?new BlobBuilder:window.WebKitBlobBuilder?new WebKitBlobBuilder:window.MozBlobBuilder?new MozBlobBuilder:null,blobb!=null?(blobb.append(abuff),blobb.getBlob(mime)):null},fd=new FormData,fd.append("file",to_blob(data)),xhr.open("POST",url,!0),_this.internal.ready(file,xhr),xhr.send(fd))}}return __extends(ArrayBufferUploader,_super),ArrayBufferUploader}(DataURLUploader),this.__apptools_preinit.abstract_base_classes.push(Uploader),this.__apptools_preinit.abstract_base_classes.push(UploaderAPI),this.__apptools_preinit.deferred_core_modules.push({module:UploaderAPI,"package":"widgets"}),StickyAPI=function(_super){function StickyAPI(apptools,widget,window){var _this=this;this._state={stickies:[],stickies_by_id:{},init:!1},this.create=function(target){var id,options,sticky;return options=target.hasAttribute("data-options")?JSON.parse(target.getAttribute("data-options")):{},sticky=new Sticky(target,options),id=sticky._state.element_id,_this._state.stickies_by_id[id]=_this._state.stickies.push(sticky)-1,sticky._init()},this.destroy=function(sticky){},this.enable=function(sticky){return Util.bind(window,"scroll",Util.debounce(sticky.refresh,15,!1)),sticky},this.disable=function(sticky){return Util.unbind(window,"scroll"),sticky},this.get=function(element_id){var index;return index=_this.stickies_by_id[element_id],_this.stickies[index]},this._init=function(){var stickies,sticky,_i,_len;stickies=Util.get("pre-sticky");if(stickies!=null)for(_i=0,_len=stickies.length;_i<_len;_i++)sticky=stickies[_i],_this.enable(_this.create(sticky));return apptools.events.trigger("STICKY_API_READY",_this),_this._state.init=!0,_this}}return __extends(StickyAPI,_super),StickyAPI.mount="sticky",StickyAPI.events=["STICKY_READY","STICKY_API_READY"],StickyAPI}(CoreAPI),Sticky=function(_super){function Sticky(target,options){var _this=this;this._state={element_id:target.getAttribute("id"),active:!1,init:!1,config:{side:"top"},cache:{original_offset:null,past_offset:null,classes:null,style:{}}},this._state.config=Util.extend(!0,this._state.config,options),this.refresh=function(){var achieved,distance,el,offset_side,past_offset,scroll,window_offset;el=document.getElementById(_this._state.element_id),console.log("[STICKY]","REFRESH METHOD HIT!"),offset_side=_this._state.config.side,window_offset=offset_side==="top"?window.scrollY:window.scrollX,past_offset=_this._state.cache.past_offset||0,_this._state.cache.past_offset=window_offset,distance=_this._state.cache.original_offset[offset_side]-8,achieved=window_offset-distance,scroll=window_offset-past_offset;if(scroll>0){if(_this._state.active||achieved<0)return!1;if(achieved>0)return _this.stick()}else{if(!(scroll<0))return!1;if(!_this._state.active||achieved>0)return!1;if(achieved<0)return _this.unstick()}},this.stick=function(){var el,prop,val,_ref;_this._state.active=!0,el=document.getElementById(_this._state.element_id),_this._state.cache.classes=el.className,_ref=el.style;for(prop in _ref)val=_ref[prop],_this._state.cache.style[prop]=val;return el.classList.add("fixed"),el.style.top="-8px",el.style.left=_this._state.cache.original_offset.left+"px",_this},this.unstick=function(){var el;return el=document.getElementById(_this._state.element_id),el.classList.remove("fixed"),el.style.left="",el.style.top="-170px",el.style.right="5%",_this._state.active=!1,_this},this._init=function(){return _this._state.cache.original_offset=Util.get_offset(Util.get(_this._state.element_id)),_this._state.init=!0,_this}}return __extends(Sticky,_super),Sticky}(CoreWidget),this.__apptools_preinit.abstract_base_classes.push(Sticky),this.__apptools_preinit.abstract_base_classes.push(StickyAPI),this.__apptools_preinit.deferred_core_modules.push({module:StickyAPI,"package":"widgets"}),AppTools=function(){function AppTools(window){var module,_i,_len,_ref,_ref1,_this=this;this.config={rpc:{base_uri:"/_api/rpc",host:null,enabled:!0},sockets:{host:null,enabled:!1}},this.lib={},this.sys={platform:{},version:this.version,core_events:["SYS_MODULE_LOADED","SYS_LIB_LOADED","SYS_DRIVER_LOADED"],state:{status:"NOT_READY",flags:["base"],preinit:{},modules:{},classes:{},interfaces:{},integrations:[],add_flag:function(flagname){return _this.sys.state.flags.push(flagname)},consider_preinit:function(preinit){var cls,lib,_i,_interface,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2;if(preinit.abstract_base_classes!=null){_ref=preinit.abstract_base_classes;for(_i=0,_len=_ref.length;_i<_len;_i++){cls=_ref[_i],_this.sys.state.classes[cls.name]=cls,cls["package"]!=null&&_this.sys.state.modules[cls["package"]]!=null&&(_this.sys.state.modules[cls["package"]].classes[cls.name]=cls);if(cls["export"]!=null&&cls["export"]==="private")continue;window[cls.name]=cls}}if(preinit.deferred_library_integrations!=null){_ref1=preinit.deferred_library_integrations;for(_j=0,_len1=_ref1.length;_j<_len1;_j++)lib=_ref1[_j],_this.sys.libraries.install(lib.name,lib.library)}if(preinit.abstract_feature_interfaces!=null){_ref2=preinit.abstract_feature_interfaces;for(_k=0,_len2=_ref2.length;_k<_len2;_k++)_interface=_ref2[_k],_this.sys.interfaces.install(_interface.name,_interface.adapter)}return preinit}},modules:{install:function(module,mountpoint_or_callback,callback){var module_name,mountpoint,pass_parent,target_mod,_base;return mountpoint_or_callback==null&&(mountpoint_or_callback=null),callback==null&&(callback=null),mountpoint_or_callback!=null&&(typeof mountpoint_or_callback=="function"?(callback=mountpoint_or_callback,mountpoint=null):mountpoint=mountpoint_or_callback),mountpoint!=null?(_this[mountpoint]==null&&(_this[mountpoint]={}),mountpoint=_this[mountpoint],pass_parent=!0):(mountpoint=_this,pass_parent=!1),module.mount!=null?module_name=module.mount:module_name=module.name.toLowerCase(),module.events!=null&&_this.events!=null&&_this.events.register(module.events),mountpoint[module_name]==null&&(pass_parent?(target_mod=new module(_this,mountpoint,window),mountpoint[module_name]=target_mod,_this.sys.state.modules[module_name]={module:target_mod,classes:{}}):(target_mod=new module(_this,window),mountpoint[module_name]=target_mod,_this.sys.state.modules[module_name]={module:target_mod,classes:{}})),typeof (_base=mountpoint[module_name])._init=="function"&&_base._init(_this),_this.dev!=null&&_this.dev.verbose!=null&&_this.dev.verbose("ModuleLoader","Installed module:",target_mod," at mountpoint: ",mountpoint," under the name: ",module_name),_this.events!=null&&_this.events.trigger("SYS_MODULE_LOADED",{module:target_mod,mountpoint:mountpoint}),callback!=null&&callback(target_mod),target_mod}},libraries:{install:function(name,library,callback){return callback==null&&(callback=null),_this.lib[name.toLowerCase()]=library,_this.sys.state.integrations.push(name.toLowerCase()),_this.dev.verbose("LibLoader",name+" detected."),_this.events.trigger("SYS_LIB_LOADED",{name:name,library:library}),callback!=null&&callback(library,name),_this.lib[name.toLowerCase()]},resolve:function(name){var lib,_i,_len,_ref;name=name.toLowerCase(),_ref=_this.sys.state.integrations;for(_i=0,_len=_ref.length;_i<_len;_i++){lib=_ref[_i];if(lib!==name)continue;return _this.lib[name.toLowerCase()]}}},interfaces:{install:function(name,adapter){return _this.dev.verbose("InterfaceLoader",'Installed "'+name+'" interface.'),_this.events.trigger("SYS_INTERFACE_LOADED",{name:name,adapter:adapter}),_this.sys.state.interfaces[name]={adapter:adapter,methods:adapter.methods},_this.sys.state.interfaces[name]},resolve:function(name){return _this.sys.state.interfaces[name]!=null?_this.sys.state.interfaces[name]:!1}},drivers:{query:{},loader:{},transport:{},storage:{},render:{},install:function(type,name,adapter,mountpoint,enabled,priority,callback){return callback==null&&(callback=null),_this.sys.drivers[type][name]={name:name,driver:mountpoint,enabled:enabled,priority:priority,"interface":adapter},callback!=null&&callback(_this.sys.drivers[type][name].driver),_this.events.trigger("SYS_DRIVER_LOADED",_this.sys.drivers[type][name]),_this.sys.drivers[type][name]},resolve:function(type,name,strict){var driver,priority_state,selected_driver;name==null&&(name=null),strict==null&&(strict=!1);if(_this.sys.drivers[type]==null){apptools.dev.critical("CORE",'Unkown driver type "'+type+'".');return}if(name!=null)return _this.sys.drivers[type][name]!=null?_this.sys.drivers[type][name].driver:(strict&&apptools.dev.critical("CORE","Could not resolve driver ",name," of type ",type,"."),!1);priority_state=-1,selected_driver=!1;for(driver in _this.sys.drivers[type]){driver=_this.sys.drivers[type][driver];if(driver.priority>priority_state){selected_driver=driver;break}}return selected_driver}},go:function(){return _this.dev.log("Core","All systems go."),_this.sys.state.status="READY",_this}},this.sys.modules.install(CoreDevAPI,function(dev){return dev.verbose("CORE","CoreDevAPI is up and running.")}),this.sys.modules.install(CoreEventsAPI,function(events){return events.register(_this.sys.core_events)}),window.__apptools_preinit!=null&&(this.sys.state.preinit=window.__apptools_preinit,this.sys.state.consider_preinit(window.__apptools_preinit)),(window!=null?window.Modernizr:void 0)!=null&&this.sys.libraries.install("Modernizr",window.Modernizr,function(lib,name){return _this.load=function(){var fragments,_ref;return fragments=1<=arguments.length?__slice.call(arguments,0):[],(_ref=_this.lib.modernizr).load.apply(_ref,fragments)}}),(window!=null?window.jQuery:void 0)!=null&&this.sys.libraries.install("jQuery",window.jQuery,function(lib,name){return _this.sys.drivers.install("query","jquery",_this.sys.state.classes.QueryDriver,_this.lib.jquery,!0,100,null),_this.sys.drivers.install("transport","jquery",_this.sys.state.classes.RPCDriver,_this.lib.jquery,!0,100,null)}),(window!=null?window.Zepto:void 0)!=null&&this.sys.libraries.install("Zepto",window.Zepto,function(lib,name){return _this.sys.drivers.install("query","zepto",_this.sys.state.classes.QueryDriver,_this.lib.zepto,!0,500,null),_this.sys.drivers.install("transport","zepto",_this.sys.state.classes.RPCDriver,_this.lib.zepto,!0,500,null)}),(window!=null?window._:void 0)!=null&&this.sys.libraries.install("Underscore",window._,function(lib,name){return _this.sys.drivers.install("query","underscore",_this.sys.state.classes.QueryDriver,_this.lib.underscore,!0,50,null),_this.sys.drivers.install("render","underscore",_this.sys.state.classes.RenderDriver,_this.lib.underscore,!0,50,null)}),(window!=null?window.Backbone:void 0)!=null&&this.sys.libraries.install("Backbone",window.Backbone),(window!=null?window.Lawnchair:void 0)!=null&&this.sys.libraries.install("Lawnchair",window.Lawnchair,function(library){return _this.sys.drivers.install("storage","lawnchair",_this.sys.state.classes.StorageDriver,_this.lib.lawnchair,!0,500,function(lawnchair){return _this.dev.verbose("Lawnchair","Storage is currently stubbed. Come back later.")})}),(window!=null?window.amplify:void 0)!=null&&this.sys.libraries.install("Amplify",window.amplify,function(library){return _this.sys.drivers.register("transport","amplify",_this.sys.state.classes.RPCDriver,_this.lib.amplify,!0,500,null),_this.sys.drivers.register("storage","amplify",_this.sys.state.classes.StorageDriver,_this.lib.amplify,!0,100,null)}),(window!=null?window.Milk:void 0)!=null&&this.sys.libraries.install("Milk",window.Milk,function(library){return _this.sys.drivers.install("render","milk",_this.sys.state.classes.RenderDriver,_this.lib.milk,!0,100,function(milk){return _this.dev.verbose("Milk","Render support is currently stubbed. Come back later.")})}),(window!=null?window.Mustache:void 0)!=null&&this.sys.libraries.install("Mustache",window.Mustache,function(library){return _this.sys.drivers.register("render","mustache",_this.sys.state.classes.RenderDriver,_this.lib.mustache,!0,500,function(mustache){return _this.dev.verbose("Mustache","Render support is currently stubbed. Come back later.")})}),this.sys.modules.install(CoreModelAPI),this.sys.modules.install(CoreAgentAPI),this.sys.modules.install(CoreDispatchAPI),this.sys.modules.install(CoreRPCAPI),this.sys.modules.install(CorePushAPI),this.sys.modules.install(CoreUserAPI),this.sys.modules.install(CoreStorageAPI),this.sys.modules.install(CoreRenderAPI);if(((_ref=window.__apptools_preinit)!=null?_ref.deferred_core_modules:void 0)!=null){_ref1=window.__apptools_preinit.deferred_core_modules;for(_i=0,_len=_ref1.length;_i<_len;_i++)module=_ref1[_i],module["package"]!=null?this.sys.modules.install(module.module,module["package"]):this.sys.modules.install(module.module)}return this.sys.go()}return AppTools.version={major:0,minor:1,micro:4,build:4282012,release:"BETA",get:function(){return[[[this.major.toString(),this.minor.toString(),this.micro.toString()].join("."),this.build.toString()].join("-"),this.release].join(" ")}},AppTools}(),window.AppTools=AppTools,window.apptools=new AppTools(window),window.jQuery!=null?$.extend({apptools:window.apptools}):(window.$=function(id){return document.getElementById(id)},window.$.apptools=window.apptools)}).call(this);