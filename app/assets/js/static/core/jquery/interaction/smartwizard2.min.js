(function(e){e.fn.smartWizard=function(t){var n=e.extend({},e.fn.smartWizard.defaults,t),r=arguments;return this.each(function(){function m(){var t=i.children("div");i.children("ul").addClass("anchor"),t.addClass("content"),a=e("<div>Loading</div>").addClass("loader"),l=e("<div></div>").addClass("action-bar"),c=e("<div></div>").addClass("step-container"),h=e("<a>"+n.labelNext+"</a>").attr("href","#").addClass("button-next"),p=e("<a>"+n.labelPrevious+"</a>").attr("href","#").addClass("button-previous"),d=e("<a>"+n.labelFinish+"</a>").attr("href","#").addClass("button-finish"),n.errorSteps&&n.errorSteps.length>0&&e.each(n.errorSteps,function(e,t){N(t,!0)}),c.append(t),l.append(a),i.append(c),i.append(l),l.append(d).append(h).append(p),u=c.width(),e(h).click(function(){return E(),!1}),e(p).click(function(){return S(),!1}),e(d).click(function(){if(!e(this).hasClass("button-disabled"))if(e.isFunction(n.onFinish)){if(!n.onFinish.call(this,e(o)))return!1}else{var t=i.parents("form");t&&t.length&&t.submit()}return!1}),e(o).bind("click",function(e){if(o.index(this)==s)return!1;var t=o.index(this),n=o.eq(t).attr("isDone")-0;return n==1&&y(t),!1}),n.keyNavigation&&e(document).keyup(function(e){e.which==39?E():e.which==37&&S()}),g(),y(s)}function g(){n.enableAllSteps?(e(o,i).removeClass("selected").removeClass("disabled").addClass("done"),e(o,i).attr("isDone",1)):(e(o,i).removeClass("selected").removeClass("done").addClass("disabled"),e(o,i).attr("isDone",0)),e(o,i).each(function(t){e(e(this).attr("href"),i).hide(),e(this).attr("rel",t+1)})}function y(t){var r=o.eq(t),s=n.contentURL,u=r.data("hasContent");stepNum=t+1,s&&s.length>0?n.contentCache&&u?b(t):e.ajax({url:s,type:"POST",data:{step_number:stepNum},dataType:"text",beforeSend:function(){a.show()},error:function(){a.hide()},success:function(n){a.hide(),n&&n.length>0&&(r.data("hasContent",!0),e(e(r,i).attr("href"),i).html(n),b(t))}}):b(t)}function b(t){var r=o.eq(t),a=o.eq(s);if(t!=s&&e.isFunction(n.onLeaveStep)&&!n.onLeaveStep.call(this,e(a)))return!1;c.height(e(e(r,i).attr("href"),i).outerHeight());if(n.transitionEffect=="slide")e(e(a,i).attr("href"),i).slideUp("fast",function(n){e(e(r,i).attr("href"),i).slideDown("fast"),s=t,w(a,r)});else if(n.transitionEffect=="fade")e(e(a,i).attr("href"),i).fadeOut("fast",function(n){e(e(r,i).attr("href"),i).fadeIn("fast"),s=t,w(a,r)});else if(n.transitionEffect=="slideleft"){var f=0,l=0;t>s?(nextElmLeft1=u+10,nextElmLeft2=0,l=0-e(e(a,i).attr("href"),i).outerWidth()):(nextElmLeft1=0-e(e(r,i).attr("href"),i).outerWidth()+20,nextElmLeft2=0,l=10+e(e(a,i).attr("href"),i).outerWidth()),t==s?(nextElmLeft1=e(e(r,i).attr("href"),i).outerWidth()+20,nextElmLeft2=0,l=0-e(e(a,i).attr("href"),i).outerWidth()):e(e(a,i).attr("href"),i).animate({left:l},"fast",function(t){e(e(a,i).attr("href"),i).hide()}),e(e(r,i).attr("href"),i).css("left",nextElmLeft1),e(e(r,i).attr("href"),i).show(),e(e(r,i).attr("href"),i).animate({left:nextElmLeft2},"fast",function(e){s=t,w(a,r)})}else e(e(a,i).attr("href"),i).hide(),e(e(r,i).attr("href"),i).show(),s=t,w(a,r);return!0}function w(t,r){e(t,i).removeClass("selected"),e(t,i).addClass("done"),e(r,i).removeClass("disabled"),e(r,i).removeClass("done"),e(r,i).addClass("selected"),e(r,i).attr("isDone",1),x();if(e.isFunction(n.onShowStep)&&!n.onShowStep.call(this,e(r)))return!1}function E(){var e=s+1;if(o.length<=e){if(!n.cycleSteps)return!1;e=0}y(e)}function S(){var e=s-1;if(0>e){if(!n.cycleSteps)return!1;e=o.length-1}y(e)}function x(){n.cycleSteps||(0>=s?e(p).addClass("button-disabled"):e(p).removeClass("button-disabled"),o.length-1<=s?e(h).addClass("button-disabled"):e(h).removeClass("button-disabled")),!o.hasClass("disabled")||n.enableFinishButton?e(d).removeClass("button-disabled"):e(d).addClass("button-disabled")}function T(t){e(".content",f).html(t),f.show()}function N(t,n){n?e(o.eq(t-1),i).addClass("error"):e(o.eq(t-1),i).removeClass("error")}var i=e(this),s=n.selected,o=e("ul > li > a",i),u=0,a,f,l,c,h,p,d;l=e(".action-bar",i),l.length==0&&(l=e("<div></div>").addClass("action-bar")),f=e(".msg-box",i),f.length==0&&(f=e('<div class="msg-box" style="display: none;"><span class="title"></span><span class="content"></span><a href="#" class="close" style="z-index: 100;">X</a></div>'),i.append(f)),e(".close",f).click(function(){return f.fadeOut("normal"),!1});if(!t||t==="init"||typeof t=="object")m();else{if(t==="showMessage"){var v=Array.prototype.slice.call(r,1);return T(v[0]),!0}if(t==="setError"){var v=Array.prototype.slice.call(r,1);return N(v[0].stepnum,v[0].iserror),!0}e.error("Method "+t+" does not exist")}})},e.fn.smartWizard.defaults={selected:0,keyNavigation:!0,enableAllSteps:!1,transitionEffect:"fade",contentURL:null,contentCache:!0,cycleSteps:!1,enableFinishButton:!1,errorSteps:[],labelNext:"Next",labelPrevious:"Previous",labelFinish:"Finish",onLeaveStep:null,onShowStep:null,onFinish:null}})(jQuery);