(function(global,undefined){var slice=[].slice,subscriptions={},amplify=global.amplify={publish:function(topic){var args=slice.call(arguments,1),topicSubscriptions,subscription,length,i=0,ret;if(!subscriptions[topic])return!0;topicSubscriptions=subscriptions[topic].slice();for(length=topicSubscriptions.length;i<length;i++){subscription=topicSubscriptions[i],ret=subscription.callback.apply(subscription.context,args);if(ret===!1)break}return ret!==!1},subscribe:function(topic,context,callback,priority){arguments.length===3&&typeof callback=="number"&&(priority=callback,callback=context,context=null),arguments.length===2&&(callback=context,context=null),priority=priority||10;var topicIndex=0,topics=topic.split(/\s/),topicLength=topics.length,added;for(;topicIndex<topicLength;topicIndex++){topic=topics[topicIndex],added=!1,subscriptions[topic]||(subscriptions[topic]=[]);var i=subscriptions[topic].length-1,subscriptionInfo={callback:callback,context:context,priority:priority};for(;i>=0;i--)if(subscriptions[topic][i].priority<=priority){subscriptions[topic].splice(i+1,0,subscriptionInfo),added=!0;break}added||subscriptions[topic].unshift(subscriptionInfo)}return callback},unsubscribe:function(topic,callback){if(!subscriptions[topic])return;var length=subscriptions[topic].length,i=0;for(;i<length;i++)if(subscriptions[topic][i].callback===callback){subscriptions[topic].splice(i,1);break}}}})(this),function(amplify,undefined){var store=amplify.store=function(key,value,options,type){var type=store.type;return options&&options.type&&options.type in store.types&&(type=options.type),store.types[type](key,value,options||{})};store.types={},store.type=null,store.addType=function(type,storage){store.type||(store.type=type),store.types[type]=storage,store[type]=function(key,value,options){return options=options||{},options.type=type,store(key,value,options)}},store.error=function(){return"amplify.store quota exceeded"};var rprefix=/^__amplify__/;function createFromStorageInterface(storageType,storage){store.addType(storageType,function(key,value,options){var storedValue,parsed,i,remove,ret=value,now=(new Date).getTime();if(!key){ret={},remove=[],i=0;try{key=storage.length;while(key=storage.key(i++))rprefix.test(key)&&(parsed=JSON.parse(storage.getItem(key)),parsed.expires&&parsed.expires<=now?remove.push(key):ret[key.replace(rprefix,"")]=parsed.data);while(key=remove.pop())storage.removeItem(key)}catch(error){}return ret}key="__amplify__"+key;if(value===undefined){storedValue=storage.getItem(key),parsed=storedValue?JSON.parse(storedValue):{expires:-1};if(!(parsed.expires&&parsed.expires<=now))return parsed.data;storage.removeItem(key)}else if(value===null)storage.removeItem(key);else{parsed=JSON.stringify({data:value,expires:options.expires?now+options.expires:null});try{storage.setItem(key,parsed)}catch(error){store[storageType]();try{storage.setItem(key,parsed)}catch(error){throw store.error()}}}return ret})}for(var webStorageType in{localStorage:1,sessionStorage:1})try{window[webStorageType].getItem&&createFromStorageInterface(webStorageType,window[webStorageType])}catch(e){}if(window.globalStorage)try{createFromStorageInterface("globalStorage",window.globalStorage[window.location.hostname]),store.type==="sessionStorage"&&(store.type="globalStorage")}catch(e){}(function(){if(store.types.localStorage)return;var div=document.createElement("div"),attrKey="amplify";div.style.display="none",document.getElementsByTagName("head")[0].appendChild(div);try{div.addBehavior("#default#userdata"),div.load(attrKey)}catch(e){div.parentNode.removeChild(div);return}store.addType("userData",function(key,value,options){div.load(attrKey);var attr,parsed,prevValue,i,remove,ret=value,now=(new Date).getTime();if(!key){ret={},remove=[],i=0;while(attr=div.XMLDocument.documentElement.attributes[i++])parsed=JSON.parse(attr.value),parsed.expires&&parsed.expires<=now?remove.push(attr.name):ret[attr.name]=parsed.data;while(key=remove.pop())div.removeAttribute(key);return div.save(attrKey),ret}key=key.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-");if(value===undefined){attr=div.getAttribute(key),parsed=attr?JSON.parse(attr):{expires:-1};if(!(parsed.expires&&parsed.expires<=now))return parsed.data;div.removeAttribute(key)}else value===null?div.removeAttribute(key):(prevValue=div.getAttribute(key),parsed=JSON.stringify({data:value,expires:options.expires?now+options.expires:null}),div.setAttribute(key,parsed));try{div.save(attrKey)}catch(error){prevValue===null?div.removeAttribute(key):div.setAttribute(key,prevValue),store.userData();try{div.setAttribute(key,parsed),div.save(attrKey)}catch(error){throw prevValue===null?div.removeAttribute(key):div.setAttribute(key,prevValue),store.error()}}return ret})})(),function(){var memory={},timeout={};function copy(obj){return obj===undefined?undefined:JSON.parse(JSON.stringify(obj))}store.addType("memory",function(key,value,options){return key?value===undefined?copy(memory[key]):(timeout[key]&&(clearTimeout(timeout[key]),delete timeout[key]),value===null?(delete memory[key],null):(memory[key]=value,options.expires&&(timeout[key]=setTimeout(function(){delete memory[key],delete timeout[key]},options.expires)),value)):copy(memory)})}()}(this.amplify=this.amplify||{}),function(amplify,undefined){function noop(){}function isFunction(obj){return{}.toString.call(obj)==="[object Function]"}function async(fn){var isAsync=!1;return setTimeout(function(){isAsync=!0},1),function(){var that=this,args=arguments;isAsync?fn.apply(that,args):setTimeout(function(){fn.apply(that,args)},1)}}amplify.request=function(resourceId,data,callback){var settings=resourceId||{};typeof settings=="string"&&(isFunction(data)&&(callback=data,data={}),settings={resourceId:resourceId,data:data||{},success:callback});var request={abort:noop},resource=amplify.request.resources[settings.resourceId],success=settings.success||noop,error=settings.error||noop;settings.success=async(function(data,status){status=status||"success",amplify.publish("request.success",settings,data,status),amplify.publish("request.complete",settings,data,status),success(data,status)}),settings.error=async(function(data,status){status=status||"error",amplify.publish("request.error",settings,data,status),amplify.publish("request.complete",settings,data,status),error(data,status)});if(!resource)throw settings.resourceId?"amplify.request: unknown resourceId: "+settings.resourceId:"amplify.request: no resourceId provided";if(!amplify.publish("request.before",settings)){settings.error(null,"abort");return}return amplify.request.resources[settings.resourceId](settings,request),request},amplify.request.types={},amplify.request.resources={},amplify.request.define=function(resourceId,type,settings){if(typeof type=="string"){if(!(type in amplify.request.types))throw"amplify.request.define: unknown type: "+type;settings.resourceId=resourceId,amplify.request.resources[resourceId]=amplify.request.types[type](settings)}else amplify.request.resources[resourceId]=type}}(amplify),function(amplify,$,undefined){var xhrProps=["status","statusText","responseText","responseXML","readyState"],rurlData=/\{([^\}]+)\}/g;amplify.request.types.ajax=function(defnSettings){return defnSettings=$.extend({type:"GET"},defnSettings),function(settings,request){var xhr,url=defnSettings.url,abort=request.abort,ajaxSettings=$.extend(!0,{},defnSettings,{data:settings.data}),aborted=!1,ampXHR={readyState:0,setRequestHeader:function(name,value){return xhr.setRequestHeader(name,value)},getAllResponseHeaders:function(){return xhr.getAllResponseHeaders()},getResponseHeader:function(key){return xhr.getResponseHeader(key)},overrideMimeType:function(type){return xhr.overrideMideType(type)},abort:function(){aborted=!0;try{xhr.abort()}catch(e){}handleResponse(null,"abort")},success:function(data,status){settings.success(data,status)},error:function(data,status){settings.error(data,status)}};amplify.publish("request.ajax.preprocess",defnSettings,settings,ajaxSettings,ampXHR),$.extend(ajaxSettings,{success:function(data,status){handleResponse(data,status)},error:function(_xhr,status){handleResponse(null,status)},beforeSend:function(_xhr,_ajaxSettings){xhr=_xhr,ajaxSettings=_ajaxSettings;var ret=defnSettings.beforeSend?defnSettings.beforeSend.call(this,ampXHR,ajaxSettings):!0;return ret&&amplify.publish("request.before.ajax",defnSettings,settings,ajaxSettings,ampXHR)}}),$.ajax(ajaxSettings);function handleResponse(data,status){$.each(xhrProps,function(i,key){try{ampXHR[key]=xhr[key]}catch(e){}}),/OK$/.test(ampXHR.statusText)&&(ampXHR.statusText="success"),data===undefined&&(data=null),aborted&&(status="abort"),/timeout|error|abort/.test(status)?ampXHR.error(data,status):ampXHR.success(data,status),handleResponse=$.noop}request.abort=function(){ampXHR.abort(),abort.call(this)}}},amplify.subscribe("request.ajax.preprocess",function(defnSettings,settings,ajaxSettings){var mappedKeys=[],data=ajaxSettings.data;if(typeof data=="string")return;data=$.extend(!0,{},defnSettings.data,data),ajaxSettings.url=ajaxSettings.url.replace(rurlData,function(m,key){if(key in data)return mappedKeys.push(key),data[key]}),$.each(mappedKeys,function(i,key){delete data[key]}),ajaxSettings.data=data}),amplify.subscribe("request.ajax.preprocess",function(defnSettings,settings,ajaxSettings){var data=ajaxSettings.data,dataMap=defnSettings.dataMap;if(!dataMap||typeof data=="string")return;$.isFunction(dataMap)?ajaxSettings.data=dataMap(data):($.each(defnSettings.dataMap,function(orig,replace){orig in data&&(data[replace]=data[orig],delete data[orig])}),ajaxSettings.data=data)});var cache=amplify.request.cache={_key:function(resourceId,url,data){data=url+data;var length=data.length,i=0,checksum=chunk();while(i<length)checksum^=chunk();function chunk(){return data.charCodeAt(i++)<<24|data.charCodeAt(i++)<<16|data.charCodeAt(i++)<<8|data.charCodeAt(i++)<<0}return"request-"+resourceId+"-"+checksum},_default:function(){var memoryStore={};return function(resource,settings,ajaxSettings,ampXHR){var cacheKey=cache._key(settings.resourceId,ajaxSettings.url,ajaxSettings.data),duration=resource.cache;if(cacheKey in memoryStore)return ampXHR.success(memoryStore[cacheKey]),!1;var success=ampXHR.success;ampXHR.success=function(data){memoryStore[cacheKey]=data,typeof duration=="number"&&setTimeout(function(){delete memoryStore[cacheKey]},duration),success.apply(this,arguments)}}}()};amplify.store&&($.each(amplify.store.types,function(type){cache[type]=function(resource,settings,ajaxSettings,ampXHR){var cacheKey=cache._key(settings.resourceId,ajaxSettings.url,ajaxSettings.data),cached=amplify.store[type](cacheKey);if(cached)return ajaxSettings.success(cached),!1;var success=ampXHR.success;ampXHR.success=function(data){amplify.store[type](cacheKey,data,{expires:resource.cache.expires}),success.apply(this,arguments)}}}),cache.persist=cache[amplify.store.type]),amplify.subscribe("request.before.ajax",function(resource){var cacheType=resource.cache;if(cacheType)return cacheType=cacheType.type||cacheType,cache[cacheType in cache?cacheType:"_default"].apply(this,arguments)}),amplify.request.decoders={jsend:function(data,status,ampXHR,success,error){data.status==="success"?success(data.data):data.status==="fail"?error(data.data,"fail"):data.status==="error"&&(delete data.status,error(data,"error"))}},amplify.subscribe("request.before.ajax",function(resource,settings,ajaxSettings,ampXHR){var _success=ampXHR.success,_error=ampXHR.error,decoder=$.isFunction(resource.decoder)?resource.decoder:resource.decoder in amplify.request.decoders?amplify.request.decoders[resource.decoder]:amplify.request.decoders._default;if(!decoder)return;function success(data,status){_success(data,status)}function error(data,status){_error(data,status)}ampXHR.success=function(data,status){decoder(data,status,ampXHR,success,error)},ampXHR.error=function(data,status){decoder(data,status,ampXHR,success,error)}})}(amplify,jQuery);